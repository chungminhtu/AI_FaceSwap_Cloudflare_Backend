<!--
  ⚠️ DO NOT EDIT THIS FILE ⚠️
  This file is auto-generated by build-static.js
  To make changes, edit the source files and run: node build-static.js
  Generated: 2026-02-26T08:46:26.723Z
-->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Face Swap AI - API Documentation</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify@4/lib/themes/buble.css">
  <style>
    * {
      font-family: 'Lexend Deca', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    :root {
      --theme-color: #3b82f6;
      --theme-color-dark: #2563eb;
      --sidebar-width: 380px;
      --content-max-width: 95%;
    }
    
    body {
      font-family: 'Lexend Deca', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-weight: 400;
    }
    
    .app-name-link img {
      max-width: 200px;
    }
    
    .sidebar {
      background: #ffffff;
      border-right: 1px solid #e5e7eb;
      width: var(--sidebar-width) !important;
    }
    
    .sidebar-toggle {
      display: none !important;
    }
    
    @media (max-width: 768px) {
      .sidebar {
        width: var(--sidebar-width) !important;
        transform: translateX(0) !important;
      }
    }
    
    .sidebar ul li a {
      color: #374151;
      font-weight: 400;
      font-family: 'Lexend Deca', sans-serif;
    }
    
    .sidebar ul li a:hover {
      color: var(--theme-color);
      background: rgba(59, 130, 246, 0.05);
    }
    
    .sidebar ul li.active > a {
      color: var(--theme-color);
      background: rgba(59, 130, 246, 0.1);
      border-left: 3px solid var(--theme-color);
      font-weight: 500;
    }
    
    .markdown-section {
      max-width: var(--content-max-width) !important;
      width: var(--content-max-width) !important;
      padding: 2rem 3rem;
    }
    
    @media (min-width: 1400px) {
      .markdown-section {
        max-width: 1400px !important;
        width: 1400px !important;
      }
    }
    
    .markdown-section h1 {
      color: #1f2937;
      border-bottom: 2px solid var(--theme-color);
      padding-bottom: 10px;
      font-weight: 600;
      font-family: 'Lexend Deca', sans-serif;
    }
    
    .markdown-section h2 {
      color: #374151;
      margin-top: 40px;
      font-weight: 600;
      font-family: 'Lexend Deca', sans-serif;
    }
    
    .markdown-section h3 {
      color: #4b5563;
      margin-top: 30px;
      font-weight: 500;
      font-family: 'Lexend Deca', sans-serif;
    }
    
    .markdown-section p,
    .markdown-section li {
      font-family: 'Lexend Deca', sans-serif;
      font-weight: 400;
      line-height: 1.7;
      color: #4b5563;
    }
    
    .markdown-section code {
      font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace !important;
      background: #f3f4f6;
      color: #dc2626;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.9em;
      font-weight: 400;
    }
    
    .markdown-section pre {
      background: #1f2937;
      border-left: 4px solid var(--theme-color);
      border-radius: 6px;
      padding: 1.5rem;
      overflow-x: auto;
    }
    
    .markdown-section pre code {
      font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace !important;
      background: transparent;
      color: #e5e7eb;
      padding: 0;
      font-size: 0.9em;
      font-weight: 400;
      line-height: 1.6;
    }
    
    .markdown-section blockquote {
      border-left: 4px solid var(--theme-color);
      background: rgba(59, 130, 246, 0.05);
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 4px;
    }
    
    .markdown-section blockquote p {
      color: #4b5563;
      margin: 0;
    }
    
    .app-name {
      font-size: 24px;
      font-weight: 600;
      color: var(--theme-color);
      font-family: 'Lexend Deca', sans-serif;
    }
    
    .cover {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 50%, #bfdbfe 100%);
    }
    
    .cover-main {
      color: #1f2937;
    }
    
    .cover-main h1 {
      color: var(--theme-color);
      font-family: 'Lexend Deca', sans-serif;
      font-weight: 600;
    }
    
    .cover-main p {
      color: #4b5563;
      font-family: 'Lexend Deca', sans-serif;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }
    
    table th,
    table td {
      padding: 0.75rem;
      border: 1px solid #e5e7eb;
      text-align: left;
      font-family: 'Lexend Deca', sans-serif;
    }
    
    table th {
      background: #f9fafb;
      font-weight: 600;
      color: #374151;
    }
    
    table tr:hover {
      background: #f9fafb;
    }
    
    .search input {
      font-family: 'Lexend Deca', sans-serif;
    }
  </style>
</head>
<body>
  <div id="app">Loading...</div>
  
  <script>
    // Embedded markdown content
    window.__staticDocs = {
      "API_TONG_QUAN_VI.md": "# Tổng quan API Face Swap AI\n\nTài liệu này mô tả đầy đủ các điểm cuối (endpoint) mà Cloudflare Worker cung cấp.\n\n**Base URL:** `https://api.d.shotpix.app`\n\n---\n\n## Mục lục\n\n- [Xác thực API](#xác-thực-api-api-authentication)\n- [APIs cần tích hợp với mobile](#apis-cần-tích-hợp-với-mobile-15-apis)\n- [Provider Aspect Ratio (Vertex / WaveSpeed)](#provider-aspect-ratio-vertex--wavespeed)\n- [Error Codes Reference](#error-codes-reference)\n- [API Endpoints (Chi tiết)](#api-endpoints-chi-tiết)\n  - [1. Upload & Quản lý File](#1-upload--quản-lý-file)\n  - [2. AI Processing](#2-ai-processing)\n  - [3. Quản lý Profile](#3-quản-lý-profile)\n  - [4. Truy vấn Dữ liệu](#4-truy-vấn-dữ-liệu)\n  - [5. Hệ thống & Cấu hình](#5-hệ-thống--cấu-hình)\n  - [6. Thanh toán & Subscription](#6-thanh-toán--subscription-google-play-billing)\n- [Tổng kết](#tổng-kết)\n\n---\n\n## Xác thực API (API Authentication)\n\n### Mobile API Key Authentication\n\nHệ thống hỗ trợ xác thực bằng API key cho các mobile APIs. Tính năng này có thể được bật/tắt thông qua biến môi trường `ENABLE_MOBILE_API_KEY_AUTH`.\n\n**Khi bật (`ENABLE_MOBILE_API_KEY_AUTH=true`):**\n- Các mobile APIs được bảo vệ yêu cầu API key trong request header\n- API key có thể được gửi qua:\n  - Header `X-API-Key`: `X-API-Key: your_api_key_here`\n  - Header `Authorization`: `Authorization: Bearer your_api_key_here`\n\n**Các endpoints được bảo vệ (khi authentication được bật):**\n- POST `/upload-url` (type=selfie) - Chỉ khi upload selfie\n- POST `/faceswap`\n- POST `/background`\n- POST `/enhance`\n- POST `/beauty`\n- POST `/filter`\n- POST `/restore`\n- POST `/aging`\n- POST `/upscaler4k`\n- POST `/remove-object`\n- POST `/expression`\n- POST `/upload-url` (type=mask) - Upload mask image\n- POST `/profiles` - Chỉ khi tạo profile mới\n- GET `/profiles/{id}` - Chỉ khi lấy profile theo ID\n- DELETE `/results/{id}` - Xóa result\n\n**Lưu ý:**\n- POST `/upload-url` (type=preset) không yêu cầu API key (backend only)\n- Các endpoints khác không nằm trong danh sách trên không yêu cầu API key\n\n---\n\n**Tạo API Key:**\n\nSử dụng script `generate-api-key.js` để tạo API key mới:\n\n```bash\nnode backend-cloudflare-workers/generate-api-key.js\n```\n\nScript sẽ tạo một API key ngẫu nhiên 32 bytes (256 bits) và hiển thị hướng dẫn thêm vào `deployments-secrets.json`:\n\n```json\n{\n  \"MOBILE_API_KEY\": \"your_generated_key_here\",\n  \"ENABLE_MOBILE_API_KEY_AUTH\": \"true\"\n}\n```\n\n**Ví dụ request với API key:**\n\n```bash\ncurl -X POST https://api.d.shotpix.app/faceswap \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_ids\": [\"selfie_1234567890_xyz789\"],\n    \"profile_id\": \"profile_1234567890\"\n  }'\n```\n\nHoặc sử dụng Authorization header:\n\n```bash\ncurl -X POST https://api.d.shotpix.app/faceswap \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_ids\": [\"selfie_1234567890_xyz789\"],\n    \"profile_id\": \"profile_1234567890\"\n  }'\n```\n\n**Error Response (401 Unauthorized):**\n\nKhi API key không hợp lệ hoặc thiếu:\n\n```json\n{\n  \"data\": null,\n  \"status\": \"error\",\n  \"message\": \"Unauthorized\",\n  \"code\": 401\n}\n```\n\n---\n\n## APIs cần tích hợp với mobile (20 APIs)\n\n**Tổng số API endpoints: 30**\n\n### APIs cần tích hợp với mobile (20 APIs)\n\n1. POST `/upload-url` (type=selfie) - Upload selfie\n2. POST `/upload-url` (type=mask) - Upload mask image (cho remove object)\n3. POST `/faceswap` - Đổi mặt (Face Swap) - luôn dùng Vertex AI, hỗ trợ multiple selfies\n4. POST `/background` - Tạo nền AI (AI Background)\n5. POST `/enhance` - AI enhance ảnh (cải thiện chất lượng kỹ thuật)\n6. POST `/beauty` - AI beautify ảnh (cải thiện thẩm mỹ khuôn mặt)\n7. POST `/filter` - AI Filter (Styles) - Áp dụng style từ preset lên selfie\n8. POST `/restore` - AI khôi phục và nâng cấp ảnh\n9. POST `/aging` - AI lão hóa khuôn mặt\n10. POST `/upscaler4k` - AI upscale ảnh lên 4K\n11. POST `/remove-object` - AI xóa vật thể khỏi ảnh bằng mask\n12. POST `/expression` - AI thay đổi biểu cảm khuôn mặt\n13. POST `/expand` - AI mở rộng ảnh\n14. POST `/replace-object` - AI thay thế vật thể trong ảnh\n15. POST `/profiles` - Tạo profile\n16. GET `/profiles/{id}` - Lấy profile (hỗ trợ cả Profile ID và Device ID)\n17. PUT `/profiles/{id}` - Cập nhật profile\n18. GET `/selfies` - Liệt kê selfies\n19. GET `/results` - Liệt kê results (generated images)\n20. DELETE `/results/{id}` - Xóa result\n\n### APIs không cần tích hợp với mobile (11 APIs)\n\n20. GET `/profiles` - Liệt kê profiles\n21. POST `/upload-url` (type=preset) - Upload preset (backend only)\n22. GET `/presets` - Liệt kê presets\n23. GET `/presets/{id}` - Lấy preset theo ID (bao gồm prompt_json)\n24. DELETE `/presets/{id}` - Xóa preset\n25. DELETE `/selfies/{id}` - Xóa selfie\n26. POST `/upload-thumbnails` - Tải lên thumbnails và presets (batch)\n27. GET `/thumbnails` - Liệt kê thumbnails\n28. GET `/thumbnails/{id}/preset` - Lấy preset_id từ thumbnail_id\n29. GET `/config` - Lấy config\n30. OPTIONS `/*` - CORS preflight requests\n\n---\n\n## Provider Aspect Ratio (Vertex / WaveSpeed)\n\nBackend hỗ trợ hai provider: **Vertex AI** và **WaveSpeed**. Mỗi provider có cách xử lý aspect ratio và kích thước khác nhau.\n\n### Vertex AI (Google)\n- **Chỉ dùng tỷ lệ chuẩn.** Ảnh input được map sang tỷ lệ hỗ trợ gần nhất; tỷ lệ gốc có thể không giữ nguyên.\n- **Tỷ lệ hỗ trợ:** 1:1, 3:2, 2:3, 3:4, 4:3, 4:5, 5:4, 9:16, 16:9, 21:9.\n- **Dùng khi:** Cần tỷ lệ chuẩn (9:16 stories, 1:1 posts, v.v.).\n\n### WaveSpeed\n- **Giữ nguyên tỷ lệ gốc.** Hỗ trợ custom dimensions 256–1536 px mỗi cạnh; scale tỷ lệ trong giới hạn.\n- **Giới hạn:** Min 256px, max 1536px mỗi cạnh.\n- **Dùng khi:** Cần giữ đúng tỷ lệ ảnh gốc, không crop méo.\n\n### So sánh\n\n| Feature | Vertex AI | WaveSpeed |\n|---------|-----------|-----------|\n| Aspect Ratio | Chỉ tỷ lệ chuẩn | Custom dimensions |\n| Giữ tỷ lệ | Snap gần nhất | Giữ chính xác |\n| Kích thước | Theo ratio | 256–1536px linh hoạt |\n\n### Override theo request\n\nMọi endpoint AI có thể gửi `\"provider\": \"vertex\"`, `\"provider\": \"wavespeed\"` (Flux), hoặc `\"provider\": \"wavespeed_gemini_2_5_flash_image\"` (Gemini 2.5 Flash Image qua WaveSpeed). Mặc định theo env `IMAGE_PROVIDER`.\n\n### Endpoints áp dụng\n\n`/enhance`, `/beauty`, `/restore`, `/aging`, `/filter`, `/faceswap` — đều hỗ trợ cả hai provider với hành vi trên.\n\n---\n\n## Error Codes Reference\n\n### Vision API Safety Error Codes (1001-1005)\n\nCác error codes này được trả về khi Google Vision API SafeSearch phát hiện nội dung không phù hợp trong ảnh. Được sử dụng cho:\n- POST `/upload-url` (type=selfie, action=\"4k\" hoặc \"4K\") - Kiểm tra ảnh selfie trước khi lưu\n\n| Error Code | Category | Mô tả |\n|------------|----------|-------|\n| **1001** | ADULT | Thể hiện khả năng nội dung dành cho người lớn của hình ảnh. Nội dung dành cho người lớn có thể bao gồm các yếu tố như khỏa thân, hình ảnh hoặc phim hoạt hình khiêu dâm, hoặc các hoạt động tình dục. |\n| **1002** | VIOLENCE | Hình ảnh này có khả năng chứa nội dung bạo lực. Nội dung bạo lực có thể bao gồm cái chết, thương tích nghiêm trọng hoặc tổn hại đến cá nhân hoặc nhóm cá nhân. |\n| **1003** | RACY | Khả năng cao hình ảnh được yêu cầu chứa nội dung khiêu dâm. Nội dung khiêu dâm có thể bao gồm (nhưng không giới hạn) quần áo mỏng manh hoặc xuyên thấu, khỏa thân được che đậy một cách khéo léo, tư thế tục tĩu hoặc khiêu khích, hoặc cận cảnh các vùng nhạy cảm trên cơ thể. |\n| **1004** | MEDICAL | Rất có thể đây là hình ảnh y tế. |\n| **1005** | SPOOF | Xác suất chế giễu. Xác suất xảy ra việc chỉnh sửa phiên bản gốc của hình ảnh để làm cho nó trông hài hước hoặc phản cảm. |\n\n#### Tìm kiếm An toàn (Safe Search)\n\nTập hợp các đặc điểm liên quan đến hình ảnh, được tính toán bằng các phương pháp thị giác máy tính trên các lĩnh vực tìm kiếm an toàn (ví dụ: người lớn, giả mạo, y tế, bạo lực).\n\n**Các trường (Fields):**\n\n- **adult** (Likelihood): Thể hiện khả năng nội dung dành cho người lớn của hình ảnh. Nội dung dành cho người lớn có thể bao gồm các yếu tố như khỏa thân, hình ảnh hoặc phim hoạt hình khiêu dâm, hoặc các hoạt động tình dục.\n\n- **spoof** (Likelihood): Xác suất chế giễu. Xác suất xảy ra việc chỉnh sửa phiên bản gốc của hình ảnh để làm cho nó trông hài hước hoặc phản cảm.\n\n- **medical** (Likelihood): Rất có thể đây là hình ảnh y tế.\n\n- **violence** (Likelihood): Hình ảnh này có khả năng chứa nội dung bạo lực. Nội dung bạo lực có thể bao gồm cái chết, thương tích nghiêm trọng hoặc tổn hại đến cá nhân hoặc nhóm cá nhân.\n\n- **racy** (Likelihood): Khả năng cao hình ảnh được yêu cầu chứa nội dung khiêu dâm. Nội dung khiêu dâm có thể bao gồm (nhưng không giới hạn) quần áo mỏng manh hoặc xuyên thấu, khỏa thân được che đậy một cách khéo léo, tư thế tục tĩu hoặc khiêu khích, hoặc cận cảnh các vùng nhạy cảm trên cơ thể.\n\n#### Severity Levels (Độ nghiêm trọng)\n\nGoogle Vision API SafeSearch trả về mức độ nghiêm trọng cho mỗi field (adult, violence, racy, medical, spoof). App kiểm tra **tất cả các fields** và sử dụng **mức độ cao nhất** trong bất kỳ field nào để quyết định có chặn ảnh hay không:\n\n| Severity Level | Giá trị | Mô tả | Có bị chặn? |\n|----------------|---------|-------|-------------|\n| **VERY_UNLIKELY** | -1 | Không có nội dung nhạy cảm, chắc chắn | ✅ **Cho phép** |\n| **UNLIKELY** | 0 | Không có nội dung nhạy cảm, nhưng chưa chắc chắn | ✅ **Cho phép** |\n| **POSSIBLE** | 1 | Có thể có nội dung nhạy cảm, nhưng chưa chắc chắn | ❌ **Chặn** |\n| **LIKELY** | 2 | Có nội dung nhạy cảm, chắc chắn | ❌ **Chặn** |\n| **VERY_LIKELY** | 3 | Có nội dung nhạy cảm, chắc chắn | ❌ **Chặn** |\n\n**Cách hoạt động:**\n- App kiểm tra tất cả 5 fields: `adult`, `violence`, `racy`, `medical`, `spoof`\n- Nếu **bất kỳ field nào** có level là `POSSIBLE`, `LIKELY`, hoặc `VERY_LIKELY` → Ảnh bị chặn\n- `statusCode` (1001-1005) được trả về dựa trên field có **mức độ cao nhất** (worst violation)\n- Error code mapping: `adult`=1001, `violence`=1002, `racy`=1003, `medical`=1004, `spoof`=1005\n\n**Ví dụ:**\n\n**Ví dụ 1 - Ảnh bị chặn:**\n```json\n{\n  \"adult\": \"VERY_UNLIKELY\",\n  \"violence\": \"POSSIBLE\",\n  \"racy\": \"UNLIKELY\",\n  \"medical\": \"VERY_UNLIKELY\",\n  \"spoof\": \"VERY_UNLIKELY\"\n}\n```\n→ **Kết quả:** Bị chặn vì `violence` có level `POSSIBLE`. Trả về `code: 1002` (violence).\n\n**Ví dụ 2 - Ảnh bị chặn (nhiều violations):**\n```json\n{\n  \"adult\": \"LIKELY\",\n  \"violence\": \"POSSIBLE\",\n  \"racy\": \"VERY_LIKELY\",\n  \"medical\": \"UNLIKELY\",\n  \"spoof\": \"VERY_UNLIKELY\"\n}\n```\n→ **Kết quả:** Bị chặn. `racy` có level cao nhất (`VERY_LIKELY`), nên trả về `code: 1003` (racy).\n\n**Ví dụ 3 - Ảnh được phép:**\n```json\n{\n  \"adult\": \"VERY_UNLIKELY\",\n  \"violence\": \"UNLIKELY\",\n  \"racy\": \"VERY_UNLIKELY\",\n  \"medical\": \"UNLIKELY\",\n  \"spoof\": \"VERY_UNLIKELY\"\n}\n```\n→ **Kết quả:** Được phép vì tất cả fields đều là `VERY_UNLIKELY` hoặc `UNLIKELY`.\n\n**Ví dụ Response khi bị chặn:**\n```json\n{\n  \"data\": null,\n  \"status\": \"error\",\n  \"message\": \"Upload failed\",\n  \"code\": 1001\n}\n```\n\n---\n\n### Vertex AI Safety Error Codes (2001-2004)\n\nCác error codes này được trả về khi Vertex AI Gemini safety filters chặn generated image. Được sử dụng cho:\n- POST `/faceswap` - Khi Vertex AI chặn generated image\n- POST `/background` - Khi Vertex AI chặn generated image\n- POST `/enhance` - Khi Vertex AI chặn generated image\n- POST `/beauty` - Khi Vertex AI chặn generated image\n- POST `/filter` - Khi Vertex AI chặn generated image\n- POST `/restore` - Khi Vertex AI chặn generated image\n- POST `/aging` - Khi Vertex AI chặn generated image\n\n#### Các loại tác hại\n\nBộ lọc nội dung đánh giá nội dung dựa trên các loại tác hại sau:\n\n| Error Code | Loại nguy hiểm | Sự định nghĩa |\n|------------|----------------|---------------|\n| **2001** | Lời lẽ kích động thù hận | Những bình luận tiêu cực hoặc gây hại nhắm vào danh tính và/hoặc các thuộc tính được bảo vệ. |\n| **2002** | Quấy rối | Những lời lẽ đe dọa, hăm dọa, bắt nạt hoặc lăng mạ nhắm vào người khác. |\n| **2003** | Nội dung khiêu dâm | Có chứa nội dung liên quan đến hành vi tình dục hoặc các nội dung khiêu dâm khác. |\n| **2004** | Nội dung nguy hiểm | Thúc đẩy hoặc tạo điều kiện tiếp cận các hàng hóa, dịch vụ và hoạt động có hại. |\n\n#### So sánh điểm xác suất và điểm mức độ nghiêm trọng (Probability Scores and Severity Scores)\n\nĐiểm an toàn xác suất phản ánh khả năng phản hồi của mô hình có liên quan đến tác hại tương ứng. Nó có một điểm tin cậy tương ứng nằm trong khoảng từ **0.0 đến 1.0**, được làm tròn đến một chữ số thập phân.\n\nĐiểm tin cậy được chia thành bốn mức độ tin cậy:\n\n| Mức độ tin cậy | Giá trị | Mô tả | Có bị chặn? |\n|----------------|---------|-------|-------------|\n| **NEGLIGIBLE** | Rất thấp | Khả năng có nội dung gây hại là không đáng kể | ✅ **Cho phép** |\n| **LOW** | Thấp | Khả năng có nội dung gây hại là thấp | ✅ **Cho phép** |\n| **MEDIUM** | Trung bình | Khả năng có nội dung gây hại là trung bình | ✅ **Cho phép** |\n| **HIGH** | Cao | Khả năng có nội dung gây hại là cao | ❌ **Chặn** |\n\n#### Safety Threshold Configuration\n\n**Cấu hình hiện tại:**\n- ✅ **Cho phép**: `NEGLIGIBLE`, `LOW`, `MEDIUM`\n- ❌ **Chặn**: `HIGH` only\n\n**Áp dụng cho tất cả các loại tác hại:**\n- HARM_CATEGORY_HATE_SPEECH (Lời lẽ kích động thù hận)\n- HARM_CATEGORY_HARASSMENT (Quấy rối)\n- HARM_CATEGORY_SEXUALLY_EXPLICIT (Nội dung khiêu dâm)\n- HARM_CATEGORY_DANGEROUS_CONTENT (Nội dung nguy hiểm)\n\n**Lưu ý:**\n- App chỉ chặn nội dung khi phát hiện vi phạm với `HIGH` confidence level\n- Nội dung với `NEGLIGIBLE`, `LOW`, hoặc `MEDIUM` confidence level đều được cho phép\n- Safety violations trả về HTTP 422 với internal error codes 2001-2004 trong trường `code`\n- Message trả về từ Vertex AI API response (có thể là finishMessage, refusalText, hoặc generic message)\n\n**Ví dụ Response:**\n```json\n{\n  \"data\": null,\n  \"status\": \"error\",\n  \"message\": \"Processing failed\",\n  \"code\": 2003\n}\n```\n\n---\n\n### HTTP Status Codes\n\nNgoài các error codes trên, API cũng trả về các HTTP status codes chuẩn:\n\n| Status Code | Mô tả |\n|-------------|-------|\n| **200** | Success |\n| **400** | Bad Request - Request không hợp lệ |\n| **401** | Unauthorized - API key không hợp lệ hoặc thiếu (khi `ENABLE_MOBILE_API_KEY_AUTH=true`) |\n| **422** | Unprocessable Entity - Content bị chặn (sử dụng error codes 1001-1005 hoặc 2001-2004) |\n| **429** | Rate Limit Exceeded - Vượt quá giới hạn request |\n| **500** | Internal Server Error - Lỗi server |\n\n**Lưu ý:**\n- Error codes 1001-1005 và 2001-2004 được trả về trong trường `code` của response body\n- HTTP status code luôn là 422 cho các safety violations (content bị chặn)\n- Chi tiết về violation có thể được tìm thấy trong `debug.vision` (cho Vision API) hoặc `debug.provider` (cho Vertex AI)\n\n---\n\n## API Endpoints (Chi tiết)\n\n### 1. Upload & Quản lý File\n\n#### 1.1. POST `/upload-url` (type=selfie) - Upload selfie\n\n**Mục đích:** Tải ảnh selfie trực tiếp lên server và lưu vào database. Endpoint này được sử dụng bởi mobile app để upload selfie.\n\n**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true` (chỉ áp dụng cho `type=selfie`).\n\n**Request:**\n\n**Upload single selfie với action:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-url \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -F \"files=@/path/to/selfie.jpg\" \\\n  -F \"type=selfie\" \\\n  -F \"profile_id=profile_1234567890\" \\\n  -F \"action=faceswap\" \\\n  -F \"dimensions=1024x768\"\n```\n\n**Upload multiple selfies với dimensions array:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-url \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -F \"files=@/path/to/selfie1.jpg\" \\\n  -F \"files=@/path/to/selfie2.jpg\" \\\n  -F \"type=selfie\" \\\n  -F \"profile_id=profile_1234567890\" \\\n  -F \"action=faceswap\" \\\n  -F 'dimensions=[\"1024x768\", \"800x600\"]'\n```\n\n**JSON với image_urls và dimensions array:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-url \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"image_urls\": [\"https://example.com/selfie1.jpg\", \"https://example.com/selfie2.jpg\"],\n    \"type\": \"selfie\",\n    \"profile_id\": \"profile_1234567890\",\n    \"action\": \"faceswap\",\n    \"dimensions\": [\"1024x768\", \"800x600\"]\n  }'\n```\n\n**Request Parameters:**\n- `files` (file[], required nếu dùng multipart): Mảng file ảnh selfie cần upload (hỗ trợ nhiều file).\n- `image_url` hoặc `image_urls` (string/string[], required nếu dùng JSON): URL ảnh selfie trực tiếp.\n- `type` (string, required): Loại upload. Các giá trị hỗ trợ:\n  - `\"selfie\"`: Upload ảnh selfie cho mobile app.\n  - `\"mask\"`: Upload ảnh mask (đen trắng) cho API `/remove-object`. Mask được lưu vào R2 folder `mask/`, action tự động đặt là `remove_object`.\n  - `\"preset\"`: Upload preset (backend only, không cần API key).\n- `profile_id` (string, required): ID profile người dùng.\n- `action` (string, chỉ áp dụng cho `type=selfie`): Loại action của selfie. Nếu không truyền, mặc định là `\"faceswap\"`. Các giá trị hỗ trợ:\n  - `\"faceswap\"`: Tối đa 8 ảnh (có thể cấu hình), tự động xóa ảnh cũ khi upload ảnh mới (giữ lại số ảnh mới nhất theo giới hạn). **Không kiểm tra Vision API.**\n  - `\"filter\"`: Tối đa 5 ảnh (có thể cấu hình), tự động xóa ảnh cũ khi upload ảnh mới. **Không kiểm tra Vision API.**\n  - `\"wedding\"`: Tối đa 2 ảnh, tự động xóa ảnh cũ khi upload ảnh mới (giữ lại 1 ảnh mới nhất). **Không kiểm tra Vision API.**\n  - `\"4k\"` hoặc `\"4K\"`: Tối đa 1 ảnh, tự động xóa ảnh cũ khi upload ảnh mới. **Ảnh sẽ được kiểm tra bằng Vision API trước khi lưu vào database.**\n  - `\"remove_object\"`: Dùng cho ảnh gốc cần xóa vật thể. Không giới hạn số lượng, tự động xóa sau khi API xử lý xong.\n  - `\"expression\"`: Dùng cho ảnh cần thay đổi biểu cảm. Không giới hạn số lượng, tự động xóa sau khi API xử lý xong.\n  - Các action khác (`\"enhance\"`, `\"beauty\"`, `\"restore\"`, `\"aging\"`, ...): Không giới hạn số lượng, tự động xóa sau khi API xử lý xong. **Không kiểm tra Vision API.**\n- `dimensions` (string | string[], optional): Kích thước ảnh selfie theo định dạng `\"widthxheight\"` (ví dụ: `\"1024x768\"`). Được sử dụng để truyền kích thước ảnh gốc cho WaveSpeed API khi thực hiện face swap, giúp giữ nguyên tỷ lệ và kích thước ảnh đầu ra. Nếu không cung cấp, WaveSpeed API sẽ tự động xác định kích thước từ ảnh đầu vào.\n  - **Cho single file**: Có thể truyền string đơn: `\"1024x768\"`\n  - **Cho multiple files**: Truyền JSON array cùng thứ tự với files: `[\"1024x768\", \"800x600\", null]` (null cho file không xác định được kích thước)\n\n**Response (Success 200):**\n```json\n{\n  \"data\": {\n    \"results\": [\n      {\n        \"id\": \"selfie_1234567890_xyz789\",\n        \"url\": \"https://resources.d.shotpix.app/faceswap-images/selfie/example.jpg\",\n        \"filename\": \"example.jpg\"\n      }\n    ],\n    \"count\": 1,\n    \"successful\": 1,\n    \"failed\": 0\n  },\n  \"status\": \"success\",\n  \"message\": \"Processing successful\",\n  \"code\": 200\n}\n```\n\n**Response (Error - Vision API Blocked):**\nKhi ảnh selfie không vượt qua kiểm tra an toàn của Vision API, endpoint sẽ trả về error code tương ứng với loại vi phạm:\n\n```json\n{\n  \"data\": null,\n  \"status\": \"error\",\n  \"message\": \"Upload failed\",\n  \"code\": 1001\n}\n```\n\n**Lưu ý quan trọng:**\n- **Vision API Error Codes (1001-1005):** Chỉ selfie uploads với `action=\"4k\"` hoặc `action=\"4K\"` mới được quét bởi Vision API trước khi lưu vào database. Các action khác (như `\"faceswap\"`, `\"wedding\"`, `\"default\"`, v.v.) **không** được kiểm tra bằng Vision API. Xem chi tiết error codes tại [Vision API Safety Error Codes](#vision-api-safety-error-codes-1001-1005).\n- **Vertex AI Error Codes (2001-2004):** Được trả về khi Vertex AI Gemini safety filters chặn generated image. Áp dụng cho các endpoints: `/faceswap`, `/background`, `/enhance`, `/beauty`, `/filter`, `/restore`, `/aging`. Xem chi tiết error codes tại [Vertex AI Safety Error Codes](#vertex-ai-safety-error-codes-2001-2004).\n- Chặn `POSSIBLE`, `LIKELY`, và `VERY_LIKELY` violations\n- Nếu ảnh không an toàn, file sẽ bị xóa khỏi R2 storage và trả về error code tương ứng\n- Error code được trả về trong trường `code` của response\n- **Giới hạn số lượng selfie:** Mỗi action có giới hạn riêng và tự động xóa ảnh cũ khi vượt quá giới hạn:\n  - `faceswap`: Tối đa 8 ảnh (có thể cấu hình qua `SELFIE_MAX_FACESWAP`)\n  - `wedding`: Tối đa 2 ảnh (cấu hình qua `SELFIE_MAX_WEDDING`)\n  - `4k`/`4K`: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_4K`)\n  - Các action khác: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_OTHER`)\n\n---\n\n#### 1.1b. POST `/upload-url` (type=mask) - Upload mask image\n\n**Mục đích:** Tải ảnh mask lên server để sử dụng với API `/remove-object`. Mask image là ảnh đen trắng, vùng trắng chỉ định vật thể cần xóa.\n\n**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-url \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -F \"files=@/path/to/mask.png\" \\\n  -F \"type=mask\" \\\n  -F \"profile_id=profile_1234567890\"\n```\n\n**Request Parameters:**\n- `files` (file[], required nếu dùng multipart): File ảnh mask.\n- `type` (string, required): Phải là `\"mask\"`.\n- `profile_id` (string, required): ID profile người dùng.\n\n**Response (Success 200):**\n```json\n{\n  \"data\": {\n    \"results\": [\n      {\n        \"id\": \"mask_abc123\",\n        \"url\": \"https://resources.d.shotpix.app/faceswap-images/mask/mask_abc123.png\",\n        \"filename\": \"mask_abc123.png\"\n      }\n    ],\n    \"count\": 1,\n    \"successful\": 1,\n    \"failed\": 0\n  },\n  \"status\": \"success\",\n  \"message\": \"Processing successful\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:**\n- Mask được lưu vào R2 folder `mask/`\n- Trong database, mask được lưu vào bảng `selfies` với `action = 'remove_object'`\n- Mask sẽ tự động bị xóa sau khi API `/remove-object` xử lý xong\n- Không áp dụng giới hạn số lượng (không có limit enforcement)\n\n---\n\n#### 1.2. POST `/upload-url` (type=preset) - Upload preset (backend only)\n\n**Mục đích:** Tải ảnh preset trực tiếp lên server và lưu vào database với xử lý tự động (Vision scan, Vertex prompt generation). Endpoint này chỉ được sử dụng bởi backend, không cần test trên mobile.\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n\n**Multipart/form-data:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-url \\\n  -F \"files=@/path/to/image1.jpg\" \\\n  -F \"files=@/path/to/image2.jpg\" \\\n  -F \"type=preset\" \\\n  -F \"profile_id=profile_1234567890\" \\\n  -F \"enableVertexPrompt=true\"\n```\n\n**JSON với image_url:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-url \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"image_url\": \"https://example.com/image.jpg\",\n    \"type\": \"preset\",\n    \"profile_id\": \"profile_1234567890\",\n    \"enableVertexPrompt\": true\n  }'\n```\n\n**Request Parameters:**\n- `files` (file[], required nếu dùng multipart): Mảng file ảnh preset cần upload (hỗ trợ nhiều file).\n- `image_url` hoặc `image_urls` (string/string[], required nếu dùng JSON): URL ảnh preset trực tiếp.\n- `type` (string, required): Phải là `\"preset\"` cho backend upload.\n- `profile_id` (string, required): ID profile người dùng.\n- `enableVertexPrompt` (boolean/string, optional): `true` hoặc `\"true\"` để bật tạo prompt Vertex khi upload preset. Sử dụng Vertex AI để phân tích ảnh và tạo prompt_json tự động.\n- `art_style` (string, optional): Filter art style cho prompt generation. Giá trị: `auto` (mặc định), `photorealistic`, `figurine`, `popmart`, `clay`, `disney`, `anime`, `chibi`, `watercolor`, `oil_painting`, `sketch`, `comic`, `pixel_art`, `cyberpunk`, `fantasy`, `vintage`, `minimalist`, `ghibli`, `lego`, `cartoon`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"results\": [\n      {\n        \"id\": \"preset_1234567890_abc123\",\n        \"url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",\n        \"filename\": \"example.jpg\"\n      }\n    ],\n    \"count\": 1,\n    \"successful\": 1,\n    \"failed\": 0\n  },\n  \"status\": \"success\",\n  \"message\": \"Processing successful\",\n  \"code\": 200,\n  \"debug\": {\n    \"vertex\": [\n      {\n        \"hasPrompt\": true,\n        \"prompt_json\": {\n          \"prompt\": \"...\",\n          \"style\": \"...\",\n          \"lighting\": \"...\"\n        },\n        \"vertex_info\": {\n          \"success\": true,\n          \"promptKeys\": [\"prompt\", \"style\", \"lighting\"],\n          \"debug\": {\n            \"endpoint\": \"https://.../generateContent\",\n            \"status\": 200,\n            \"responseTimeMs\": 4200\n          }\n        }\n      }\n    ],\n    \"filesProcessed\": 1,\n    \"resultsCount\": 1\n  }\n}\n```\n\n---\n\n#### 1.3. POST `/upload-thumbnails` - Upload thumbnails (backend only)\n\n**Mục đích:** Tải lên thumbnails (WebP và Lottie JSON) và tự động tạo presets. Hỗ trợ upload file zip chứa tất cả assets hoặc upload từng file riêng lẻ. Mỗi file sẽ trở thành một preset với filename làm preset_id. Vertex AI sẽ tự động phân tích ảnh WebP từ thư mục preset và tạo prompt_json metadata.\n\n**Authentication:** Không yêu cầu API key.\n\n**Upload individual files:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-thumbnails \\\n  -F \"files=@/path/to/preset/fs_wonder_f_3.png\" \\\n  -F \"path_preset_fs_wonder_f_3.png=preset/\" \\\n  -F \"files=@/path/to/lottie_1x/fs_wonder_f_3.json\" \\\n  -F \"path_lottie_1x_fs_wonder_f_3.json=lottie_1x/\" \\\n  -F \"files=@/path/to/lottie_avif_2x/fs_wonder_f_3.json\" \\\n  -F \"path_lottie_avif_2x_fs_wonder_f_3.json=lottie_avif_2x/\" \\\n  -F \"art_style=auto\"\n```\n\n**Upload with Art Style Filter (e.g., Pop Mart style):**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-thumbnails \\\n  -F \"files=@/path/to/preset/popmart_figure.png\" \\\n  -F \"path_popmart_figure.png=preset/\" \\\n  -F \"art_style=popmart\"\n```\n\n**Upload zip file containing all assets:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upload-thumbnails \\\n  -F \"files=@/path/to/thumbnails.zip\" \\\n  -F \"art_style=disney\"\n```\n\n**Supported Art Styles:**\n\n| Style | Description |\n|-------|-------------|\n| `auto` | Auto-detect style (default) |\n| `photorealistic` | Real photography |\n| `figurine` | 3D figurine/toy |\n| `popmart` | Pop Mart blind box |\n| `clay` | Clay/plasticine animation |\n| `disney` | Disney/Pixar 3D animation |\n| `anime` | Japanese anime/manga |\n| `chibi` | Chibi/super-deformed |\n| `watercolor` | Watercolor painting |\n| `oil_painting` | Classical oil painting |\n| `sketch` | Pencil/charcoal sketch |\n| `comic` | Western comic book |\n| `pixel_art` | Retro pixel art |\n| `cyberpunk` | Cyberpunk/neon futuristic |\n| `fantasy` | Fantasy/magical illustration |\n| `vintage` | Vintage/retro photography |\n| `minimalist` | Minimalist/flat design |\n| `ghibli` | Studio Ghibli animation |\n| `lego` | LEGO minifigure |\n| `cartoon` | General cartoon |\n\n**Cấu trúc thư mục:**\n```\n├── preset/\n│   ├── fs_wonder_f_3.png    # Files here get Vertex AI prompt generation\n│   └── fs_wonder_m_2.png\n├── lottie_1x/\n│   ├── fs_wonder_f_3.json   # Thumbnails at 1x resolution\n│   └── fs_wonder_m_2.json\n├── lottie_1.5x/\n│   ├── fs_wonder_f_3.json   # Thumbnails at 1.5x resolution\n│   └── fs_wonder_m_2.json\n├── lottie_2x/\n│   ├── fs_wonder_f_3.json   # Thumbnails at 2x resolution\n│   └── fs_wonder_m_2.json\n├── lottie_avif_1x/\n│   ├── fs_wonder_f_3.json   # AVIF thumbnails at 1x resolution\n│   └── fs_wonder_m_2.json\n└── [other resolution folders...]\n```\n\n**Quy tắc đặt tên file:**\n- Format: `[preset_id].[png|webp|json]`\n- Ví dụ: `fs_wonder_f_3.png`, `fs_wonder_m_2.webp`, `fireworks_animation.json`\n- Tên file (không bao gồm extension) sẽ trở thành `preset_id`\n- Vertex AI chỉ phân tích file ảnh từ thư mục \"preset\" để tạo `prompt_json` metadata\n- File từ các thư mục resolution khác (lottie_*, lottie_avif_*) là thumbnails, KHÔNG được gửi đến Vertex AI\n\n**Tính năng Vertex AI:**\n- Tự động gọi Vertex AI Gemini để phân tích file ảnh từ thư mục \"preset\"\n- Sử dụng `Promise.all` để xử lý batch upload và tạo prompt song song\n- `prompt_json` được lưu trong R2 custom metadata của preset files\n- Thumbnails được lưu ở nhiều resolution (1x, 1.5x, 2x, 3x, 4x) trong database\n- Chỉ áp dụng cho file ảnh từ thư mục \"preset\", bỏ qua thumbnails\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"total\": 3,\n    \"successful\": 3,\n    \"failed\": 0,\n    \"thumbnails_processed\": 3,\n    \"results\": [\n      {\n        \"filename\": \"fs_wonder_f_3.png\",\n        \"success\": true,\n        \"type\": \"preset\",\n        \"preset_id\": \"fs_wonder_f_3\",\n        \"url\": \"https://resources.d.shotpix.app/presets/fs_wonder_f_3.png\",\n        \"hasPrompt\": true,\n        \"prompt_json\": {\n          \"scene\": \"wonder woman portrait\",\n          \"style\": \"heroic\",\n          \"mood\": \"confident\",\n          \"colors\": [\"red\", \"blue\", \"gold\"]\n        },\n        \"vertex_info\": {\n          \"success\": true,\n          \"promptKeys\": [\"scene\", \"style\", \"mood\", \"colors\"]\n        },\n        \"metadata\": {\n          \"format\": \"webp\"\n        }\n      },\n      {\n        \"filename\": \"fs_wonder_f_3.json\",\n        \"success\": true,\n        \"type\": \"thumbnail\",\n        \"preset_id\": \"fs_wonder_f_3\",\n        \"url\": \"https://resources.d.shotpix.app/lottie_1x/fs_wonder_f_3.json\",\n        \"hasPrompt\": false,\n        \"vertex_info\": {\n          \"success\": false\n        },\n        \"metadata\": {\n          \"format\": \"lottie\",\n          \"resolution\": \"1x\"\n        }\n      },\n      {\n        \"filename\": \"fs_wonder_f_3.json\",\n        \"success\": true,\n        \"type\": \"thumbnail\",\n        \"preset_id\": \"fs_wonder_f_3\",\n        \"url\": \"https://resources.d.shotpix.app/lottie_avif_2x/fs_wonder_f_3.json\",\n        \"hasPrompt\": false,\n        \"vertex_info\": {\n          \"success\": false\n        },\n        \"metadata\": {\n          \"format\": \"lottie\",\n          \"resolution\": \"2x\"\n        }\n      }\n    ]\n  },\n  \"status\": \"success\",\n  \"message\": \"Processed 3 of 3 files\",\n  \"code\": 200,\n  \"debug\": {\n    \"filesProcessed\": 3,\n    \"resultsCount\": 3\n  }\n}\n```\n\n---\n\n### 2. AI Processing\n\n#### 2.1. POST `/faceswap` - Face Swap\n\n**Mục đích:** Thực hiện face swap giữa ảnh preset và ảnh selfie. Hỗ trợ multiple selfies để tạo composite results (ví dụ: wedding photos với cả male và female).\n\n**Lưu ý:**\n- Khác với `/background`: FaceSwap thay đổi khuôn mặt trong preset, còn AI Background merge selfie vào preset scene.\n- Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Hành vi theo Provider:**\n- **Vertex AI (mặc định):** Sử dụng `prompt_json` từ metadata của preset để thực hiện faceswap.\n- **WaveSpeed (`provider: \"wavespeed\"`):** Không sử dụng `prompt_json`. Sử dụng prompt cố định:\n  - **Single mode (1 selfie):** Gửi `[selfie, preset]` với prompt: \"Put the person in image1 into image2, keep all the makeup same as preset.\"\n  - **Couple mode (2 selfies):** Gửi `[selfie1, selfie2, preset]` với prompt: \"Put both persons in image1 and image2 into image3, keep all the makeup same as preset.\"\n\n**Request:**\n\n**Sử dụng selfie_ids (từ database):**\n```bash\ncurl -X POST https://api.d.shotpix.app/faceswap \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_ids\": [\"selfie_1234567890_xyz789\"],\n    \"profile_id\": \"profile_1234567890\",\n    \"additional_prompt\": \"Add dramatic lighting and cinematic atmosphere\",\n    \"aspect_ratio\": \"16:9\"\n  }'\n```\n\n**Sử dụng selfie_image_urls (URL trực tiếp):**\n```bash\ncurl -X POST https://api.d.shotpix.app/faceswap \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_image_urls\": [\"https://example.com/selfie1.jpg\", \"https://example.com/selfie2.jpg\"],\n    \"profile_id\": \"profile_1234567890\",\n    \"additional_prompt\": \"Add dramatic lighting and cinematic atmosphere\",\n    \"aspect_ratio\": \"16:9\"\n  }'\n```\n\n**Request Parameters:**\n- `preset_image_id` (string, required): ID ảnh preset đã lưu trong database (format: `preset_...`).\n- `selfie_ids` (array of strings, optional): Mảng các ID ảnh selfie đã lưu trong database (hỗ trợ multiple selfies). Thứ tự: [selfie_chính, selfie_phụ] - selfie đầu tiên sẽ được face swap vào preset, selfie thứ hai (nếu có) sẽ được sử dụng làm tham chiếu bổ sung.\n- `selfie_image_urls` (array of strings, optional): Mảng các URL ảnh selfie trực tiếp (thay thế cho `selfie_ids`). Hỗ trợ multiple selfies. Phải cung cấp `selfie_ids` HOẶC `selfie_image_urls` (không phải cả hai).\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình (mặc định: \"3:4\"). Hỗ trợ: \"1:1\", \"3:2\", \"2:3\", \"3:4\", \"4:3\", \"4:5\", \"5:4\", \"9:16\", \"16:9\", \"21:9\".\n  - **Lưu ý về kích thước đầu ra (WaveSpeed provider):** Nếu `aspect_ratio` được chỉ định rõ ràng, hệ thống sẽ sử dụng aspect ratio đó. Nếu không chỉ định hoặc là \"original\", hệ thống sẽ sử dụng kích thước gốc của selfie (từ trường `dimensions` được lưu khi upload) để giữ nguyên kích thước ảnh đầu ra.\n- `additional_prompt` (string, optional): câu mô tả bổ sung, được nối vào cuối trường `prompt` bằng ký tự `+`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Processing successful\",\n  \"code\": 200,\n  \"debug\": {\n    \"request\": {\n      \"targetUrl\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",\n      \"sourceUrls\": [\n        \"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_001.jpg\",\n        \"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_002.jpg\"\n      ]\n    },\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Processing successful\",\n      \"finalResultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n      \"debug\": {\n        \"endpoint\": \"https://...\",\n        \"status\": 200,\n        \"durationMs\": 843\n      }\n    },\n    \"vertex\": {\n      \"prompt\": { \"...\": \"...\" },\n      \"debug\": {\n        \"endpoint\": \"https://.../generateContent\",\n        \"status\": 200,\n        \"durationMs\": 5180,\n        \"requestPayload\": {\n          \"promptLength\": 746,\n          \"imageBytes\": 921344\n        }\n      }\n    },\n    \"vision\": {\n      \"checked\": false,\n      \"isSafe\": true,\n      \"error\": \"Safety check skipped for Vertex AI mode\"\n    },\n    \"storage\": {\n      \"attemptedDownload\": true,\n      \"downloadStatus\": 200,\n      \"savedToR2\": true,\n      \"r2Key\": \"results/result_123.jpg\",\n      \"publicUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n    },\n    \"database\": {\n      \"attempted\": true,\n      \"success\": true,\n      \"resultId\": \"result_...\"\n    }\n  }\n}\n```\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.2. POST `/background` - AI Background\n\n**Mục đích:** Tạo ảnh mới bằng cách merge selfie (người) vào preset (cảnh nền) sử dụng AI. Selfie sẽ được đặt vào preset scene một cách tự nhiên với nền AI được tạo tự động. Hỗ trợ 3 cách cung cấp nền: preset_image_id (từ database), preset_image_url (URL trực tiếp), hoặc custom_prompt (tạo nền từ text prompt sử dụng Vertex AI).\n\n**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n\n**Sử dụng selfie_id (từ database):**\n```bash\ncurl -X POST https://api.d.shotpix.app/background \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_id\": \"selfie_1234567890_xyz789\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"16:9\"\n  }'\n```\n\n**Sử dụng selfie_image_url (URL trực tiếp):**\n```bash\ncurl -X POST https://api.d.shotpix.app/background \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_image_url\": \"https://example.com/selfie.png\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"16:9\"\n  }'\n```\n\n**Sử dụng custom_prompt (tạo nền từ text prompt với Vertex AI):**\n```bash\ncurl -X POST https://api.d.shotpix.app/background \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"custom_prompt\": \"A beautiful sunset beach scene with palm trees and golden sand\",\n    \"selfie_id\": \"selfie_1234567890_xyz789\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"16:9\"\n  }'\n```\n\n**Sử dụng custom_prompt với selfie_image_url:**\n```bash\ncurl -X POST https://api.d.shotpix.app/background \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"custom_prompt\": \"A futuristic cityscape at night with neon lights and flying cars\",\n    \"selfie_image_url\": \"https://example.com/selfie.png\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"16:9\"\n  }'\n```\n\n**Lưu ý về custom_prompt:**\n- Khi sử dụng `custom_prompt`, hệ thống sẽ thực hiện 2 bước:\n  1. **Tạo ảnh nền**: Sử dụng Vertex AI Gemini để tạo ảnh nền từ text prompt\n  2. **Merge selfie**: Tự động merge selfie vào ảnh nền vừa tạo với lighting và color grading phù hợp\n- `custom_prompt` không thể kết hợp với `preset_image_id` hoặc `preset_image_url` (chỉ chọn một trong ba)\n- `aspect_ratio` và `model` sẽ được áp dụng cho cả việc tạo nền và merge\n\n**Lưu ý về preset_image_id:**\n- Hỗ trợ cả preset từ database (trong bảng `presets`) và file trực tiếp trong folder `/remove_bg/background/` trên R2\n- Có thể truyền `preset_image_id` kèm extension (ví dụ: `\"background_001.webp\"`) hoặc không có extension (ví dụ: `\"background_001\"`)\n- Nếu không có extension, hệ thống sẽ tự động thử các extension phổ biến: .webp, .jpg, .png, .jpeg\n- Hệ thống sẽ tìm file theo thứ tự: database trước, sau đó folder `/remove_bg/background/` nếu không tìm thấy trong database\n\n**Request Parameters:**\n- `preset_image_id` (string, optional): ID ảnh preset hoặc filename trong folder `/remove_bg/background/`. Phải cung cấp `preset_image_id` HOẶC `preset_image_url` HOẶC `custom_prompt` (chỉ một trong ba).\n- `preset_image_url` (string, optional): URL ảnh preset trực tiếp (thay thế cho `preset_image_id`). Phải cung cấp `preset_image_id` HOẶC `preset_image_url` HOẶC `custom_prompt` (chỉ một trong ba).\n- `custom_prompt` (string, optional): Prompt tùy chỉnh để tạo ảnh nền từ text sử dụng Vertex AI (thay thế cho preset image). Khi sử dụng `custom_prompt`, hệ thống sẽ:\n  1. Tạo ảnh nền từ text prompt bằng Vertex AI Gemini\n  2. Merge selfie vào ảnh nền đã tạo\n  Phải cung cấp `preset_image_id` HOẶC `preset_image_url` HOẶC `custom_prompt` (chỉ một trong ba).\n- `selfie_id` (string, optional): ID ảnh selfie đã lưu trong database (người). Phải cung cấp `selfie_id` HOẶC `selfie_image_url` (không phải cả hai).\n- `selfie_image_url` (string, optional): URL ảnh selfie trực tiếp (thay thế cho `selfie_id`).\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Các giá trị hỗ trợ: `\"original\"`, `\"1:1\"`, `\"3:2\"`, `\"2:3\"`, `\"3:4\"`, `\"4:3\"`, `\"4:5\"`, `\"5:4\"`, `\"9:16\"`, `\"16:9\"`, `\"21:9\"`. Mặc định: `\"3:4\"`. Khi sử dụng `custom_prompt`, tỷ lệ này sẽ được áp dụng cho cả việc tạo nền và merge.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Processing successful\",\n  \"code\": 200,\n  \"debug\": {\n    \"request\": {\n      \"targetUrl\": \"https://resources.d.shotpix.app/faceswap-images/preset/landscape.jpg\",\n      \"selfieUrl\": \"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_001.png\"\n    },\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Processing successful\",\n      \"finalResultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n    },\n    \"vision\": {\n      \"checked\": false,\n      \"isSafe\": true,\n      \"error\": \"Safety check skipped for Vertex AI mode\"\n    },\n    \"storage\": {\n      \"attemptedDownload\": true,\n      \"downloadStatus\": 200,\n      \"savedToR2\": true,\n      \"r2Key\": \"results/result_123.jpg\",\n      \"publicUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n    },\n    \"database\": {\n      \"attempted\": true,\n      \"success\": true,\n      \"resultId\": \"result_1234567890_abc123\"\n    }\n  }\n}\n```\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.3. POST `/enhance` - AI Enhance\n\n**Mục đích:** AI enhance ảnh - cải thiện chất lượng, độ sáng, độ tương phản và chi tiết của ảnh.\n\n**Lưu ý:** \n- Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n- Các endpoints không phải faceswap (`/enhance`, `/beauty`, `/filter`, `/restore`, `/aging`, `/background`) hỗ trợ giá trị `\"original\"` cho `aspect_ratio`.\n- Khi `aspect_ratio` là `\"original\"` hoặc không được cung cấp, hệ thống sẽ tự động:\n  1. Lấy kích thước (width/height) từ ảnh input\n  2. Tính toán tỷ lệ khung hình thực tế\n  3. Chọn tỷ lệ gần nhất trong danh sách hỗ trợ của Vertex AI\n  4. Sử dụng tỷ lệ đó để generate ảnh\n- Điều này đảm bảo ảnh kết quả giữ được tỷ lệ gần với ảnh gốc thay vì mặc định về 1:1.\n- **Các giá trị hỗ trợ:** `\"original\"`, `\"1:1\"`, `\"3:2\"`, `\"2:3\"`, `\"3:4\"`, `\"4:3\"`, `\"4:5\"`, `\"5:4\"`, `\"9:16\"`, `\"16:9\"`, `\"21:9\"`. Mặc định: `\"original\"`.\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/enhance \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"1:1\",\n  }'\n```\n\n**Request Parameters:**\n- `image_url` (string, required): URL ảnh cần enhance.\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/enhance_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Image enhancement completed\",\n  \"code\": 200,\n  \"debug\": {\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Enhancement completed\"\n    }\n  }\n}\n```\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.4. POST `/beauty` - AI Beauty\n\n**Mục đích:** AI beautify ảnh - cải thiện thẩm mỹ khuôn mặt (lý tưởng cho selfies và chân dung). Làm mịn da, xóa mụn, làm sáng mắt, tinh chỉnh khuôn mặt một cách tự nhiên.\n\n**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/beauty \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"1:1\",\n  }'\n```\n\n**Request Parameters:**\n- `image_url` (string, required): URL ảnh cần beautify.\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/beauty_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Image beautification completed\",\n  \"code\": 200,\n  \"debug\": {\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Beautification completed\"\n    }\n  }\n}\n```\n\n**Tính năng AI Beauty:**\n- Làm mịn da (smooth skin)\n- Xóa mụn và vết thâm (removes blemishes/acne)\n- Đều màu da (evens skin tone)\n- Làm thon mặt và đường viền hàm một cách tinh tế (slims face/jawline subtly)\n- Làm sáng mắt (brightens eyes)\n- Tăng cường môi và lông mày (enhances lips and eyebrows)\n- Mở rộng mắt nhẹ (enlarges eyes slightly, optional)\n- Làm mềm hoặc chỉnh hình mũi (softens or reshapes nose)\n- Tự động điều chỉnh makeup (adjusts makeup automatically)\n\n**Lưu ý:** AI Beauty tập trung vào cải thiện thẩm mỹ khuôn mặt, khác với AI Enhance (cải thiện chất lượng kỹ thuật như độ sắc nét, giảm nhiễu).\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.5. POST `/filter` - AI Filter (Styles)\n\n**Mục đích:** AI Filter (Styles) - Áp dụng các style sáng tạo hoặc điện ảnh từ preset lên selfie trong khi giữ nguyên tính toàn vẹn khuôn mặt.\n\n**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Hành vi theo Provider:**\n- **Vertex AI (mặc định):** Sử dụng `prompt_json` từ metadata của preset để áp dụng style. Preset phải có `prompt_json`.\n- **WaveSpeed (`provider: \"wavespeed\"`):** Không sử dụng `prompt_json`. Thay vào đó, WaveSpeed tự phân tích style của preset image (figurine, pop mart, clay, disney, etc.) và áp dụng style đó lên selfie. Gửi images theo thứ tự `[selfie, preset]` - image 1 là selfie (ảnh cần áp dụng style), image 2 là preset (nguồn style).\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/filter \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_id\": \"selfie_1234567890_xyz789\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"1:1\",\n    \"additional_prompt\": \"Add dramatic lighting\"\n  }'\n```\n\n**Hoặc sử dụng selfie_image_url:**\n```bash\ncurl -X POST https://api.d.shotpix.app/filter \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"preset_1234567890_abc123\",\n    \"selfie_image_url\": \"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_001.png\",\n    \"profile_id\": \"profile_1234567890\"\n  }'\n```\n\n**Request Parameters:**\n- `preset_image_id` (string, required): ID preset đã lưu trong database (format: `preset_...`). Preset phải có `prompt_json` (chỉ yêu cầu cho Vertex provider).\n- `selfie_id` (string, optional): ID selfie đã lưu trong database. Bắt buộc nếu không có `selfie_image_url`.\n- `selfie_image_url` (string, optional): URL ảnh selfie trực tiếp. Bắt buộc nếu không có `selfie_id`.\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`.\n- `additional_prompt` (string, optional): Prompt bổ sung để tùy chỉnh style.\n- `provider` (string, optional): Provider AI. Giá trị: `\"vertex\"` (mặc định), `\"wavespeed\"` (Flux), hoặc `\"wavespeed_gemini_2_5_flash_image\"` (Gemini 2.5 Flash Image qua WaveSpeed). WaveSpeed không yêu cầu `prompt_json` trong preset.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/filter_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Style filter applied successfully\",\n  \"code\": 200,\n  \"debug\": {\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Filter applied\"\n    }\n  }\n}\n```\n\n**Tính năng AI Filter:**\n- Đọc prompt_json từ preset (chứa thông tin về style, lighting, composition, camera, background)\n- Áp dụng style sáng tạo/điện ảnh từ preset lên selfie\n- Giữ nguyên 100% khuôn mặt, đặc điểm, cấu trúc xương, màu da\n- Chỉ thay đổi style, môi trường, ánh sáng, màu sắc, và mood hình ảnh\n- Hỗ trợ additional_prompt để tùy chỉnh thêm\n\n**Lưu ý:**\n- Preset phải có prompt_json (được tạo tự động khi upload preset với `enableVertexPrompt=true`)\n- Nếu preset chưa có prompt_json, API sẽ tự động generate từ preset image\n- Khác với `/faceswap`: Filter giữ nguyên khuôn mặt và chỉ áp dụng style, không thay đổi khuôn mặt\n\n**Parameter `redraw`:**\n- `redraw: true` → Bỏ qua cache, luôn generate ảnh mới (sử dụng cho nút \"Redraw\")\n- `redraw: false` hoặc không set → Check cache trước khi generate\n\n**Flow xử lý /filter:**\n\n```mermaid\nflowchart TD\n    START([Client Request]) --> PARSE[Parse Request Body]\n    PARSE --> VALIDATE{Valid Input?}\n    \n    VALIDATE -->|No| ERR400[400: Missing required field]\n    VALIDATE -->|Yes| CHECK_REDRAW{redraw: true?}\n    \n    CHECK_REDRAW -->|Yes| LOOKUP_SELFIE_REDRAW[Lookup Selfie in DB]\n    CHECK_REDRAW -->|No| LOOKUP_SELFIE[Lookup Selfie in DB]\n    \n    LOOKUP_SELFIE --> SELFIE_EXISTS{Selfie Exists?}\n    LOOKUP_SELFIE_REDRAW --> SELFIE_EXISTS_REDRAW{Selfie Exists?}\n    \n    SELFIE_EXISTS -->|Yes| CALL_AI[Call AI Provider]\n    SELFIE_EXISTS -->|No| CHECK_CACHE{Check KV Cache}\n    \n    SELFIE_EXISTS_REDRAW -->|Yes| CALL_AI_REDRAW[Call AI Provider]\n    SELFIE_EXISTS_REDRAW -->|No| ERR404_REDRAW[404: Selfie not found<br/>Cannot redraw without selfie]\n    \n    CHECK_CACHE -->|Found| RETURN_CACHED[200: Return Cached Result<br/>cached: true]\n    CHECK_CACHE -->|Not Found| ERR404[404: Selfie not found<br/>No cached result]\n    \n    CALL_AI --> AI_RESULT{AI Success?}\n    CALL_AI_REDRAW --> AI_RESULT_REDRAW{AI Success?}\n    \n    AI_RESULT -->|Error| ERR500[500: AI Processing Error<br/>Selfie NOT deleted<br/>NO cache stored]\n    AI_RESULT -->|Success| CACHE_RESULT[Cache Result in KV<br/>TTL: 24h]\n    \n    AI_RESULT_REDRAW -->|Error| ERR500\n    AI_RESULT_REDRAW -->|Success| CACHE_RESULT_REDRAW[Update Cache in KV<br/>TTL: 24h]\n    \n    CACHE_RESULT --> SUCCESS[200: Return Result<br/>resultImageUrl]\n    CACHE_RESULT_REDRAW --> SUCCESS_REDRAW[200: Return NEW Result<br/>resultImageUrl]\n    \n    ERR400 --> END([End])\n    ERR404 --> END\n    ERR404_REDRAW --> END\n    ERR500 --> RETRY_POSSIBLE([Client Can Retry<br/>Selfie still exists])\n    RETURN_CACHED --> END\n    SUCCESS --> END\n    SUCCESS_REDRAW --> END\n    \n    style START fill:#e1f5fe\n    style SUCCESS fill:#c8e6c9\n    style SUCCESS_REDRAW fill:#c8e6c9\n    style RETURN_CACHED fill:#fff9c4\n    style ERR400 fill:#ffcdd2\n    style ERR404 fill:#ffcdd2\n    style ERR404_REDRAW fill:#ffcdd2\n    style ERR500 fill:#ffcdd2\n    style RETRY_POSSIBLE fill:#ffe0b2\n```\n\n**Bảng tóm tắt các trường hợp:**\n\n| Scenario | `redraw` | Selfie Exists | Cache Exists | Result |\n|----------|----------|---------------|--------------|--------|\n| First request | `false` | ✅ | ❌ | Generate new |\n| Retry after success | `false` | ❌ (deleted by queue) | ✅ | Return cached |\n| Redraw button | `true` | ✅ | ✅ (ignored) | Generate new |\n| Retry after API error | `false` | ✅ (not deleted) | ❌ | Generate new |\n| Invalid selfie + no cache | `false` | ❌ | ❌ | 404 Error |\n\n**Key Rules:**\n1. **Chỉ cache khi SUCCESS** - Error không cache\n2. **Selfie được quản lý theo queue** - Tối đa `SELFIE_MAX_FILTER` selfies (mặc định: 5), tự động xóa cũ nhất khi vượt quá\n3. **`redraw: true` bỏ qua cache** - Luôn generate mới\n4. **Cache TTL = 24h** - Sau 24h cache tự expire\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.6. POST `/restore` - AI Restore\n\n**Mục đích:** AI khôi phục và nâng cấp ảnh - phục hồi ảnh bị hư hỏng, cũ, mờ, hoặc đen trắng thành ảnh chất lượng cao với màu sắc sống động.\n\n**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/restore \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"1:1\",\n  }'\n```\n\n**Request Parameters:**\n- `image_url` (string, required): URL ảnh cần khôi phục (ảnh cũ, bị hư hỏng, mờ, hoặc đen trắng).\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/restore_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Image restoration completed\",\n  \"code\": 200,\n  \"debug\": {\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Restoration completed\"\n    }\n  }\n}\n```\n\n**Tính năng AI Restore:**\n- Khôi phục ảnh bị hư hỏng (fix scratches, tears, noise, blurriness)\n- Chuyển đổi ảnh đen trắng thành màu với màu sắc sống động\n- Nâng cấp chất lượng lên 16K DSLR quality\n- Tăng cường chi tiết (face, eyes, hair, clothing)\n- Thêm ánh sáng, bóng đổ, và độ sâu trường ảnh thực tế\n- Retouching chuyên nghiệp cấp Photoshop\n- High dynamic range, ultra-HD, lifelike textures\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.7. POST `/aging` - AI Aging\n\n**Mục đích:** AI biến đổi tuổi khuôn mặt - áp dụng style tuổi từ preset lên selfie. Mỗi preset chứa prompt_json định nghĩa style tuổi cụ thể (em bé, người già, v.v.).\n\n**Lưu ý:**\n- Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n- Hỗ trợ `aspect_ratio` tương tự `/enhance`. Khi `aspect_ratio` là `\"original\"` hoặc không được cung cấp, hệ thống sẽ tự động:\n  1. Lấy kích thước (width/height) từ ảnh selfie input\n  2. Tính toán tỷ lệ khung hình thực tế\n  3. Chọn tỷ lệ gần nhất trong danh sách hỗ trợ của Vertex AI\n  4. Sử dụng tỷ lệ đó để generate ảnh\n- Điều này đảm bảo ảnh kết quả giữ được tỷ lệ gần với ảnh gốc thay vì mặc định về 1:1.\n- **Các giá trị hỗ trợ:** `\"original\"`, `\"1:1\"`, `\"3:2\"`, `\"2:3\"`, `\"3:4\"`, `\"4:3\"`, `\"4:5\"`, `\"5:4\"`, `\"9:16\"`, `\"16:9\"`, `\"21:9\"`. Mặc định: `\"original\"`.\n\n**Hành vi theo Provider:**\n- **Vertex AI (mặc định):** Sử dụng `prompt_json` từ metadata của preset để áp dụng biến đổi tuổi. Preset phải có `prompt_json`.\n- **WaveSpeed (`provider: \"wavespeed\"`):** Sử dụng `prompt_json` nếu có, hoặc phân tích style của preset image trực tiếp. Gửi images theo thứ tự `[selfie, preset]`.\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/aging \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"aging_baby_preset_001\",\n    \"selfie_id\": \"selfie_1234567890_xyz789\",\n    \"profile_id\": \"profile_1234567890\"\n  }'\n```\n\n**Hoặc sử dụng selfie_image_url:**\n```bash\ncurl -X POST https://api.d.shotpix.app/aging \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"preset_image_id\": \"aging_elderly_preset_001\",\n    \"selfie_image_url\": \"https://example.com/selfie.jpg\",\n    \"profile_id\": \"profile_1234567890\",\n    \"aspect_ratio\": \"original\",\n    \"additional_prompt\": \"Make the aging look natural\"\n  }'\n```\n\n**Request Parameters:**\n- `preset_image_id` (string, required*): ID preset aging đã lưu trong database. Preset chứa `prompt_json` định nghĩa style tuổi. *Bắt buộc nếu không có `preset_image_url`.\n- `preset_image_url` (string, required*): URL ảnh preset trực tiếp. *Bắt buộc nếu không có `preset_image_id`.\n- `selfie_id` (string, required*): ID selfie đã lưu trong database. *Bắt buộc nếu không có `selfie_image_url`.\n- `selfie_image_url` (string, required*): URL ảnh selfie trực tiếp. *Bắt buộc nếu không có `selfie_id`.\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Mặc định: `\"original\"`.\n- `additional_prompt` (string, optional): Prompt bổ sung để tùy chỉnh.\n- `provider` (string, optional): Provider AI. Giá trị: `\"vertex\"` (mặc định), `\"wavespeed\"` (Flux), hoặc `\"wavespeed_gemini_2_5_flash_image\"` (Gemini 2.5 Flash Image qua WaveSpeed).\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/aging_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Aging transformation completed\",\n  \"code\": 200,\n  \"debug\": {\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Aging completed\"\n    }\n  }\n}\n```\n\n**Tính năng AI Aging:**\n- Sử dụng prompt_json từ preset (chứa hướng dẫn biến đổi tuổi cụ thể)\n- Mỗi preset có style tuổi riêng (em bé, thiếu niên, trung niên, người già, v.v.)\n- Giữ nguyên race, ethnicity, skin tone, gender\n- Hỗ trợ additional_prompt để tùy chỉnh thêm\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.8. POST `/upscaler4k` - AI Upscale 4K\n\n**Mục đích:** Upscale ảnh lên độ phân giải 4K sử dụng WaveSpeed AI.\n\n**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/upscaler4k \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n    \"profile_id\": \"profile_1234567890\"\n  }'\n```\n\n**Request Parameters:**\n- `image_url` (string, required): URL ảnh cần upscale.\n- `profile_id` (string, required): ID profile người dùng.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_1234567890_abc123\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/upscaler4k_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Upscaling completed\",\n  \"code\": 200,\n  \"debug\": {\n    \"provider\": {\n      \"success\": true,\n      \"statusCode\": 200,\n      \"message\": \"Upscaler4K image upscaling completed\",\n      \"finalResultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/upscaler4k_123.jpg\"\n    },\n    \"vertex\": {\n      \"debug\": {\n        \"endpoint\": \"https://api.wavespeed.ai/api/v3/wavespeed-ai/ultimate-image-upscaler\",\n        \"status\": 200,\n        \"durationMs\": 5000\n      }\n    },\n    \"inputSafety\": {\n      \"checked\": true,\n      \"isSafe\": true\n    },\n    \"outputSafety\": {\n      \"checked\": true,\n      \"isSafe\": true\n    }\n  }\n}\n```\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.9. POST `/remove-object` - AI Xóa vật thể\n\n**Mục đích:** Xóa vật thể hoặc vùng được chỉ định bằng mask khỏi ảnh, lấp đầy bằng nền tự nhiên. Sử dụng WaveSpeed Bria Eraser API (SOTA object removal).\n\n**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Quy trình:**\n1. Upload ảnh gốc qua `POST /upload-url` (type=selfie, action=remove_object)\n2. Upload mask qua `POST /upload-url` (type=mask) - vùng trắng = xóa, vùng đen = giữ lại\n3. Gọi `POST /remove-object` với selfie_id và mask_id\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/remove-object \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_id\": \"E0PtVZEio5fctjMd\",\n    \"mask_id\": \"mask_abc123\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n**Hoặc dùng URL trực tiếp:**\n```bash\ncurl -X POST https://api.d.shotpix.app/remove-object \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.webp\",\n    \"mask_image_url\": \"https://resources.d.shotpix.app/mask/xyz.webp\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n**Request Parameters:**\n- `selfie_id` (string): ID ảnh gốc (từ upload-url type=selfie). Không dùng cùng `selfie_image_url`.\n- `selfie_image_url` (string): URL ảnh gốc. Không dùng cùng `selfie_id`.\n- `mask_id` (string): ID mask (từ upload-url type=mask). Không dùng cùng `mask_image_url`.\n- `mask_image_url` (string): URL mask. Không dùng cùng `mask_id`.\n- `profile_id` (string, required): ID profile người dùng.\n\n**Lưu ý kỹ thuật:** API sử dụng WaveSpeed Bria Eraser - không cần prompt, chỉ gửi ảnh gốc + mask. Không hỗ trợ `aspect_ratio`, `model`, `provider` (luôn dùng Bria Eraser).\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_id\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Object removal completed\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Sau khi xử lý, selfie và mask sẽ tự động bị xóa.\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.10. POST `/expression` - AI Thay đổi biểu cảm\n\n**Mục đích:** Thay đổi biểu cảm khuôn mặt trong ảnh dựa trên loại biểu cảm được chọn.\n\n**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Danh sách Expression hỗ trợ:**\n\n| Giá trị | Mô tả |\n|---------|-------|\n| `sad` | Buồn - Nét mặt buồn bã, u sầu |\n| `laugh` | Cười lớn - Cười sảng khoái, há miệng |\n| `smile` | Mỉm cười - Nụ cười tự nhiên, ấm áp |\n| `dimpled_smile` | Cười lúm đồng tiền - Nụ cười rộng với lúm đồng tiền |\n| `open_eye` | Mở mắt to - Mắt mở rộng, ngạc nhiên |\n| `close_eye` | Nhắm mắt - Mắt nhẹ nhàng nhắm lại |\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/expression \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_id\": \"E0PtVZEio5fctjMd\",\n    \"expression\": \"smile\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\",\n    \"aspect_ratio\": \"original\"\n  }'\n```\n\n**Hoặc dùng URL trực tiếp:**\n```bash\ncurl -X POST https://api.d.shotpix.app/expression \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.webp\",\n    \"expression\": \"laugh\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n**Request Parameters:**\n- `selfie_id` (string): ID selfie. Không dùng cùng `selfie_image_url`.\n- `selfie_image_url` (string): URL ảnh. Không dùng cùng `selfie_id`.\n- `expression` (string, required): Loại biểu cảm. Giá trị: `sad`, `laugh`, `smile`, `dimpled_smile`, `open_eye`, `close_eye`.\n- `profile_id` (string, required): ID profile người dùng.\n- `aspect_ratio` (string, optional): Tỉ lệ khung hình. Mặc định `original`.\n- `model` (string, optional): Model AI. Mặc định `2.5`.\n- `provider` (string, optional): `vertex` hoặc `wavespeed`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_id\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n    \"expression\": \"smile\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Expression modification completed\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Sau khi xử lý, selfie sẽ tự động bị xóa.\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n#### 2.11. POST `/expand` - AI Expand\n\n**Mục đích:** Mở rộng/outpaint ảnh sử dụng WaveSpeed AI. Client tạo PNG với vùng transparent là nơi AI sẽ fill nội dung mới.\n\n**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Cách hoạt động:**\n1. Client tạo ảnh PNG với kích thước mong muốn (vd: 1080x1920 cho story)\n2. Đặt ảnh gốc vào vị trí mong muốn trong canvas\n3. Vùng transparent (alpha=0) là nơi AI sẽ tự động fill/expand\n4. Upload PNG lên và gọi API\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/expand \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_id\": \"E0PtVZEio5fctjMd\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n```bash\ncurl -X POST https://api.d.shotpix.app/expand \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.png\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n**Request Parameters:**\n- `selfie_id` (string): ID selfie (PNG với transparent areas). Không dùng cùng `selfie_image_url`.\n- `selfie_image_url` (string): URL ảnh PNG. Không dùng cùng `selfie_id`.\n- `profile_id` (string, required): ID profile người dùng.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_id\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Image expansion completed\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Sau khi xử lý, selfie sẽ tự động bị xóa.\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n#### 2.12. POST `/replace-object` - AI Replace Object\n\n**Mục đích:** Thay thế vật thể/vùng được đánh dấu trong ảnh bằng nội dung mới do người dùng mô tả. Sử dụng WaveSpeed AI flux-2-klein-9b/edit.\n\n**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Cách hoạt động:**\n1. Frontend ghép ảnh gốc + mask thành 1 ảnh duy nhất (vùng highlight = nơi cần thay thế)\n2. Upload ảnh đã ghép lên\n3. Gọi API kèm `custom_prompt` mô tả nội dung muốn thay thế vào\n\n**Request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/replace-object \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_id\": \"E0PtVZEio5fctjMd\",\n    \"custom_prompt\": \"a red sports car\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n```bash\ncurl -X POST https://api.d.shotpix.app/replace-object \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.png\",\n    \"custom_prompt\": \"a beautiful garden with flowers\",\n    \"profile_id\": \"CbS0w8Ed8ezrlJ7o\"\n  }'\n```\n\n**Request Parameters:**\n- `selfie_id` (string): ID ảnh đã ghép (origin + mask). Không dùng cùng `selfie_image_url`.\n- `selfie_image_url` (string): URL ảnh đã ghép. Không dùng cùng `selfie_id`.\n- `custom_prompt` (string, required): Mô tả nội dung muốn thay thế vào vùng được đánh dấu.\n- `profile_id` (string, required): ID profile người dùng.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"result_id\",\n    \"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Object replacement completed\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Sau khi xử lý, selfie sẽ tự động bị xóa.\n\n**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)\n\n---\n\n### 3. Quản lý Profile\n\n#### 3.1. POST `/profiles` - Tạo profile\n\n**Mục đích:** Tạo profile mới.\n\n**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n\n**Minimal (chỉ cần device_id):**\n```bash\ncurl -X POST https://api.d.shotpix.app/profiles \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"device_id\": \"device_1765774126587_yaq0uh6rvz\"\n  }'\n```\n\n**Full request:**\n```bash\ncurl -X POST https://api.d.shotpix.app/profiles \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"device_id\": \"device_1765774126587_yaq0uh6rvz\",\n    \"userID\": \"user_external_123\",\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"avatar_url\": \"https://example.com/avatar.jpg\",\n    \"preferences\": \"{\\\"theme\\\":\\\"dark\\\",\\\"language\\\":\\\"vi\\\"}\"\n  }'\n```\n\n**Với preferences dạng object:**\n```bash\ncurl -X POST https://api.d.shotpix.app/profiles \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -d '{\n    \"device_id\": \"device_1765774126587_yaq0uh6rvz\",\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"avatar_url\": \"https://example.com/avatar.jpg\",\n    \"preferences\": {\n      \"theme\": \"dark\",\n      \"language\": \"vi\"\n    }\n  }'\n```\n\n**Hoặc gửi device_id qua header:**\n```bash\ncurl -X POST https://api.d.shotpix.app/profiles \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your_api_key_here\" \\\n  -H \"x-device-id: device_1765774126587_yaq0uh6rvz\" \\\n  -d '{\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\"\n  }'\n```\n\n**Request Parameters:**\n- `device_id` (string, optional): ID thiết bị. Có thể gửi trong body hoặc header `x-device-id`. Nếu không có, sẽ là `null`.\n- `userID` hoặc `user_id` (string, optional): **User ID bên ngoài** dùng để tìm kiếm profile. Đây là ID từ hệ thống của bạn (ví dụ: Firebase UID, Auth0 ID, v.v.). Có thể dùng để tìm profile sau này.\n- `id` (string, optional): ID profile nội bộ. Nếu không có, hệ thống tự tạo bằng `nanoid(16)`.\n- `name` (string, optional): tên profile.\n- `email` (string, optional): email.\n- `avatar_url` (string, optional): URL avatar.\n- `preferences` (string hoặc object, optional): preferences dạng JSON string hoặc object. Nếu là object, hệ thống tự động chuyển thành JSON string trước khi lưu vào D1 database (vì D1 không hỗ trợ JSON object trực tiếp).\n\n**Lưu ý về ID:**\n- `id` (profile_id): ID nội bộ của profile, tự động tạo nếu không cung cấp.\n- `user_id`: ID từ hệ thống bên ngoài (Firebase, Auth0, v.v.), dùng để liên kết với user của bạn.\n- `device_id`: ID thiết bị, dùng để theo dõi user chưa đăng nhập.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uYNgRR70Ry9OFuMV\",\n    \"device_id\": \"device_1765774126587_yaq0uh6rvz\",\n    \"user_id\": \"user_external_123\",\n    \"created_at\": \"2025-12-15T04:48:47.676Z\",\n    \"updated_at\": \"2025-12-15T04:48:47.676Z\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Profile created successfully\",\n  \"code\": 200,\n  \"debug\": {\n    \"profileId\": \"uYNgRR70Ry9OFuMV\",\n    \"deviceId\": \"device_1765774126587_yaq0uh6rvz\",\n    \"userId\": \"user_external_123\"\n  }\n}\n```\n\n---\n\n#### 3.2. GET `/profiles/{id}` - Lấy profile\n\n**Mục đích:** Lấy thông tin profile theo Profile ID, Device ID, hoặc User ID.\n\n**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Path Parameters:**\n- `id` (string, required): Có thể là **Profile ID**, **Device ID**, hoặc **User ID**. API sẽ tìm theo thứ tự: profile_id → device_id → user_id.\n\n**Request:**\n```bash\n# Tìm bằng Profile ID\ncurl https://api.d.shotpix.app/profiles/uYNgRR70Ry9OFuMV \\\n  -H \"X-API-Key: your_api_key_here\"\n\n# Tìm bằng Device ID\ncurl https://api.d.shotpix.app/profiles/device_1765774126587_yaq0uh6rvz \\\n  -H \"X-API-Key: your_api_key_here\"\n\n# Tìm bằng User ID (từ hệ thống bên ngoài)\ncurl https://api.d.shotpix.app/profiles/user_external_123 \\\n  -H \"X-API-Key: your_api_key_here\"\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uYNgRR70Ry9OFuMV\",\n    \"device_id\": \"device_1765774126587_yaq0uh6rvz\",\n    \"user_id\": \"user_external_123\",\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"avatar_url\": \"https://example.com/avatar.jpg\",\n    \"preferences\": \"{\\\"theme\\\":\\\"dark\\\",\\\"language\\\":\\\"vi\\\"}\",\n    \"created_at\": \"2025-12-15T04:48:47.676Z\",\n    \"updated_at\": \"2025-12-15T04:48:47.676Z\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Profile retrieved successfully\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Cả ba cách tìm (bằng Profile ID, Device ID, hoặc User ID) đều trả về cùng một profile với đầy đủ thông tin.\n\n---\n\n#### 3.3. PUT `/profiles/{id}` - Cập nhật profile\n\n**Mục đích:** Cập nhật thông tin profile.\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl -X PUT https://api.d.shotpix.app/profiles/profile_1234567890 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"John Doe Updated\",\n    \"email\": \"john.updated@example.com\",\n    \"avatar_url\": \"https://example.com/new-avatar.jpg\",\n    \"preferences\": {\n      \"theme\": \"light\",\n      \"language\": \"en\"\n    }\n  }'\n```\n\n**Request Parameters:**\n- `name` (string, optional): tên profile.\n- `email` (string, optional): email.\n- `avatar_url` (string, optional): URL avatar.\n- `preferences` (string hoặc object, optional): preferences dạng JSON string hoặc object. Nếu là object, hệ thống tự động chuyển thành JSON string trước khi lưu vào D1 database (vì D1 không hỗ trợ JSON object trực tiếp).\n\n**Lưu ý:** ID profile phải được cung cấp trong URL path (`/profiles/{id}`), không cần gửi trong body.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"uYNgRR70Ry9OFuMV\",\n    \"device_id\": \"device_1765774126587_yaq0uh6rvz\",\n    \"user_id\": \"user_external_123\",\n    \"name\": \"John Doe Updated\",\n    \"email\": \"john.updated@example.com\",\n    \"avatar_url\": \"https://example.com/new-avatar.jpg\",\n    \"preferences\": \"{\\\"theme\\\":\\\"light\\\",\\\"language\\\":\\\"en\\\"}\",\n    \"created_at\": \"2025-12-15T04:48:47.676Z\",\n    \"updated_at\": \"2025-12-15T05:00:00.000Z\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Profile updated successfully\",\n  \"code\": 200\n}\n```\n\n---\n\n#### 3.4. GET `/profiles` - Liệt kê profiles\n\n**Mục đích:** Liệt kê tất cả profiles (dùng cho admin/debugging).\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/profiles\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"profiles\": [\n      {\n        \"id\": \"uYNgRR70Ry9OFuMV\",\n        \"device_id\": \"device_1765774126587_yaq0uh6rvz\",\n        \"user_id\": \"user_external_123\",\n        \"name\": \"John Doe\",\n        \"email\": \"john@example.com\",\n        \"avatar_url\": \"https://example.com/avatar.jpg\",\n        \"preferences\": \"{\\\"theme\\\":\\\"dark\\\",\\\"language\\\":\\\"vi\\\"}\",\n        \"created_at\": \"2025-12-15T04:48:47.676Z\",\n        \"updated_at\": \"2025-12-15T04:48:47.676Z\"\n      }\n    ]\n  },\n  \"status\": \"success\",\n  \"message\": \"Profiles retrieved successfully\",\n  \"code\": 200\n}\n```\n\n---\n\n### 4. Truy vấn Dữ liệu\n\n#### 4.1. GET `/presets` - Liệt kê presets\n\n**Mục đích:** Trả về danh sách preset trong database.\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/presets\ncurl https://api.d.shotpix.app/presets?include_thumbnails=true\n```\n\n**Query Parameters:**\n- `include_thumbnails` (optional): `true` để bao gồm cả presets có thumbnail. Mặc định chỉ trả về presets không có thumbnail.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"presets\": [\n      {\n        \"id\": \"preset_1234567890_abc123\",\n        \"preset_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",\n        \"image_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",\n        \"hasPrompt\": true,\n        \"prompt_json\": null,\n        \"thumbnail_url\": \"https://resources.d.shotpix.app/webp_1x/face-swap/wedding_both_1.webp\",\n        \"thumbnail_format\": \"webp\",\n        \"thumbnail_resolution\": \"1x\",\n        \"created_at\": \"2024-01-01T00:00:00.000Z\"\n      }\n    ]\n  },\n  \"status\": \"success\",\n  \"message\": \"Presets retrieved successfully\",\n  \"code\": 200,\n  \"debug\": {\n    \"count\": 1\n  }\n}\n```\n\n---\n\n#### 4.2. GET `/presets/{id}` - Lấy preset theo ID\n\n**Mục đích:** Lấy thông tin chi tiết của một preset theo ID (bao gồm `prompt_json`).\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/presets/preset_1234567890_abc123\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"id\": \"preset_1234567890_abc123\",\n    \"preset_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",\n    \"image_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",\n    \"hasPrompt\": true,\n    \"prompt_json\": {\n      \"prompt\": \"...\",\n      \"style\": \"...\",\n      \"lighting\": \"...\"\n    },\n    \"thumbnail_url\": \"https://resources.d.shotpix.app/webp_1x/face-swap/wedding_both_1.webp\",\n    \"thumbnail_format\": \"webp\",\n    \"thumbnail_resolution\": \"1x\",\n    \"created_at\": \"2024-01-01T00:00:00.000Z\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Preset retrieved successfully\",\n  \"code\": 200,\n  \"debug\": {\n    \"presetId\": \"preset_1234567890_abc123\",\n    \"hasPrompt\": true\n  }\n}\n```\n\n---\n\n#### 4.3. DELETE `/presets/{id}` - Xóa preset\n\n**Mục đích:** Xóa preset khỏi D1 và R2.\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl -X DELETE https://api.d.shotpix.app/presets/preset_1234567890_abc123\n```\n\n**Response:**\n```json\n{\n  \"data\": null,\n  \"status\": \"success\",\n  \"message\": \"Preset deleted successfully\",\n  \"code\": 200\n}\n```\n\n---\n\n#### 4.4. GET `/selfies` - Liệt kê selfies\n\n**Mục đích:** Trả về tối đa 50 selfie gần nhất của một profile. Endpoint này được sử dụng bởi mobile app để lấy danh sách selfies đã upload.\n\n**Authentication:** Không yêu cầu API key (có thể được bật trong tương lai).\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/selfies?profile_id=profile_1234567890\n```\n\n**Query Parameters:**\n- `profile_id` (required): ID profile.\n- `limit` (optional): Số lượng selfies tối đa trả về (1-50). Mặc định: 50.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"selfies\": [\n      {\n        \"id\": \"selfie_1234567890_xyz789\",\n        \"selfie_url\": \"https://resources.d.shotpix.app/faceswap-images/selfie/example.jpg\",\n        \"action\": \"faceswap\",\n        \"created_at\": \"2024-01-01T00:00:00.000Z\"\n      }\n    ]\n  },\n  \"status\": \"success\",\n  \"message\": \"Selfies retrieved successfully\",\n  \"code\": 200\n}\n```\n\n---\n\n#### 4.5. DELETE `/selfies/{id}` - Xóa selfie\n\n**Mục đích:** Xóa selfie khỏi D1 và R2.\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl -X DELETE https://api.d.shotpix.app/selfies/selfie_1234567890_xyz789\n```\n\n**Response:**\n```json\n{\n  \"data\": null,\n  \"status\": \"success\",\n  \"message\": \"Selfie deleted successfully\",\n  \"code\": 200,\n  \"debug\": {\n    \"selfieId\": \"selfie_1234567890_xyz789\",\n    \"r2Deleted\": true,\n    \"r2Error\": null\n  }\n}\n```\n\n---\n\n#### 4.6. GET `/results` - Liệt kê results\n\n**Mục đích:** Trả về tối đa 50 kết quả generated images (face swap, background, enhance, beauty, filter, restore, aging, upscaler4k) gần nhất. Endpoint này được sử dụng bởi mobile app để lấy danh sách các ảnh đã được tạo.\n\n**Authentication:** Không yêu cầu API key (có thể được bật trong tương lai).\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/results\ncurl https://api.d.shotpix.app/results?profile_id=profile_1234567890\n```\n\n**Query Parameters:**\n- `profile_id` (optional): ID profile để lọc kết quả.\n- `limit` (optional): Số lượng results tối đa trả về (1-50). Mặc định: 50.\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"result_1234567890_abc123\",\n      \"result_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",\n      \"action\": \"faceswap\",\n      \"created_at\": \"2024-01-01T00:00:00.000Z\"\n    }\n  ],\n  \"status\": \"success\",\n  \"message\": \"Results retrieved successfully\",\n  \"code\": 200\n}\n```\n\n**Response:** `data` là mảng phẳng (flat array) các result. Mỗi item:\n- `id`: ID duy nhất của result\n- `result_url`: URL public của ảnh kết quả\n- `action`: Loại action (`faceswap`, `background`, `upscaler4k`, `enhance`, `beauty`, `filter`, `restore`, `aging`). Có thể null.\n- `created_at`: Thời gian tạo (ISO 8601)\n\n---\n\n#### 4.7. DELETE `/results/{id}` - Xóa result\n\n**Mục đích:** Xóa kết quả khỏi D1 và R2.\n\n**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.\n\n**Request:**\n```bash\ncurl -X DELETE https://api.d.shotpix.app/results/result_1234567890_abc123\n```\n\n**Response:**\n```json\n{\n  \"data\": null,\n  \"status\": \"success\",\n  \"message\": \"Result deleted successfully\",\n  \"code\": 200,\n  \"debug\": {\n    \"resultId\": \"result_1234567890_abc123\",\n    \"databaseDeleted\": 1,\n    \"r2Deleted\": true,\n    \"r2Key\": \"results/result_123.jpg\",\n    \"r2Error\": null\n  }\n}\n```\n\n---\n\n#### 4.8. GET `/thumbnails` - Liệt kê thumbnails\n\n**Mục đích:** Lấy danh sách thumbnails từ database. Trả về tất cả presets có thumbnail (bất kỳ cột thumbnail nào không null).\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/thumbnails\n```\n\n**Query Parameters:**\n- Không có query parameters. Endpoint trả về tất cả presets có thumbnail.\n\n**Lưu ý:** Endpoint này query từ bảng `presets` với điều kiện `thumbnail_r2` không null và không rỗng. Dữ liệu thumbnail được lưu dưới dạng JSON object trong trường `thumbnail_r2`.\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"thumbnails\": [\n      {\n        \"id\": \"fs_wonder_f_3\",\n        \"ext\": \"png\",\n        \"thumbnail_r2\": \"{\\\"webp_1x\\\":\\\"webp_1x/fs_wonder_f_3.webp\\\",\\\"lottie_1x\\\":\\\"lottie_1x/fs_wonder_f_3.json\\\",\\\"lottie_avif_2x\\\":\\\"lottie_avif_2x/fs_wonder_f_3.json\\\"}\",\n        \"thumbnail_url\": \"https://resources.d.shotpix.app/webp_1x/fs_wonder_f_3.webp\",\n        \"thumbnail_url_1x\": \"https://resources.d.shotpix.app/webp_1x/fs_wonder_f_3.webp\",\n        \"thumbnail_url_1_5x\": null,\n        \"thumbnail_url_2x\": null,\n        \"thumbnail_url_3x\": null,\n        \"thumbnail_url_4x\": null,\n        \"created_at\": \"2024-01-01T00:00:00.000Z\"\n      }\n    ]\n  },\n  \"status\": \"success\",\n  \"message\": \"Thumbnails retrieved successfully\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Response trả về tất cả các cột thumbnail resolution (1x, 1.5x, 2x, 3x) từ database. `thumbnail_url` là alias của `thumbnail_url_1x` cho backward compatibility.\n\n---\n\n#### 4.9. GET `/thumbnails/{id}/preset` - Lấy preset_id từ thumbnail_id\n\n**Mục đích:** Lấy preset_id từ thumbnail_id (dùng cho mobile app).\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/thumbnails/preset_1234567890_abc123/preset\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"preset_id\": \"preset_1234567890_abc123\"\n  },\n  \"status\": \"success\",\n  \"message\": \"Preset ID retrieved successfully\",\n  \"code\": 200\n}\n```\n\n---\n\n#### 4.10. Thumbnail URL Rules - Quy tắc URL Thumbnail\n\n**Mục đích:** Tài liệu chi tiết về cấu trúc URL và quy tắc đặt tên cho thumbnails trong hệ thống.\n\n**Cấu trúc URL Thumbnail:**\n\nThumbnails được lưu trữ trong R2 bucket với cấu trúc path như sau:\n\n```\npreset_thumb/{folderType}_{resolution}/{presetId}.{ext}\n```\n\n**Format URL đầy đủ:**\n\n```\nhttps://resources.d.shotpix.app/{bucket-name}/preset_thumb/{folderType}_{resolution}/{presetId}.{ext}\n```\n\n**Ví dụ:**\n\n```\nhttps://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\nhttps://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_avif_2x/fs_wonder_f_3.json\nhttps://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/webp_4x/preset_1234567890_abc123.webp\n```\n\n**Folder Types (Loại thư mục):**\n\n| Folder Type | Mô tả | Extension | Content Type |\n|-------------|-------|-----------|--------------|\n| `webp` | WebP image format | `.webp` | `image/webp` |\n| `lottie` | Lottie animation JSON | `.json` | `application/json` |\n| `lottie_avif` | Lottie animation với AVIF optimization | `.json` | `application/json` |\n\n**Resolutions (Độ phân giải):**\n\n| Resolution | Mô tả | Use Case |\n|------------|-------|----------|\n| `1x` | Base resolution | Standard displays |\n| `1.5x` | 1.5x resolution | Retina displays (1.5x) |\n| `2x` | 2x resolution | Retina displays (2x) |\n| `3x` | 3x resolution | High-DPI displays (3x) |\n| `4x` | 4x resolution | Ultra high-DPI displays (4x) |\n\n**Folder Naming Convention (Quy tắc đặt tên thư mục):**\n\nFormat: `{folderType}_{resolution}`\n\n**Tất cả các folder types và resolutions được hỗ trợ:**\n\n- `webp_1x`, `webp_1.5x`, `webp_2x`, `webp_3x`, `webp_4x`\n- `lottie_1x`, `lottie_1.5x`, `lottie_2x`, `lottie_3x`, `lottie_4x`\n- `lottie_avif_1x`, `lottie_avif_1.5x`, `lottie_avif_2x`, `lottie_avif_3x`, `lottie_avif_4x`\n\n**Tổng cộng: 15 folder types × resolutions**\n\n**File Naming Convention (Quy tắc đặt tên file):**\n\nFormat: `{presetId}.{ext}`\n\n- `presetId`: ID của preset (ví dụ: `fs_frosted_window_portrait_f_4`, `preset_1234567890_abc123`)\n- `ext`: Extension dựa trên folder type:\n  - `webp` → `.webp`\n  - `lottie` → `.json`\n  - `lottie_avif` → `.json`\n\n**Ví dụ file names:**\n\n- `fs_frosted_window_portrait_f_4.json` (lottie thumbnail)\n- `fs_wonder_f_3.webp` (webp thumbnail)\n- `preset_1234567890_abc123.json` (lottie_avif thumbnail)\n\n**Database Storage (Lưu trữ trong Database):**\n\nThumbnails được lưu trong bảng `presets` với trường `thumbnail_r2` dạng JSON:\n\n```json\n{\n  \"webp_1x\": \"preset_thumb/webp_1x/fs_frosted_window_portrait_f_4.webp\",\n  \"webp_1.5x\": \"preset_thumb/webp_1.5x/fs_frosted_window_portrait_f_4.webp\",\n  \"webp_2x\": \"preset_thumb/webp_2x/fs_frosted_window_portrait_f_4.webp\",\n  \"webp_3x\": \"preset_thumb/webp_3x/fs_frosted_window_portrait_f_4.webp\",\n  \"webp_4x\": \"preset_thumb/webp_4x/fs_frosted_window_portrait_f_4.webp\",\n  \"lottie_1x\": \"preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_1.5x\": \"preset_thumb/lottie_1.5x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_2x\": \"preset_thumb/lottie_2x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_3x\": \"preset_thumb/lottie_3x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_4x\": \"preset_thumb/lottie_4x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_avif_1x\": \"preset_thumb/lottie_avif_1x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_avif_1.5x\": \"preset_thumb/lottie_avif_1.5x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_avif_2x\": \"preset_thumb/lottie_avif_2x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_avif_3x\": \"preset_thumb/lottie_avif_3x/fs_frosted_window_portrait_f_4.json\",\n  \"lottie_avif_4x\": \"preset_thumb/lottie_avif_4x/fs_frosted_window_portrait_f_4.json\"\n}\n```\n\n**Key trong JSON = `{folderType}_{resolution}`**\n**Value trong JSON = R2 key (full path từ root)**\n\n**Cách xây dựng URL từ R2 key:**\n\n1. Lấy R2 key từ database: `preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json`\n2. Kết hợp với R2 public domain: `https://resources.d.shotpix.app/{bucket-name}/{r2Key}`\n3. Kết quả: `https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json`\n\n**Lưu ý quan trọng:**\n\n1. **Không có duplicate folders:** URL không bao giờ có dạng `preset_thumb/lottie_1x/lottie_1x/` (folder name bị lặp). Format đúng là `preset_thumb/lottie_1x/{presetId}.json`.\n\n2. **Preset ID extraction:** Preset ID được extract từ filename (basename), không bao gồm path. Ví dụ:\n   - File: `lottie_1x/fs_frosted_window_portrait_f_4.json`\n   - Preset ID: `fs_frosted_window_portrait_f_4` (không phải `lottie_1x/fs_frosted_window_portrait_f_4`)\n\n3. **Bucket name:** Bucket name khác nhau theo environment:\n   - Development: `faceswap-images-office-dev`\n   - Production: `faceswap-images-office-prod`\n   - Default: `faceswap-images-office`\n\n4. **R2 Public Domain:** Luôn sử dụng `https://resources.d.shotpix.app` cho public URLs.\n\n5. **Cache Control:** Tất cả thumbnails có cache control header: `public, max-age=31536000, immutable` (1 năm).\n\n**Ví dụ sử dụng trong code:**\n\n**JavaScript/TypeScript:**\n```javascript\n// Lấy thumbnail URL từ database response\nconst preset = {\n  id: \"fs_frosted_window_portrait_f_4\",\n  thumbnail_r2: '{\"lottie_1x\":\"preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\"}'\n};\n\nconst thumbnailData = JSON.parse(preset.thumbnail_r2);\nconst r2Key = thumbnailData['lottie_1x']; // \"preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\"\nconst bucketName = \"faceswap-images-office-dev\";\nconst publicUrl = `https://resources.d.shotpix.app/${bucketName}/${r2Key}`;\n// Result: https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\n```\n\n**Mobile App (Swift/Kotlin):**\n```swift\n// Swift example\nlet thumbnailData = try JSONDecoder().decode([String: String].self, from: preset.thumbnailR2.data(using: .utf8)!)\nif let r2Key = thumbnailData[\"lottie_1x\"] {\n    let bucketName = \"faceswap-images-office-dev\"\n    let publicUrl = \"https://resources.d.shotpix.app/\\(bucketName)/\\(r2Key)\"\n    // Use publicUrl to load thumbnail\n}\n```\n\n**Best Practices:**\n\n1. **Fallback resolution:** Luôn có fallback khi resolution không tồn tại:\n   ```javascript\n   const thumbnailUrl = \n     thumbnailData['lottie_4x'] || \n     thumbnailData['lottie_3x'] || \n     thumbnailData['lottie_2x'] || \n     thumbnailData['lottie_1x'] || \n     thumbnailData['webp_4x'] || \n     thumbnailData['webp_1x'];\n   ```\n\n2. **Format preference:** Ưu tiên format theo thứ tự:\n   - Lottie AVIF (tối ưu nhất cho animation)\n   - Lottie (standard animation)\n   - WebP (static image fallback)\n\n3. **Resolution selection:** Chọn resolution dựa trên device pixel ratio:\n   - 1x devices: `1x` hoặc `1.5x`\n   - 2x devices (Retina): `2x` hoặc `3x`\n   - 3x+ devices (Super Retina): `3x` hoặc `4x`\n\n4. **Error handling:** Luôn kiểm tra URL tồn tại trước khi sử dụng:\n   ```javascript\n   if (thumbnailUrl && thumbnailUrl.startsWith('https://')) {\n     // Safe to use\n   }\n   ```\n\n---\n\n### 5. Hệ thống & Cấu hình\n\n#### 5.1. GET `/config` - Lấy config\n\n**Mục đích:** Lấy cấu hình public của Worker (custom domains).\n\n**Authentication:** Không yêu cầu API key.\n\n**Request:**\n```bash\ncurl https://api.d.shotpix.app/config\n```\n\n**Response:**\n```json\n{\n  \"data\": {\n    \"backendDomain\": \"https://api.d.shotpix.app\",\n    \"r2Domain\": \"https://resources.d.shotpix.app\",\n    \"kvCache\": {\n      \"available\": true,\n      \"test\": \"success\",\n      \"details\": {\n        \"bindingName\": \"PROMPT_CACHE_KV\",\n        \"envKeys\": [\"PROMPT_CACHE_KV_BINDING_NAME\", \"...\"]\n      }\n    }\n  },\n  \"status\": \"success\",\n  \"message\": \"Config retrieved successfully\",\n  \"code\": 200\n}\n```\n\n---\n\n#### 5.2. OPTIONS `/*` - CORS preflight requests\n\n**Mục đích:** Xử lý CORS preflight requests cho tất cả các endpoints. Tự động được gọi bởi trình duyệt khi thực hiện cross-origin requests.\n\n**Authentication:** Không yêu cầu API key.\n\n**Response:**\n\nTrả về HTTP 204 (No Content) với các headers CORS:\n- `Access-Control-Allow-Origin`: Cho phép tất cả origins\n- `Access-Control-Allow-Methods`: GET, POST, PUT, DELETE, OPTIONS\n- `Access-Control-Allow-Headers`: Content-Type, Authorization, X-API-Key, và các headers khác\n- `Access-Control-Max-Age`: 86400 (24 giờ)\n\nEndpoint `/upload-proxy/*` có hỗ trợ thêm method PUT trong CORS headers.\n\n---\n\n## 6. Thanh toán & Subscription (Google Play Billing)\n\nHệ thống điểm kép (dual credit):\n- **Subscription points** (`sub_point_remaining`): reset mỗi 30 ngày theo chu kỳ subscription, trừ trước\n- **Consumable points** (`consumable_point_remaining`): mua thêm, không bao giờ reset, trừ sau khi sub hết\n\n### Luồng tổng quan\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│  1. User mua subscription trên Google Play                      │\n│  2. App nhận purchaseToken → gọi POST /api/subscription/verify  │\n│  3. Backend verify với Google Play API → kích hoạt subscription  │\n│  4. Backend gán sub_point_remaining = points_per_cycle           │\n│                                                                  │\n│  Sau đó (tự động, không cần app gọi):                           │\n│  5. Google Play gửi RTDN qua Pub/Sub → POST /webhooks/google    │\n│     - RENEWED(2): reset sub points, cycle+1                     │\n│     - IN_GRACE(6): status=GRACE, vẫn reset sub points           │\n│     - RECOVERED(1): status=ACTIVE, giữ nguyên points            │\n│     - EXPIRED(13): chặn hoàn toàn, sub points = 0               │\n│  6. Backend gửi FCM silent push → app sync trạng thái mới       │\n│                                                                  │\n│  Khi user dùng AI feature:                                       │\n│  7. Backend lazy-check subscription + trừ sub trước, consumable  │\n│     sau (real-time, không cron)                                  │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n### Cấu hình\n\n- `ENABLE_CREDIT_SYSTEM`: `\"true\"` để bật hệ thống credit (mặc định `\"false\"`)\n- `CREDIT_COST_*`: Chi phí cho từng action (FACESWAP, BACKGROUND, ENHANCE, BEAUTY, FILTER, RESTORE, AGING, UPSCALER4K)\n- `TIER_MULTIPLIER_*`: Hệ số theo tier (FREE=1.0, SUBSCRIBER=0.8)\n\n### Subscription SKUs\n\n| SKU | Điểm/chu kỳ (30 ngày) | Giá |\n|-----|----------------------|-----|\n| `sub_monthly` | 1000 | 99,000 VND/tháng |\n| `sub_semi_annual` | 1200 | 499,000 VND/6 tháng |\n| `sub_annual` | 1500 | 899,000 VND/năm |\n\n### Consumable SKUs\n\n| SKU | Điểm | Giá |\n|-----|------|-----|\n| `credits_10` | 10 | 22,000 VND |\n| `credits_50` | 50 | 99,000 VND |\n| `credits_100` | 100 | 176,000 VND |\n| `credits_500` | 500 | 770,000 VND |\n\n### Endpoints\n\n#### GET `/api/products` - Danh sách sản phẩm\n\n**Auth:** API Key\n\n```json\n// Response\n{\n  \"data\": [\n    {\n      \"sku\": \"credits_10\",\n      \"type\": \"consumable\",\n      \"credits\": 10,\n      \"points_per_cycle\": 0,\n      \"name\": \"10 Credits\",\n      \"description\": \"Gói 10 credits\",\n      \"price_micros\": 22000000000,\n      \"currency\": \"VND\"\n    },\n    {\n      \"sku\": \"sub_monthly\",\n      \"type\": \"subscription\",\n      \"credits\": 0,\n      \"points_per_cycle\": 1000,\n      \"name\": \"Monthly\",\n      \"description\": \"Gói tháng - 1000 điểm/chu kỳ\",\n      \"price_micros\": 99000000000,\n      \"currency\": \"VND\"\n    }\n  ],\n  \"status\": \"success\",\n  \"code\": 200\n}\n```\n\n#### GET `/api/user/balance?profile_id={id}` - Số dư điểm kép + trạng thái subscription\n\n**Auth:** API Key\n\n```json\n// Response\n{\n  \"data\": {\n    \"sub_point_remaining\": 800,\n    \"consumable_point_remaining\": 50,\n    \"total_available\": 850,\n    \"subscription_status\": \"ACTIVE\",\n    \"total_credits_purchased\": 100,\n    \"total_credits_spent\": 50\n  },\n  \"status\": \"success\",\n  \"code\": 200\n}\n```\n\n`subscription_status`: `ACTIVE` | `GRACE` | `CANCELLED` | `EXPIRED` | `PAUSED` | `NONE`\n\n#### POST `/api/deposit` - Nạp consumable points (verify Google Play purchase)\n\n**Auth:** API Key\n\nMua consumable → điểm vào `consumable_point_remaining` (không bao giờ reset).\n\n```json\n// Request\n{\n  \"profile_id\": \"abc123\",\n  \"sku\": \"credits_50\",\n  \"purchase_token\": \"google-play-purchase-token\",\n  \"order_id\": \"GPA.1234-5678-9012\"\n}\n\n// Response (success)\n{\n  \"data\": {\n    \"payment_id\": \"pay_xxx\",\n    \"credits_granted\": 50,\n    \"status\": \"COMPLETED\"\n  },\n  \"status\": \"success\",\n  \"code\": 200\n}\n```\n\n**Lưu ý:** Idempotent theo `order_id` - gọi lại với cùng order_id sẽ trả kết quả cũ.\n\n#### GET `/api/deposit/status/{order_id}` - Kiểm tra trạng thái nạp\n\n**Auth:** API Key\n\n```json\n// Response\n{\n  \"data\": {\n    \"id\": \"pay_xxx\",\n    \"profile_id\": \"abc123\",\n    \"sku\": \"credits_50\",\n    \"order_id\": \"GPA.1234-5678-9012\",\n    \"status\": \"COMPLETED\",\n    \"credits_granted\": 50\n  },\n  \"status\": \"success\",\n  \"code\": 200\n}\n```\n\n#### POST `/api/subscription/verify` - Kích hoạt subscription (app gọi sau khi mua trên Google Play)\n\n**Auth:** API Key\n\n**Luồng:** User mua subscription trên Google Play → app nhận `purchaseToken` → app gọi endpoint này → backend verify với Google Play API → kích hoạt + gán `sub_point_remaining = points_per_cycle`.\n\n```json\n// Request\n{\n  \"profile_id\": \"abc123\",\n  \"sku\": \"sub_monthly\",\n  \"purchase_token\": \"google-play-subscription-token\"\n}\n\n// Response\n{\n  \"data\": {\n    \"subscription_id\": \"sub_xxx\",\n    \"points_per_cycle\": 1000,\n    \"expires_at\": 1742592000,\n    \"status\": \"ACTIVE\"\n  },\n  \"status\": \"success\",\n  \"code\": 200\n}\n```\n\n#### GET `/api/subscription/status?profile_id={id}` - Trạng thái subscription hiện tại\n\n**Auth:** API Key\n\n```json\n// Response\n{\n  \"data\": {\n    \"id\": \"sub_xxx\",\n    \"sku\": \"sub_monthly\",\n    \"status\": \"ACTIVE\",\n    \"auto_renewing\": 1,\n    \"expires_at\": 1742592000,\n    \"last_reset_at\": 1740000000,\n    \"cycle_count_used\": 3,\n    \"points_per_cycle\": 1000,\n    \"cancelled_at\": null\n  },\n  \"status\": \"success\",\n  \"code\": 200\n}\n```\n\n#### POST `/webhooks/google` - Google Play RTDN Webhook\n\n**Auth:** Shared secret (`GOOGLE_WEBHOOK_SECRET`)\n\nNhận thông báo từ Google Play qua Pub/Sub (RTDN). App **KHÔNG** gọi endpoint này — Google gọi tự động.\n\n**Subscription events được xử lý:**\n\n| Type | Event | Hành động |\n|------|-------|-----------|\n| 2 | RENEWED | status=ACTIVE, reset sub=points_per_cycle, cycle+1 |\n| 6 | IN_GRACE_PERIOD | status=GRACE, reset sub=points_per_cycle, cycle+1 |\n| 1 | RECOVERED | status=ACTIVE, KHÔNG reset, KHÔNG đổi cycle |\n| 3 | CANCELED | status=CANCELLED, auto_renewing=0 |\n| 13 | EXPIRED | status=EXPIRED, sub_point_remaining=0 |\n| 12 | REVOKED | status=EXPIRED, sub_point_remaining=0 |\n| 10 | PAUSED | status=PAUSED |\n\n**One-time product events:**\n- Refund (type 2): trừ `consumable_point_remaining` (clamp to 0)\n\n### Trừ điểm trong AI Endpoints (Dual Credit Deduction)\n\nKhi `ENABLE_CREDIT_SYSTEM=true`, mỗi AI endpoint tự động trừ điểm theo 5 bước:\n\n1. **Check subscription** — expired → REJECT\n2. **Grace hết hạn?** — now > expires_at → mark expired → REJECT\n3. **Lazy reset** — (chỉ ACTIVE) nếu now ≥ last_reset_at + 30 ngày → reset sub = points_per_cycle\n4. **Fail fast** — sub + consumable < cost → REJECT (HTTP 402)\n5. **Trừ điểm** — sub trước, hết sub thì trừ consumable\n\nNếu AI xử lý lỗi → hoàn điểm vào `consumable_point_remaining` (saga compensation).\n\nChi phí = `CREDIT_COST_*` × `TIER_MULTIPLIER_*`\n\n### Tiers\n\n| Tier | Multiplier mặc định | Mô tả |\n|------|---------------------|-------|\n| free | 1.0 | Không có subscription |\n| subscriber | 0.8 | Có subscription đang active/grace |\n\n---\n\n## Tổng kết\n\n**Tổng số API endpoints: 33**\n\nXem danh sách đầy đủ tại [APIs cần tích hợp với mobile](#apis-cần-tích-hợp-với-mobile-15-apis) ở đầu tài liệu.\n\n---\n\n## Custom Domain\n\n- **Worker API Domain**: `https://api.d.shotpix.app` - Dùng cho tất cả API endpoints\n- **R2 Public Domain**: `https://resources.d.shotpix.app` - Dùng cho public URLs của files trong R2 bucket\n- Format R2 public URL: `https://resources.d.shotpix.app/{bucket-name}/{key}`\n",
      "CREDIT_SYSTEM_DIAGRAMS.md": "# Sơ Đồ Hệ Thống Điểm & Subscription\n\n> **Nguồn Google Play chính thức:**\n> [Integrate Billing Library](https://developer.android.com/google/play/billing/integrate) |\n> [Backend Integration](https://developer.android.com/google/play/billing/backend) |\n> [RTDN Reference](https://developer.android.com/google/play/billing/rtdn-reference) |\n> [Subscription Lifecycle](https://developer.android.com/google/play/billing/lifecycle)\n\n---\n\n## LUỒNG 0: MUA & KÍCH HOẠT (CLIENT → BACKEND → GOOGLE)\n\n> **Theo Google docs:** App nhận `purchaseToken` sau khi user mua → gửi token lên backend để verify.\n> Xem: [Integrate - Process purchases](https://developer.android.com/google/play/billing/integrate#process),\n> [Backend - Verify purchases](https://developer.android.com/google/play/billing/backend)\n\n```\n═══════════════════════════════════════════════════════════════════════════════\n  LUỒNG 0A: MUA SUBSCRIPTION\n═══════════════════════════════════════════════════════════════════════════════\n\n  ┌──────────┐      ┌──────────────┐      ┌──────────────┐      ┌──────────┐\n  │  USER    │      │  GOOGLE PLAY │      │   BACKEND    │      │  GOOGLE  │\n  │  (App)   │      │  (trên máy)  │      │  (Worker)    │      │  API     │\n  └────┬─────┘      └──────┬───────┘      └──────┬───────┘      └────┬─────┘\n       │                   │                      │                   │\n       │  1. Chọn gói      │                      │                   │\n       │  sub_monthly      │                      │                   │\n       │──────────────────>│                      │                   │\n       │                   │                      │                   │\n       │  2. Thanh toán    │                      │                   │\n       │  Google xử lý     │                      │                   │\n       │<──────────────────│                      │                   │\n       │  purchaseToken ←──│                      │                   │\n       │                   │                      │                   │\n       │  3. POST /api/subscription/verify        │                   │\n       │  { profile_id, sku, purchase_token }     │                   │\n       │─────────────────────────────────────────>│                   │\n       │                                          │                   │\n       │                                          │  4. Verify token  │\n       │                                          │──────────────────>│\n       │                                          │  valid ✓          │\n       │                                          │<──────────────────│\n       │                                          │                   │\n       │                                          │  5. Acknowledge   │\n       │                                          │──────────────────>│\n       │                                          │                   │\n       │                                          │  6. DB update:    │\n       │                                          │  subscription:    │\n       │                                          │    status=ACTIVE  │\n       │                                          │    points_per_    │\n       │                                          │    cycle=1000     │\n       │                                          │    last_reset=now │\n       │                                          │  profile:         │\n       │                                          │    sub_point=1000 │\n       │                                          │                   │\n       │  7. Response: { status: ACTIVE,          │                   │\n       │     points_per_cycle: 1000 }             │                   │\n       │<─────────────────────────────────────────│                   │\n       │                                          │                   │\n       │  8. App cập nhật UI                      │                   │\n       │                                          │                   │\n\n═══════════════════════════════════════════════════════════════════════════════\n  LUỒNG 0B: MUA CONSUMABLE\n═══════════════════════════════════════════════════════════════════════════════\n\n  ┌──────────┐      ┌──────────────┐      ┌──────────────┐      ┌──────────┐\n  │  USER    │      │  GOOGLE PLAY │      │   BACKEND    │      │  GOOGLE  │\n  │  (App)   │      │  (trên máy)  │      │  (Worker)    │      │  API     │\n  └────┬─────┘      └──────┬───────┘      └──────┬───────┘      └────┬─────┘\n       │                   │                      │                   │\n       │  1. Mua credits_50│                      │                   │\n       │──────────────────>│                      │                   │\n       │                   │                      │                   │\n       │  2. purchaseToken │                      │                   │\n       │<──────────────────│                      │                   │\n       │                   │                      │                   │\n       │  3. POST /api/deposit                    │                   │\n       │  { profile_id, sku, purchase_token,      │                   │\n       │    order_id }                            │                   │\n       │─────────────────────────────────────────>│                   │\n       │                                          │  4. Verify        │\n       │                                          │──────────────────>│\n       │                                          │  5. Acknowledge   │\n       │                                          │──────────────────>│\n       │                                          │                   │\n       │                                          │  6. DB:           │\n       │                                          │  consumable += 50 │\n       │                                          │                   │\n       │  7. { credits_granted: 50 }              │                   │\n       │<─────────────────────────────────────────│                   │\n       │                                          │                   │\n\n═══════════════════════════════════════════════════════════════════════════════\n  LUỒNG 0C: WEBHOOK RTDN (GOOGLE → BACKEND → APP qua FCM)\n  Sau khi subscription đã active, các event tiếp theo Google gửi tự động\n═══════════════════════════════════════════════════════════════════════════════\n\n  ┌──────────┐      ┌──────────────┐      ┌──────────────┐\n  │  APP     │      │  GOOGLE PLAY │      │   BACKEND    │\n  │  (FCM)   │      │  (Pub/Sub)   │      │  (Worker)    │\n  └────┬─────┘      └──────┬───────┘      └──────┬───────┘\n       │                   │                      │\n       │                   │  1. RTDN event       │\n       │                   │  (RENEWED/GRACE/     │\n       │                   │   EXPIRED/etc)       │\n       │                   │─────────────────────>│\n       │                   │  POST /webhooks/     │\n       │                   │  google              │\n       │                   │                      │\n       │                   │                      │  2. Cập nhật DB\n       │                   │                      │  (status, points,\n       │                   │                      │   cycle, etc)\n       │                   │                      │\n       │  3. FCM silent push                      │\n       │  { type: \"subscription_update\",          │\n       │    status: \"RENEWED\" }                   │\n       │<─────────────────────────────────────────│\n       │                   │                      │\n       │  4. App nhận FCM  │                      │\n       │  → gọi GET /api/  │                      │\n       │  user/balance để  │                      │\n       │  sync UI          │                      │\n       │                   │                      │\n```\n\n---\n\n## TOÀN BỘ LUỒNG SAU KHI ĐÃ KÍCH HOẠT (ASCII)\n\n```\n                        ┌─────────────────────────────┐\n                        │   SUBSCRIPTION ĐÃ ACTIVE    │\n                        │   (sau luồng 0A ở trên)     │\n                        └──────────────┬──────────────┘\n                                       │\n                                       ▼\n                  ┌─────────────────────────────────────────┐\n                  │            TRẠNG THÁI HIỆN TẠI          │\n                  │                                         │\n                  │  subscription:                          │\n                  │    status = active                      │\n                  │    sub_point_remaining = points_per_cycle│\n                  │    last_reset_at = now                  │\n                  │    end_date = now + 30 ngày             │\n                  │    cycle_count_used = 1                 │\n                  │                                         │\n                  │  profile:                               │\n                  │    consumable_point_remaining = 0       │\n                  │    (tăng khi mua thêm, không bao giờ   │\n                  │     reset, không phụ thuộc subscription)│\n                  └──────────────────┬──────────────────────┘\n                                     │\n          ┌──────────────────────────┼──────────────────────────┐\n          │                          │                          │\n          ▼                          ▼                          ▼\n┌──────────────────┐   ┌──────────────────────┐   ┌──────────────────────┐\n│ USER DÙNG ĐIỂM  │   │ GOOGLE PLAY GỬI RTDN │   │ USER MUA CONSUMABLE  │\n│ (xem luồng bên  │   │ (xem luồng bên dưới) │   │ (luồng 0B ở trên)   │\n│  dưới)           │   │                       │   │ consumable += N      │\n└──────────────────┘   └───────────────────────┘   └──────────────────────┘\n\n\n═══════════════════════════════════════════════════════════════════════════════\n  LUỒNG 1: GOOGLE PLAY RTDN → CẬP NHẬT TRẠNG THÁI\n═══════════════════════════════════════════════════════════════════════════════\n\n                         Hết chu kỳ 30 ngày\n                         Google Play tính phí\n                                 │\n                    ┌────────────┴────────────┐\n                    │                         │\n               Tính phí OK              Tính phí LỖI\n                    │                         │\n                    ▼                         ▼\n  ┌──────────────────────────┐  ┌──────────────────────────────┐\n  │ (2) SUBSCRIPTION_RENEWED │  │(6) SUBSCRIPTION_IN_GRACE_    │\n  │                          │  │    PERIOD                    │\n  │ status = active          │  │                              │\n  │ end_date += 30 ngày      │  │ status = grace               │\n  │ sub = points_per_cycle   │  │ end_date += 30 ngày          │\n  │ last_reset_at = now      │  │ sub = points_per_cycle ←RESET│\n  │ cycle_count_used += 1    │  │ last_reset_at = now          │\n  │                          │  │ cycle_count_used += 1        │\n  │ → RESET điểm             │  │                              │\n  │ → chu kỳ mới             │  │ → VẪN RESET điểm            │\n  │ → tiếp tục bình thường   │  │ → chu kỳ mới (tính đã dùng) │\n  └────────────┬─────────────┘  │ → user vẫn dùng được điểm   │\n               │                └──────────────┬───────────────┘\n               │                               │\n               │                    ┌──────────┴──────────┐\n               │                    │                     │\n               │               Retry OK            Grace hết,\n               │               trong grace         vẫn chưa trả\n               │                    │                     │\n               │                    ▼                     ▼\n               │  ┌───────────────────────┐  ┌────────────────────────┐\n               │  │(1) SUBSCRIPTION_      │  │(5) SUBSCRIPTION_       │\n               │  │    RECOVERED          │  │    ON_HOLD             │\n               │  │                       │  │                        │\n               │  │ status = active       │  │ status = on_hold       │\n               │  │ KHÔNG reset sub       │  │ sub_point = 0 ← MẤT   │\n               │  │ KHÔNG đổi last_reset  │  │ user MẤT quyền truy   │\n               │  │ KHÔNG đổi cycle       │  │ cập NGAY LẬP TỨC      │\n               │  │                       │  │                        │\n               │  │ → giữ nguyên điểm     │  │                        │\n               │  │ → grace = đã thanh    │  └──────────┬─────────────┘\n               │  │   toán                │             │\n               │  └───────────┬───────────┘  ┌──────────┴──────────┐\n               │              │              │                     │\n               │              │         Retry OK trong       60 ngày hết,\n               │              │         account hold         vẫn chưa trả\n               │              │              │                     │\n               │              │              ▼                     ▼\n               │              │  ┌───────────────────┐  ┌────────────────────┐\n               │              │  │(1) RECOVERED      │  │(13) EXPIRED        │\n               │              │  │ từ ON_HOLD        │  │                    │\n               │              │  │                   │  │ status = expired   │\n               │              │  │ status = active   │  │ CHẶN HOÀN TOÀN    │\n               │              │  │ restore sub points│  │ sub_point = 0     │\n               │              │  └────────┬──────────┘  └────────────────────┘\n               │              │           │\n               └──────┬───────┴───────────┘\n                      │\n                      ▼\n              Quay lại đầu chu kỳ\n              (chờ 30 ngày tiếp)\n\n\n═══════════════════════════════════════════════════════════════════════════════\n  LUỒNG 2: USER DÙNG N ĐIỂM → XỬ LÝ REAL-TIME (KHÔNG CRON)\n═══════════════════════════════════════════════════════════════════════════════\n\n                      User yêu cầu dùng N điểm\n                                 │\n                                 ▼\n                ┌────────────────────────────────┐\n                │  BƯỚC 1: Kiểm tra status       │\n                └───────────────┬────────────────┘\n                                │\n              ┌─────────────────┼─────────────────┐\n              │                 │                  │\n           expired         active              grace\n              │                 │                  │\n              ▼                 │                  ▼\n        ╔═══════════╗          │    ┌──────────────────────────┐\n        ║  REJECT   ║          │    │ BƯỚC 2: Grace hết hạn?  │\n        ║  hết hạn  ║          │    │ now > end_date ?         │\n        ╚═══════════╝          │    └─────────────┬────────────┘\n                               │           ┌──────┴──────┐\n                               │           │             │\n                               │         CÓ (hết)    KHÔNG (còn)\n                               │           │             │\n                               │           ▼             │\n                               │    ╔═══════════╗       │\n                               │    ║  REJECT   ║       │\n                               │    ║→ expired  ║       │\n                               │    ╚═══════════╝       │\n                               │                        │\n                               └───────────┬────────────┘\n                                           │\n                                           ▼\n                          ┌─────────────────────────────────┐\n                          │ BƯỚC 3: Lazy reset chu kỳ       │\n                          │ (CHỈ khi status = active)       │\n                          │                                 │\n                          │ now ≥ last_reset_at + 30 ngày ? │\n                          └───────────────┬─────────────────┘\n                                   ┌──────┴──────┐\n                                   │             │\n                                 CÓ           KHÔNG\n                                   │             │\n                                   ▼             │\n                          ┌──────────────────┐   │\n                          │ sub = points_per │   │\n                          │     _cycle       │   │\n                          │ last_reset = now │   │\n                          │ cycle += 1       │   │\n                          └────────┬─────────┘   │\n                                   │             │\n                                   └──────┬──────┘\n                                          │\n                                          ▼\n                          ┌────────────────────────────────┐\n                          │ BƯỚC 4: FAIL FAST              │\n                          │                                │\n                          │ total = sub + consumable       │\n                          │ total ≥ N ?                    │\n                          └───────────────┬────────────────┘\n                                   ┌──────┴──────┐\n                                   │             │\n                               KHÔNG            CÓ\n                                   │             │\n                                   ▼             ▼\n                          ╔═══════════╗  ┌──────────────────────┐\n                          ║  REJECT   ║  │ BƯỚC 5: Trừ điểm    │\n                          ║ không đủ  ║  │ (sub trước,          │\n                          ╚═══════════╝  │  consumable sau)     │\n                                         └──────────┬───────────┘\n                                              ┌─────┴─────┐\n                                              │           │\n                                         sub ≥ N      sub < N\n                                              │           │\n                                              ▼           ▼\n                                     ┌────────────┐ ┌─────────────────┐\n                                     │ sub -= N   │ │ dư = N - sub    │\n                                     │            │ │ sub = 0         │\n                                     │            │ │ consumable -= dư│\n                                     └─────┬──────┘ └────────┬────────┘\n                                           │                 │\n                                           └────────┬────────┘\n                                                    │\n                                                    ▼\n                                           ╔═══════════════╗\n                                           ║  ACCEPT  ✓    ║\n                                           ╚═══════════════╝\n```\n\n---\n\n## TOÀN BỘ LUỒNG (MERMAID)\n\n```mermaid\nflowchart TD\n    SIGNUP([\"Người dùng đăng ký subscription\"])\n    SIGNUP --> PLAN{\"Chọn gói?\"}\n    PLAN -->|\"Gói tháng\"| INIT[\"points_per_cycle = 1000\"]\n    PLAN -->|\"Gói 6 tháng\"| INIT2[\"points_per_cycle = 1200\"]\n    PLAN -->|\"Gói năm\"| INIT3[\"points_per_cycle = 1500\"]\n    INIT --> INITDB\n    INIT2 --> INITDB\n    INIT3 --> INITDB\n\n    INITDB[\"Khởi tạo DB:<br>status=active<br>sub=points_per_cycle<br>last_reset=now<br>end_date=now+30d<br>cycle=1<br>consumable=0\"]\n\n    INITDB --> LIVE((\"HỆ THỐNG<br>ĐANG CHẠY\"))\n\n    %% ====== NHÁNH RTDN ======\n    LIVE --> RTDN_TRIGGER[\"Hết chu kỳ 30 ngày<br>Google Play tính phí\"]\n    LIVE --> USE_TRIGGER[\"User yêu cầu<br>dùng N điểm\"]\n    LIVE --> BUY_TRIGGER[\"User mua consumable\"]\n\n    BUY_TRIGGER --> BUY_OK[\"consumable += N<br>không ảnh hưởng subscription\"]\n    BUY_OK --> LIVE\n\n    RTDN_TRIGGER --> CHARGE{\"Tính phí<br>thành công?\"}\n\n    CHARGE -->|\"OK\"| RENEWED[\"(2) SUBSCRIPTION_RENEWED<br>─────────────────<br>status = active<br>sub = points_per_cycle ← RESET<br>end_date += 30d<br>last_reset = now<br>cycle += 1\"]\n\n    CHARGE -->|\"LỖI\"| IN_GRACE[\"(6) SUBSCRIPTION_IN_GRACE_PERIOD<br>─────────────────<br>status = grace<br>sub = points_per_cycle ← VẪN RESET<br>end_date += 30d<br>last_reset = now<br>cycle += 1<br>chu kỳ tính là đã dùng\"]\n\n    RENEWED --> LIVE\n\n    IN_GRACE --> GRACE_WAIT{\"Trong 30 ngày grace<br>user retry thanh toán?\"}\n\n    GRACE_WAIT -->|\"Retry OK\"| RECOVERED[\"(1) SUBSCRIPTION_RECOVERED<br>─────────────────<br>status = active<br>KHÔNG reset sub ← GIỮ NGUYÊN<br>KHÔNG đổi last_reset<br>KHÔNG đổi cycle<br>grace = đã thanh toán\"]\n\n    GRACE_WAIT -->|\"30 ngày hết<br>vẫn chưa trả\"| SUB_EXPIRED[\"(13) SUBSCRIPTION_EXPIRED<br>─────────────────<br>status = expired<br>CHẶN HOÀN TOÀN\"]\n\n    RECOVERED --> LIVE\n\n    %% ====== NHÁNH DÙNG ĐIỂM ======\n    USE_TRIGGER --> S1{\"BƯỚC 1<br>status = ?\"}\n\n    S1 -->|\"expired\"| R1[\"REJECT: hết hạn\"]\n\n    S1 -->|\"grace\"| S2{\"BƯỚC 2<br>Grace hết hạn?<br>now > end_date?\"}\n\n    S1 -->|\"active\"| S3\n\n    S2 -->|\"Hết hạn\"| R2[\"REJECT<br>cập nhật → expired\"]\n\n    S2 -->|\"Còn hạn\"| S4\n\n    S3{\"BƯỚC 3<br>Lazy reset?<br>now ≥ last_reset+30d?\"}\n\n    S3 -->|\"Cần reset\"| DO_RESET[\"sub = points_per_cycle<br>last_reset = now<br>cycle += 1\"]\n    S3 -->|\"Chưa cần\"| S4\n\n    DO_RESET --> S4\n\n    S4{\"BƯỚC 4: FAIL FAST<br>total = sub + consumable<br>total ≥ N ?\"}\n\n    S4 -->|\"Không đủ\"| R3[\"REJECT: không đủ điểm\"]\n\n    S4 -->|\"Đủ\"| S5{\"BƯỚC 5<br>sub ≥ N ?\"}\n\n    S5 -->|\"Sub đủ\"| D1[\"sub -= N\"]\n    S5 -->|\"Sub không đủ\"| D2[\"dư = N - sub<br>sub = 0<br>consumable -= dư\"]\n\n    D1 --> OK[\"ACCEPT ✓\"]\n    D2 --> OK\n    OK --> LIVE\n\n    %% ====== STYLES ======\n    style LIVE fill:#3b82f6,color:#fff,stroke-width:3px\n    style RENEWED fill:#22c55e,color:#fff\n    style RECOVERED fill:#22c55e,color:#fff\n    style IN_GRACE fill:#eab308,color:#000\n    style SUB_EXPIRED fill:#ef4444,color:#fff\n    style R1 fill:#ef4444,color:#fff\n    style R2 fill:#ef4444,color:#fff\n    style R3 fill:#ef4444,color:#fff\n    style OK fill:#22c55e,color:#fff\n    style BUY_OK fill:#a855f7,color:#fff\n```\n",
      "FCM_SETUP_COMPLETE_VI.md": "# FCM Setup Complete – Token Android / iOS / Web\n\n---\n\n## 1. Tổng quan\n\n**Luồng:** Lấy token → `POST /api/device/register` (profile_id, platform, token) → nhận push khi operation xong (faceswap/beauty/filter/…).\n\n**Đặc điểm:**\n- **Silent Push:** Không hiển thị notification bar; app xử lý data trong background.\n- **Multi-Device:** Một profile có thể có nhiều devices (phone, tablet, web).\n- **Profile-Based:** Push gửi đến tất cả devices của profile đó.\n\n---\n\n## 2. Prerequisites (client)\n\n- **Firebase project** với Android / iOS / Web app đã thêm (package name / Bundle ID / Web app trùng với app của bạn).\n- **Android:** `google-services.json` từ Firebase Console.\n- **iOS:** `GoogleService-Info.plist`; APNs key (.p8) đã upload vào Firebase (Cloud Messaging → Apple app).\n- **Web:** HTTPS; **firebaseConfig** và **VAPID** (Firebase Console hoặc deploy inject). Xem mục 6 (Web – Files và config).\n- **Profile:** `POST /api/device/register` cần `profile_id` hợp lệ (đã tạo qua API trước đó).\n\n---\n\n## 3. Lấy FCM device token – Android\n\n### 3.1 Điều kiện bắt buộc\n\n- Firebase project đã tạo; đã thêm **Android app** (package name trùng với app).\n- **google-services.json** tải từ Firebase Console (Project settings → Your apps → Android) và đặt đúng vị trí (ví dụ `android/app/google-services.json`).\n- Gradle: đã apply plugin `com.google.gms.google-services` và thêm dependency Firebase BOM + `firebase-messaging`.\n\n### 3.2 Các bước triển khai\n\n**Bước 1 – Gradle (project-level):**\n```gradle\n// build.gradle (project)\nbuildscript {\n  dependencies {\n    classpath 'com.google.gms:google-services:4.x.x'\n  }\n}\n```\n\n**Bước 2 – Gradle (app-level):**\n```gradle\n// build.gradle (app)\nplugins {\n  id 'com.android.application'\n  id 'com.google.gms.google-services'\n}\ndependencies {\n  implementation platform('com.google.firebase:firebase-bom:32.x.x')\n  implementation 'com.google.firebase:firebase-messaging'\n}\n```\n\n**Bước 3 – AndroidManifest.xml:**  \nKhai báo Service xử lý FCM (bắt buộc để nhận message và onNewToken):\n\n```xml\n<service\n    android:name=\".MyFirebaseMessagingService\"\n    android:exported=\"false\">\n  <intent-filter>\n    <action android:name=\"com.google.firebase.MESSAGING_EVENT\" />\n  </intent-filter>\n</service>\n```\n\n**Bước 4 – Lấy token (Kotlin):**\n- Gọi `Firebase.messaging.token` (coroutine) hoặc `FirebaseMessaging.getInstance().token.addOnCompleteListener`.\n- Token chỉ có sau khi Firebase đã init (sau khi app khởi động, thường ngay sau khi có google-services.json và đã build).\n\n```kotlin\n// Kotlin – lấy token (chạy sau khi user đã login / có profile_id)\nFirebaseMessaging.getInstance().token\n  .addOnCompleteListener { task ->\n    if (!task.isSuccessful) return@addOnCompleteListener\n    val token = task.result ?: return@addOnCompleteListener\n    registerDeviceToBackend(profileId = \"profile_xxx\", platform = \"android\", token = token)\n  }\n```\n\n**Bước 5 – onNewToken (bắt buộc):**  \nToken có thể đổi; mỗi khi có token mới gửi lại qua `POST /api/device/register`.\n\n```kotlin\n// MyFirebaseMessagingService.kt\nclass MyFirebaseMessagingService : FirebaseMessagingService() {\n  override fun onNewToken(token: String) {\n    super.onNewToken(token)\n    registerDeviceToBackend(profileId = currentProfileId, platform = \"android\", token = token)\n  }\n\n  override fun onMessageReceived(remoteMessage: RemoteMessage) {\n    // Chỉ nhận data payload (silent push). Không có remoteMessage.notification.\n    val data = remoteMessage.data\n    // Xử lý data: type, operation, result_id, v.v.\n  }\n}\n```\n\n**Lưu ý quan trọng:**  \n- Không lấy token trong `Application.onCreate` quá sớm; có thể dùng `Handler().postDelayed` vài trăm ms hoặc lấy sau khi user đã có profile_id.  \n- Luôn implement `onNewToken` và gửi token mới lên backend.  \n- Data-only message (backend không gửi `notification`) → luôn vào `onMessageReceived`; không hiện notification bar trừ khi app tự hiển thị.\n\n---\n\n## 4. Lấy FCM device token – iOS\n\n### 4.1 Điều kiện bắt buộc\n\n- Firebase project đã thêm **iOS app** (Bundle ID trùng với Xcode).\n- **APNs key (.p8)** đã tạo trong Apple Developer (Keys), đã upload vào Firebase (Project settings → Cloud Messaging → Apple app configuration).\n- **GoogleService-Info.plist** tải từ Firebase, thêm vào Xcode project.\n- Xcode: **Signing & Capabilities** → bật **Push Notifications** và **Background Modes** (chọn **Remote notifications**).\n- Firebase SDK (Firebase/Messaging) đã thêm qua SPM hoặc CocoaPods.\n\n### 4.2 Các bước triển khai\n\n**Bước 1 – Capabilities:**  \nTarget → Signing & Capabilities → + Capability → **Push Notifications**; thêm **Background Modes** → bật **Remote notifications**.\n\n**Bước 2 – AppDelegate / SceneDelegate:**  \nĐăng ký remote notification và set delegate cho Messaging để nhận FCM token.\n\n```swift\n// AppDelegate\nimport FirebaseCore\nimport FirebaseMessaging\nimport UserNotifications\n\n@main\nclass AppDelegate: UIResponder, UIApplicationDelegate, MessagingDelegate, UNUserNotificationCenterDelegate {\n\n  func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n    FirebaseApp.configure()\n    UNUserNotificationCenter.current().delegate = self\n    Messaging.messaging().delegate = self\n    application.registerForRemoteNotifications()\n    return true\n  }\n\n  func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {\n    Messaging.messaging().apnsToken = deviceToken\n  }\n\n  func messaging(_ messaging: Messaging, didReceiveRegistrationToken fcmToken: String?) {\n    guard let token = fcmToken else { return }\n    registerDeviceToBackend(profileId: currentProfileId, platform: \"ios\", token: token)\n  }\n}\n```\n\n**Bước 3 – Lấy token:**  \nFCM token xuất hiện trong callback `messaging(_:didReceiveRegistrationToken:)`. Callback này được gọi:\n- Sau khi `registerForRemoteNotifications` và APNs token đã được set vào Firebase (`apnsToken`).\n- Mỗi lần app mở hoặc khi token đổi.\n\nNếu cần lấy token chủ động (ví dụ sau khi login):\n\n```swift\nMessaging.messaging().token { token, error in\n  guard let token = token else { return }\n  registerDeviceToBackend(profileId: currentProfileId, platform: \"ios\", token: token)\n}\n```\n\n**Bước 4 – Silent push (data-only):**  \nBackend gửi không có `notification`, chỉ `data`; cần xử lý trong:\n\n```swift\nfunc application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any], fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -> Void) {\n  // Xử lý userInfo (data payload)\n  completionHandler(.newData)\n}\n```\n\n**Lưu ý quan trọng:**  \n- APNs key (.p8) phải được upload đúng trong Firebase (Cloud Messaging → Apple app). Thiếu hoặc sai → không có FCM token.  \n- Nếu tắt swizzling (`FirebaseAppDelegateProxyEnabled = NO`), phải tự set `Messaging.messaging().apnsToken = deviceToken` trong `didRegisterForRemoteNotificationsWithDeviceToken`.  \n- Simulator không nhận remote notification; cần device thật.  \n- Silent push cần Background Modes → Remote notifications và gọi `completionHandler(.newData)`.\n\n---\n\n## 5. Lấy FCM device token – Web\n\n### 5.1 Điều kiện bắt buộc\n\n- **HTTPS** (service worker chỉ chạy trên HTTPS).\n- **firebaseConfig** và **VAPID** — mục 6.\n\n### 5.2 Các bước triển khai\n\n**Bước 1 – Thêm Firebase SDK và khởi tạo:**\n```html\n<script type=\"module\">\n  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.x.x/firebase-app.js';\n  import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.x.x/firebase-messaging.js';\n\n  const firebaseConfig = { apiKey: \"...\", authDomain: \"...\", projectId: \"...\", storageBucket: \"...\", messagingSenderId: \"...\", appId: \"...\" };\n  const app = initializeApp(firebaseConfig);\n  const messaging = getMessaging(app);\n\u003c/script>\n```\n\n**Bước 2 – Service worker:**  \nCần **firebase-messaging-sw.js** tại root domain; import Firebase Messaging, `initializeApp(firebaseConfig)`, `onBackgroundMessage`. firebaseConfig và VAPID: mục 6.\n\n```javascript\n// firebase-messaging-sw.js (root domain)\nimportScripts('https://www.gstatic.com/firebasejs/10.x.x/firebase-app-compat.js');\nimportScripts('https://www.gstatic.com/firebasejs/10.x.x/firebase-messaging-compat.js');\nfirebase.initializeApp(/* firebaseConfig */);\nfirebase.messaging().onBackgroundMessage((payload) => {});\n```\n\n**Bước 3 – Xin quyền và lấy token:**  \n`getToken(messaging, { vapidKey })` sau khi user cho phép notification.\n\n```javascript\nconst permission = await Notification.requestPermission();\nif (permission !== 'granted') return null;\nconst token = await getToken(messaging, { vapidKey: '...' });\nif (token) {\n  await fetch(API_BASE + '/api/device/register', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ profile_id: profileId, platform: 'web', token, app_version: '1.0.0' })\n  });\n}\n```\n\n**Bước 4 – Foreground:**  \nNhận message khi tab đang mở bằng `onMessage`:\n\n```javascript\nonMessage(messaging, (payload) => {\n  console.log('Foreground message', payload);\n  const data = payload.data || {};\n  // data.type, data.operation, data.result_id, ...\n});\n```\n\n---\n\n## 6. Web – Files và config cần có\n\nĐể tích hợp FCM trên Web cần:\n\n- **Trang có logic FCM** (vd. fcm-test.html): xin quyền notification → nhập profile_id → gọi `POST /api/device/register` với token → (tùy chọn) gửi push.\n- **firebase-messaging-sw.js** — Service worker, đặt tại root domain (bắt buộc).\n- **firebaseConfig** và **VAPID** — Firebase Console → Cloud Messaging → Web Push certificates, hoặc inject lúc deploy.\n\n---\n\n## 7. API Endpoints\n\n| Method | Path | Auth | Mô tả |\n|--------|------|------|--------|\n| POST | `/api/device/register` | None | Đăng ký/cập nhật FCM token. |\n| POST | `/api/push/silent` | `X-API-Key: MOBILE_API_KEY` | Gửi data-only push theo `profile_id`. |\n| DELETE | `/api/device/unregister` | None | Xóa FCM token. |\n\n### 7.1 POST /api/device/register\n\n**Body:** `profile_id` (required), `platform` (android \\| ios \\| web), `token` (required), `app_version` (optional).\n\n**Request:**\n```json\n{\n  \"profile_id\": \"profile_1234567890\",\n  \"platform\": \"android\",\n  \"token\": \"fcm-device-token-here\",\n  \"app_version\": \"1.0.0\"\n}\n```\n\n**Response 200:** `{ \"data\": { \"registered\": true }, \"status\": \"success\", \"message\": \"Processing successful\", \"code\": 200 }`\n\n**Ví dụ:**\n```bash\ncurl -X POST https://api.d.shotpix.app/api/device/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"profile_id\":\"profile_abc123\",\"platform\":\"web\",\"token\":\"fcm-web-token-xyz\",\"app_version\":\"1.0.0\"}'\n```\n\n### 7.2 POST /api/push/silent\n\n**Auth:** `X-API-Key: MOBILE_API_KEY`\n\n**Body:** `profile_id` (required), `data` (object, values string), `exclude_token` (optional).\n\n**Request:**\n```json\n{\n  \"profile_id\": \"profile_1234567890\",\n  \"data\": {\n    \"type\": \"operation_complete\",\n    \"operation\": \"faceswap\",\n    \"status\": \"success\",\n    \"result_id\": \"result_xyz\"\n  },\n  \"exclude_token\": \"current-device-fcm-token\"\n}\n```\n\n**Response 200:** `{ \"data\": { \"sent\", \"failed\", \"cleaned\", \"results\": [...] }, \"status\": \"success\", ... }`\n\n**Ví dụ:**\n```bash\ncurl -X POST https://api.d.shotpix.app/api/push/silent \\\n  -H \"Content-Type: application/json\" \\\n  -H \"X-API-Key: your-mobile-api-key-here\" \\\n  -d '{\"profile_id\":\"profile_abc123\",\"data\":{\"type\":\"balance_sync\",\"amount\":\"100\",\"timestamp\":\"1706900000\"}}'\n```\n\n### 7.3 DELETE /api/device/unregister\n\n**Body:** `token` (required).\n\n**Request:** `{ \"token\": \"fcm-device-token-to-remove\" }`\n\n**Response 200:** `{ \"data\": { \"unregistered\": true }, \"status\": \"success\", \"message\": \"Processing successful\", \"code\": 200 }`\n\n**Ví dụ:**\n```bash\ncurl -X DELETE https://api.d.shotpix.app/api/device/unregister \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"token\":\"fcm-device-token-xyz\"}'\n```\n\n### 7.4 Auto-Push\n\nKhi thành công, các API sau tự gửi push (payload như 7.2): `/faceswap`, `/beauty`, `/filter`, `/upscaler4k`, `/background`. Payload: `type`, `operation`, `status`, `result_id`, `timestamp`. Lỗi: `status: \"error\"`, `error`.\n\n---\n\n## 8. Troubleshooting\n\n| Triệu chứng / Lỗi | Nguyên nhân có thể | Hành động |\n|-------------------|--------------------|-----------|\n| 403 PERMISSION_DENIED (Firebase Installations) | API chưa bật hoặc API key bị restrict | Bật Firebase Installations API + FCM API; Credentials → sửa firebaseConfig.apiKey. |\n| 400 INVALID_ARGUMENT (Create Installation) | firebaseConfig/appId sai | Dùng đúng firebaseConfig từ Firebase Console. |\n| applicationServerKey is not valid | Thiếu hoặc sai VAPID | Firebase Console → Cloud Messaging → Web Push certificates → lấy key, dùng đúng trong getToken. |\n| Web không nhận push | Service worker chưa đăng ký hoặc VAPID sai | DevTools → Application → Service Workers; kiểm tra VAPID và firebaseConfig trong sw. |\n| Android hiển thị notification bar | Payload có field `notification` | Chỉ dùng data-only message (không gửi `notification`). |\n| Token invalid (NOT_REGISTERED) | App gỡ, token xoay, bundle/package sai | Đăng ký lại token mới qua POST /api/device/register. |\n| iOS không có token | APNs chưa cấu hình hoặc thiếu capability | Upload .p8 vào Firebase; bật Push Notifications + Remote notifications; chạy trên device thật. |\n",
      "GOOGLE_PLAY_SETUP_VI.md": "# Hướng dẫn thiết lập Google Play Billing\n\n## Các bước cần thực hiện thủ công (one-time setup)\n\n### 1. Bật Google Play Android Developer API\n\n1. Truy cập [Google Cloud Console](https://console.cloud.google.com/)\n2. Chọn project: `gen-lang-client-0149764456`\n3. Vào **APIs & Services** > **Library**\n4. Tìm \"**Google Play Android Developer API**\"\n5. Click **Enable**\n\n### 2. Cấp quyền Service Account trong Google Play Console\n\n1. Truy cập [Google Play Console](https://play.google.com/console)\n2. Vào **Settings** > **API access**\n3. Click **Link** để liên kết project GCP (`gen-lang-client-0149764456`)\n4. Tìm service account: `uppixaiphoto@gen-lang-client-0149764456.iam.gserviceaccount.com`\n5. Click **Grant access** và cấp quyền:\n   - **Financial data**: Xem doanh thu, đơn hàng\n   - **Manage orders and subscriptions**: Quản lý đơn hàng\n6. Click **Invite user** > **Send invitation**\n7. Chờ invitation được accept (tự động nếu đã link project)\n\n### 3. Thiết lập Pub/Sub cho RTDN (Real-Time Developer Notifications)\n\n1. Trong **Google Cloud Console** > **Pub/Sub**\n2. Tạo Topic mới: `play-billing-notifications`\n3. Tạo Subscription:\n   - **Type**: Push\n   - **Endpoint URL**: `https://api.d.shotpix.app/webhooks/google`\n   - **Authentication**: Thêm header `Authorization: Bearer YOUR_WEBHOOK_SECRET`\n4. Trong **Google Play Console** > **Monetization setup** > **Real-time developer notifications**:\n   - **Topic name**: `projects/gen-lang-client-0149764456/topics/play-billing-notifications`\n   - Click **Save**\n\n### 4. Tạo In-App Products & Subscriptions trong Google Play Console\n\n1. Vào **Monetization** > **Products** > **In-app products**\n2. Tạo consumable products với các SKU:\n   - `credits_10` - 22,000 VND\n   - `credits_50` - 99,000 VND\n   - `credits_100` - 176,000 VND\n   - `credits_500` - 770,000 VND\n3. Vào **Monetization** > **Products** > **Subscriptions**\n4. Tạo subscriptions:\n   - `sub_pro_monthly` - 99,000 VND/tháng\n   - `sub_pro_yearly` - 990,000 VND/năm\n   - `sub_premium_monthly` - 199,000 VND/tháng\n   - `sub_premium_yearly` - 1,990,000 VND/năm\n\n### 5. Cập nhật Environment Variables\n\nSau khi hoàn thành các bước trên, cập nhật trong `deployments-secrets.json`:\n\n```json\n{\n  \"GOOGLE_PLAY_PACKAGE_NAME\": \"com.your.app.package\",\n  \"GOOGLE_WEBHOOK_SECRET\": \"your-random-secret-string\",\n  \"ENABLE_CREDIT_SYSTEM\": \"true\"\n}\n```\n\nSau đó deploy lại: `npm run deploy:parallel:test`\n\n### 6. Chạy Database Migration\n\nMigration file: `backend-cloudflare-workers/migrations/0008_payments_credits.sql`\n\nChạy migration: `npm run db:migrate`\n\n---\n\n## Kiểm tra\n\n1. Gọi `GET /api/products` - Phải trả về danh sách SKU\n2. Gọi `GET /api/user/balance?profile_id=xxx` - Phải trả về credits=0, tier=free\n3. Test purchase flow trên Android app với test account\n4. Kiểm tra webhook nhận notifications từ Google Play\n",
      "REQUIREMENTS.md": "# Face Swap AI - Requirements\n\n## Overview\nA minimal web application for face swapping that allows users to upload preset images, upload selfies, and generate face-swapped results. The application uses Cloudflare Workers for backend API, Cloudflare R2 for image storage, and Cloudflare D1 for database storage.\n\n## Frontend Structure\n\n### File Organization\n- `index.html` - Main HTML structure with inline CSS and JavaScript\n\n### UI Layout\n- Main workspace: Two-column grid layout\n  - Left column: Preset section (top) and Selfie section (bottom)\n  - Right column: Result image (spans both rows, large display)\n- Bottom section: Results history gallery\n- Both preset and selfie have identical UI: Upload area + Gallery for selection\n\n## UI/UX Design Guide\n\n### Design Principles\n- **Minimalism**: Remove all unnecessary elements. Every component must serve a purpose.\n- **Clarity**: Users should understand what to do without reading instructions.\n- **Efficiency**: Minimize clicks and steps to complete tasks.\n- **Consistency**: Use consistent spacing, colors, and interaction patterns throughout.\n- **Feedback**: Always provide clear visual feedback for user actions.\n\n### Layout Structure\n\n#### Main Container\n- Max width: 1200px (centered on large screens)\n- Padding: 24px on desktop, 16px on mobile\n- Background: #FFFFFF (white) or #FAFAFA (very light gray)\n- Border radius: 0px (sharp, professional edges)\n\n#### Main Workspace - Two Column Grid\n- **Layout**: CSS Grid with 2 columns\n- **Left Column** (40% width):\n  - **Preset Section** (top row):\n    - Upload area with drag & drop\n    - Gallery grid below for selecting existing presets\n    - Selected preset preview (large, prominent)\n  - **Selfie Section** (bottom row):\n    - Upload area with drag & drop (identical to preset)\n    - Gallery grid below for selecting existing selfies\n    - Selected selfie preview (large, prominent)\n  - Gap between sections: 24px\n- **Right Column** (60% width):\n  - **Result Image Display** (spans both rows):\n    - Large preview area (min-height: 600px)\n    - Shows generated face swap result\n    - Empty state: \"Result will appear here\"\n    - Centered, object-fit: contain\n- **Gap between columns**: 24px\n- **Generate Button**: Full width below the grid, centered\n\n#### Bottom Section - Results History\n- Full width grid layout\n- Responsive grid: 4 columns desktop, 3 tablets, 2 mobile\n- Gap: 16px between items\n\n### Color Palette\n\n#### Primary Colors\n- **Primary**: #2563EB (Blue 600) - Main actions, selected states\n- **Primary Hover**: #1D4ED8 (Blue 700) - Interactive elements on hover\n- **Primary Light**: #DBEAFE (Blue 100) - Subtle backgrounds\n\n#### Neutral Colors\n- **Background**: #FFFFFF (White)\n- **Surface**: #F9FAFB (Gray 50) - Card backgrounds\n- **Border**: #E5E7EB (Gray 200) - Dividers, borders\n- **Text Primary**: #111827 (Gray 900) - Main text\n- **Text Secondary**: #6B7280 (Gray 500) - Secondary text, labels\n\n#### Status Colors\n- **Success**: #10B981 (Green 500) - Success messages, completed states\n- **Error**: #EF4444 (Red 500) - Error messages, warnings\n- **Warning**: #F59E0B (Amber 500) - Warnings\n- **Info**: #3B82F6 (Blue 500) - Informational messages\n\n### Typography\n\n#### Font Family\n- **Primary**: System font stack: `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`\n- **Monospace**: `'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace` (for filenames only)\n\n#### Font Sizes\n- **H1 (Page Title)**: 28px / 1.2 line-height / 700 weight\n- **H2 (Section Title)**: 20px / 1.3 line-height / 600 weight\n- **Body**: 16px / 1.5 line-height / 400 weight\n- **Small**: 14px / 1.4 line-height / 400 weight\n- **Caption**: 12px / 1.3 line-height / 400 weight\n\n#### Text Hierarchy\n- Page title: H1, centered or left-aligned\n- Section headers: H2, left-aligned with 24px margin-bottom\n- Labels: Small, Text Secondary color, 8px margin-bottom\n- Body text: Body size, Text Primary color\n\n### Spacing System\n- Use 4px base unit for consistent spacing\n- **XS**: 4px (tight spacing)\n- **S**: 8px (small gaps)\n- **M**: 16px (default spacing)\n- **L**: 24px (section spacing)\n- **XL**: 32px (large sections)\n- **XXL**: 48px (major sections)\n\n### Component Specifications\n\n#### Upload Areas\n- **Container**: \n  - Background: #FFFFFF\n  - Border: 2px dashed #D1D5DB (Gray 300)\n  - Border radius: 8px\n  - Padding: 32px\n  - Min height: 200px\n  - Display: flex, column, center, align-items center\n  - Cursor: pointer\n  - Transition: border-color 0.2s ease\n\n- **Hover State**:\n  - Border color: #2563EB (Primary)\n  - Background: #F9FAFB (subtle highlight)\n\n- **Drag Over State**:\n  - Border color: #2563EB (Primary)\n  - Background: #DBEAFE (Primary Light)\n  - Border style: solid\n\n- **Icon/Illustration**:\n  - Size: 48px × 48px\n  - Color: #9CA3AF (Gray 400)\n  - Margin-bottom: 12px\n\n- **Text**:\n  - Primary: \"Click to upload or drag and drop\"\n  - Font: Body, Text Primary\n  - Margin-bottom: 4px\n\n- **Subtext**:\n  - \"JPG, PNG, WebP (max 10MB)\"\n  - Font: Small, Text Secondary\n\n- **File Input**:\n  - Hidden (display: none)\n  - Triggered by container click\n\n#### Selected Image Preview (Preset/Selfie)\n- **Container**:\n  - Position: relative\n  - Border radius: 8px\n  - Overflow: hidden\n  - Background: #F3F4F6 (Gray 100)\n  - Min height: 300px\n  - Max height: 400px\n  - Display: flex\n  - Align-items: center\n  - Justify-content: center\n  - Border: 2px solid #E5E7EB\n  - Margin-top: 16px\n\n- **Image**:\n  - Width: 100%\n  - Height: 100%\n  - Max height: 400px\n  - Object-fit: contain (show full image without cropping)\n  - Display: block\n\n- **Label**:\n  - Position: absolute, top-left\n  - Background: rgba(0, 0, 0, 0.7)\n  - Color: #FFFFFF\n  - Padding: 8px 12px\n  - Border-radius: 0 0 8px 0\n  - Font: Small, 600 weight\n  - Text: \"Selected Preset\" or \"Selected Selfie\"\n\n- **Delete Button**:\n  - Position: absolute, top-right corner\n  - Size: 36px × 36px\n  - Background: rgba(239, 68, 68, 0.9) (Red 500 with opacity)\n  - Color: #FFFFFF\n  - Border: none\n  - Border-radius: 50%\n  - Cursor: pointer\n  - Display: flex\n  - Align-items: center\n  - Justify-content: center\n  - Icon: × (close/delete, 20px, white)\n  - Z-index: 10\n  - Transition: background-color 0.2s ease, transform 0.2s ease\n  - Hover: Background rgba(220, 38, 38, 1) (Red 600), transform: scale(1.1)\n  - Click: Show confirmation dialog before deletion\n\n#### Result Image Display\n- **Container**:\n  - Background: #F9FAFB (Surface)\n  - Border: 2px solid #E5E7EB\n  - Border radius: 8px\n  - Min height: 600px\n  - Display: flex\n  - Align-items: center\n  - Justify-content: center\n  - Position: relative\n  - Grid-row: span 2 (spans both preset and selfie rows)\n\n- **Image** (when result exists):\n  - Max width: 100%\n  - Max height: 100%\n  - Object-fit: contain (show full image)\n  - Border radius: 8px\n\n- **Empty State**:\n  - Text: \"Result will appear here\"\n  - Font: Body, Text Secondary\n  - Icon: 64px × 64px, Gray 300\n  - Centered vertically and horizontally\n\n#### Gallery Grid (Preset/Selfie Selection)\n- **Container**:\n  - Display: grid\n  - Gap: 12px\n  - Grid-template-columns: repeat(auto-fill, minmax(100px, 1fr))\n  - Max columns: 3 on desktop (fits in left column)\n  - Max height: 200px\n  - Overflow-y: auto\n  - Margin-top: 16px\n  - Padding: 8px\n  - Background: #F9FAFB\n  - Border-radius: 8px\n\n- **Gallery Item**:\n  - Aspect ratio: 1:1 (square)\n  - Border radius: 8px\n  - Overflow: hidden\n  - Background: #F3F4F6\n  - Border: 2px solid transparent\n  - Cursor: pointer\n  - Transition: transform 0.2s ease, border-color 0.2s ease\n  - Position: relative\n\n- **Selected State**:\n  - Border color: #2563EB (Primary)\n  - Border width: 3px\n  - Box shadow: 0 0 0 3px rgba(37, 99, 235, 0.1)\n\n- **Hover State**:\n  - Transform: scale(1.02)\n  - Box shadow: 0 4px 12px rgba(0, 0, 0, 0.1)\n\n- **Image**:\n  - Width: 100%\n  - Height: 100%\n  - Object-fit: cover\n  - Display: block\n\n- **Delete Button** (Gallery Item):\n  - Position: absolute, top-right corner\n  - Size: 24px × 24px\n  - Background: rgba(239, 68, 68, 0.9) (Red 500 with opacity)\n  - Color: #FFFFFF\n  - Border: none\n  - Border-radius: 50%\n  - Cursor: pointer\n  - Display: flex\n  - Align-items: center\n  - Justify-content: center\n  - Icon: × (close/delete, 14px, white)\n  - Z-index: 10\n  - Opacity: 0 (hidden by default)\n  - Transition: opacity 0.2s ease, background-color 0.2s ease\n  - Hover (on gallery item): Opacity: 1\n  - Hover (on button): Background rgba(220, 38, 38, 1) (Red 600)\n  - Click: Show confirmation dialog, prevent event propagation (don't select item)\n\n#### Buttons\n\n##### Primary Button (Generate)\n- **Default**:\n  - Background: #2563EB (Primary)\n  - Color: #FFFFFF\n  - Padding: 12px 24px\n  - Border: none\n  - Border radius: 6px\n  - Font: Body, 600 weight\n  - Width: 100% (on mobile), auto (on desktop)\n  - Min width: 200px\n  - Cursor: pointer\n  - Transition: background-color 0.2s ease\n\n- **Hover**:\n  - Background: #1D4ED8 (Primary Hover)\n\n- **Disabled**:\n  - Background: #D1D5DB (Gray 300)\n  - Color: #9CA3AF (Gray 400)\n  - Cursor: not-allowed\n\n- **Loading**:\n  - Show spinner icon (16px) + text\n  - Disable interaction\n\n##### Secondary Button (Reset/Clear)\n- Background: transparent\n- Color: #6B7280 (Text Secondary)\n- Border: 1px solid #E5E7EB\n- Same padding and sizing as primary\n- Hover: Background #F9FAFB\n\n#### Status Messages\n- **Container**:\n  - Padding: 12px 16px\n  - Border radius: 6px\n  - Margin: 8px 0\n  - Font: Small\n  - Display: flex\n  - Align-items: center\n  - Gap: 8px\n\n- **Success**:\n  - Background: #D1FAE5 (Green 100)\n  - Color: #065F46 (Green 800)\n  - Icon: ✓ (checkmark)\n\n- **Error**:\n  - Background: #FEE2E2 (Red 100)\n  - Color: #991B1B (Red 800)\n  - Icon: ✕ (cross)\n\n- **Info**:\n  - Background: #DBEAFE (Blue 100)\n  - Color: #1E40AF (Blue 800)\n  - Icon: ℹ (info)\n\n#### Loading Spinner\n- **Overlay**:\n  - Position: fixed\n  - Top: 0, left: 0, right: 0, bottom: 0\n  - Background: rgba(0, 0, 0, 0.5)\n  - Display: flex\n  - Align-items: center\n  - Justify-content: center\n  - Z-index: 9999\n\n- **Spinner Container**:\n  - Background: #FFFFFF\n  - Padding: 32px\n  - Border radius: 8px\n  - Text-align: center\n  - Min-width: 200px\n\n- **Spinner**:\n  - Size: 40px × 40px\n  - Border: 3px solid #E5E7EB\n  - Border-top: 3px solid #2563EB\n  - Border radius: 50%\n  - Animation: spin 0.8s linear infinite\n  - Margin: 0 auto 16px\n\n- **Text**:\n  - Font: Body, Text Primary\n  - Margin-top: 12px\n\n#### Confirmation Dialog\n- **Overlay**:\n  - Position: fixed\n  - Top: 0, left: 0, right: 0, bottom: 0\n  - Background: rgba(0, 0, 0, 0.5)\n  - Display: flex\n  - Align-items: center\n  - Justify-content: center\n  - Z-index: 10000\n\n- **Dialog Container**:\n  - Background: #FFFFFF\n  - Padding: 24px\n  - Border radius: 8px\n  - Min-width: 320px\n  - Max-width: 400px\n  - Box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2)\n\n- **Title**:\n  - Font: H2 (20px, 600 weight)\n  - Color: Text Primary\n  - Margin-bottom: 12px\n\n- **Message**:\n  - Font: Body (16px)\n  - Color: Text Secondary\n  - Margin-bottom: 24px\n  - Line-height: 1.5\n\n- **Button Container**:\n  - Display: flex\n  - Gap: 12px\n  - Justify-content: flex-end\n\n- **Cancel Button**:\n  - Background: transparent\n  - Color: Text Secondary\n  - Border: 1px solid #E5E7EB\n  - Padding: 10px 20px\n  - Border-radius: 6px\n  - Cursor: pointer\n  - Hover: Background #F9FAFB\n\n- **Confirm Button** (Delete):\n  - Background: #EF4444 (Red 500)\n  - Color: #FFFFFF\n  - Border: none\n  - Padding: 10px 20px\n  - Border-radius: 6px\n  - Cursor: pointer\n  - Hover: Background #DC2626 (Red 600)\n\n### User Flow\n\n#### Primary Flow: Generate Face Swap\n1. **Select/Upload Preset** (left column, top)\n   - Option A: Upload new preset\n     - User clicks upload area or drags file\n     - Large preview appears immediately (300-400px height)\n     - Status: \"Uploading...\" → \"Uploaded\" or \"Already exists\"\n     - Gallery refreshes to show new preset\n   - Option B: Select from gallery\n     - User clicks thumbnail in gallery\n     - Selected preset shows in large preview area\n     - Visual feedback: Selected border on thumbnail\n\n2. **Select/Upload Selfie** (left column, bottom)\n   - Option A: Upload new selfie\n     - User clicks upload area or drags file\n     - Large preview appears immediately (300-400px height)\n     - Status: \"Uploading...\" → \"Uploaded\" or \"Already exists\"\n     - Gallery refreshes to show new selfie\n   - Option B: Select from gallery\n     - User clicks thumbnail in gallery\n     - Selected selfie shows in large preview area\n     - Visual feedback: Selected border on thumbnail\n\n3. **Generate Button Enabled**\n   - Visual feedback: Button changes from disabled to active\n   - Both large previews visible in left column\n   - Right column shows empty state\n\n4. **Click Generate**\n   - Loading overlay appears\n   - Button disabled\n   - Status: \"Processing face swap...\"\n\n5. **Result Display**\n   - Loading overlay disappears\n   - Result image appears in large right column (spans both rows)\n   - Success message: \"Face swap completed\"\n   - Result added to history gallery below\n\n### Responsive Design\n\n#### Breakpoints\n- **Mobile**: < 768px\n  - Single column layout (stack preset, selfie, result vertically)\n  - Full-width buttons\n  - 2-column gallery grid for presets/selfies\n  - Reduced padding (16px)\n  - Result image: Full width, normal height\n\n- **Tablet**: 768px - 1024px\n  - Two-column grid layout (40% left, 60% right)\n  - 3-column gallery grid for presets/selfies\n  - Standard padding (24px)\n  - Result image: Spans both rows\n\n- **Desktop**: > 1024px\n  - Two-column grid layout (40% left, 60% right)\n  - 3-column gallery grid for presets/selfies\n  - Max-width container (1200px)\n  - Result image: Large display, spans both rows\n\n### Accessibility\n\n#### Keyboard Navigation\n- All interactive elements must be keyboard accessible\n- Tab order: Upload areas → Gallery items → Generate button → Results\n- Enter/Space to activate buttons and select items\n- Focus indicators: 2px solid outline in Primary color\n\n#### Screen Readers\n- All images must have alt text\n- Buttons must have descriptive labels\n- Status messages must be announced\n- Loading states must be announced\n\n#### Visual Accessibility\n- Color contrast: Minimum 4.5:1 for text\n- Focus indicators: Clear and visible\n- Error states: Use icons + text, not just color\n- Touch targets: Minimum 44px × 44px\n\n### Performance Considerations\n- Lazy load gallery images (use loading=\"lazy\")\n- Optimize images before upload (client-side compression if possible)\n- Show skeleton loaders while fetching data\n- Debounce search/filter inputs if added later\n- Cache gallery images in browser\n\n### Error States\n\n#### Upload Errors\n- Network error: \"Upload failed. Please check your connection and try again.\"\n- File too large: \"File exceeds 10MB limit. Please choose a smaller file.\"\n- Invalid format: \"Invalid file type. Please upload JPG, PNG, or WebP.\"\n- Duplicate: \"This image already exists. Using existing version.\"\n\n#### Generation Errors\n- API error: \"Face swap failed. Please try again.\"\n- Timeout: \"Request timed out. Please try again.\"\n- Invalid images: \"Could not process images. Please ensure both images contain faces.\"\n\n### Empty States\n- **No Presets Gallery**: \"No presets yet. Upload your first preset above.\"\n- **No Selfies Gallery**: \"No selfies yet. Upload your first selfie above.\"\n- **No Results History**: \"No results yet. Generate your first face swap to see it here.\"\n- **Result Display Empty**: \"Result will appear here\"\n- Use subtle illustration or icon (48px, Gray 300)\n- Text: Small, Text Secondary, centered\n\n## Backend API Endpoints\n\n\n### Backend Database Schema\n- `presets` table: `id`, `image_url`, `prompt_json`, `thumbnail_url`, `thumbnail_format`, `thumbnail_resolution`, `thumbnail_r2_key`, `created_at`\n- `selfies` table: `id`, `image_url`, `profile_id`, `created_at`\n- `results` table: `id`, `preset_name`, `result_url`, `profile_id`, `created_at`\n\n**Lưu ý:**\n- Metadata (type, sub_category, gender, position) được lưu trong R2 bucket path, không lưu trong database\n- Thumbnails được lưu trong cùng row với preset (same-row approach)\n\n### Endpoints\n\n#### GET `/presets`\n- Returns: `{ presets: [...] }`\n- Each preset contains: `id`, `image_url`, `prompt_json`, `thumbnail_url`, `thumbnail_format`, `thumbnail_resolution`, `created_at`\n- Query params: `include_thumbnails` (optional, default: false) - bao gồm presets có thumbnail\n- Presets are stored as individual entries (no collections)\n- Backend queries database and returns all presets\n\n#### GET `/selfies`\n- Returns: `{ selfies: [...] }`\n- Each selfie contains: `id`, `selfie_url` (full URL), `action`, `created_at`\n- Selfies are stored as individual entries\n- Backend queries database and returns all selfies\n- **Lưu ý**: `selfie_url` trong database chỉ lưu bucket key, API tự động assemble full URL từ `R2_DOMAIN` khi trả về\n\n#### DELETE `/presets/:id`\n- Path parameter: `id` (preset ID)\n- Backend logic:\n  1. Find preset by ID in database\n  2. Delete file from R2 storage using `image_url`\n  3. Delete record from `presets` table\n  4. Return `{ success: true, message: \"Preset deleted\" }`\n- Error handling: Return 404 if preset not found, 500 on deletion failure\n\n#### DELETE `/selfies/:id`\n- Path parameter: `id` (selfie ID)\n- Backend logic:\n  1. Find selfie by ID in database\n  2. Delete file from R2 storage using `image_url`\n  3. Delete record from `selfies` table\n  4. Return `{ success: true, message: \"Selfie deleted\" }`\n- Error handling: Return 404 if selfie not found, 500 on deletion failure\n\n#### POST `/upload-url`\n- Content-Type: `multipart/form-data` hoặc `application/json`\n- Body (multipart): `files` (file[]), `type`, `profile_id`, `enableVertexPrompt` (optional), `action` (optional, chỉ cho selfie)\n- Body (JSON): `image_url` hoặc `image_urls` (string[]), `type`, `profile_id`, `enableVertexPrompt` (optional), `action` (optional, chỉ cho selfie)\n- Backend logic:\n  1. Upload file(s) to R2 storage\n  2. Với selfie: \n     - **Chỉ với `action=\"4k\"` hoặc `action=\"4K\"`**: Kiểm tra an toàn bằng Vision API trước khi lưu vào database\n     - **Các action khác (như `\"faceswap\"`, `\"wedding\"`, `\"default\"`, v.v.)**: Không kiểm tra Vision API\n     - Tự động xóa ảnh cũ dựa trên action:\n       - `action=\"faceswap\"`: Tối đa 8 ảnh (có thể cấu hình qua `SELFIE_MAX_FACESWAP`), xóa ảnh cũ nhất khi vượt quá giới hạn\n       - `action=\"wedding\"`: Tối đa 2 ảnh (cấu hình qua `SELFIE_MAX_WEDDING`), xóa ảnh cũ nhất khi có >= 2 ảnh\n       - `action=\"4k\"` hoặc `\"4K\"`: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_4K`), xóa ảnh cũ khi có >= 1 ảnh\n       - Action khác: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_OTHER`), xóa ảnh cũ khi có >= 1 ảnh\n  3. Insert record(s) vào database (`presets` hoặc `selfies` table) với bucket key (không phải full URL)\n  4. Với preset: tự động generate Vertex prompt nếu `enableVertexPrompt=true`\n- Response format: `{ data: { results: [...], count, successful, failed }, status, message, code, debug? }`\n  - Với selfie: mỗi result có thêm field `action`\n- Hỗ trợ upload nhiều file cùng lúc\n- **Lưu ý**: `selfie_url` trong database chỉ lưu bucket key (ví dụ: `\"selfie/filename.jpg\"`), API tự động assemble full URL khi trả về\n\n#### POST `/faceswap`\n- Body:\n  ```json\n  {\n    \"preset_image_id\": \"preset_id_from_database\",\n    \"selfie_id\": \"selfie_id_from_database\",\n    \"profile_id\": \"user_profile_id\"\n  }\n  ```\n- Returns:\n  ```json\n  {\n    \"data\": {\n      \"resultImageUrl\": \"result_url\"\n    },\n    \"status\": \"success\",\n    \"message\": \"Processing successful\",\n    \"code\": 200,\n    \"debug\": {}\n  }\n  ```\n\n#### GET `/results`\n- Returns: `{ results: [...] }`\n- Each result contains: `result_url`, `created_at`\n\n## Frontend Functionality\n\n### Preset Section (Left Column, Top)\n- **Upload Area**:\n  - Single file input (one preset at a time)\n  - Drag and drop support\n  - On file selection:\n    - Use original filename from file input (sanitize for safety)\n    - Show preview immediately using FileReader in large preview area\n    - Call `/upload-url` with original filename and type 'preset'\n    - If response has `exists: true`: Use existing URL, show message \"Image already exists\"\n    - If response has `exists: false`: Upload file to returned uploadUrl\n    - Store uploaded/existing URL and preset object\n  - Show success/error status messages\n  - Reload presets gallery after upload\n\n- **Preset Gallery**:\n  - Display below upload area in scrollable grid\n  - Load presets from `/presets` endpoint on page load\n  - Each preset card shows thumbnail image (square, 100px)\n  - Click preset to select (visual feedback with selected state)\n  - Selected preset shows in large preview area above gallery\n  - Use `image_url` directly from database (no conversion needed)\n  - Empty state: \"No presets yet. Upload your first preset above.\"\n  - Delete button on each gallery item (top-right corner, appears on hover)\n  - Delete button on selected preset preview (top-right corner, always visible)\n\n- **Delete Preset**:\n  - On delete button click (gallery or preview):\n    - Show confirmation dialog: \"Are you sure you want to delete this preset?\"\n    - If confirmed: Call `DELETE /presets/:id`\n    - On success: Remove from gallery, clear selection if deleted preset was selected, show success message\n    - On error: Show error message, keep item in gallery\n    - Reload presets gallery after successful deletion\n\n### Selfie Section (Left Column, Bottom)\n- **Upload Area**:\n  - Identical UI and functionality to Preset Upload\n  - Single file input (one selfie at a time)\n  - Drag and drop support\n  - On file selection:\n    - Use original filename from file input (sanitize for safety)\n    - Show preview immediately using FileReader in large preview area\n    - Call `/upload-url` with original filename and type 'selfie'\n    - If response has `exists: true`: Use existing URL, show message \"Image already exists\"\n    - If response has `exists: false`: Upload file to returned uploadUrl\n    - Store uploaded/existing URL and selfie object\n  - Show success/error status messages\n  - Reload selfies gallery after upload\n\n- **Selfie Gallery**:\n  - Display below upload area in scrollable grid\n  - Load selfies from `/selfies` endpoint on page load\n  - Each selfie card shows thumbnail image (square, 100px)\n  - Click selfie to select (visual feedback with selected state)\n  - Selected selfie shows in large preview area above gallery\n  - Use `image_url` directly from database (no conversion needed)\n  - Empty state: \"No selfies yet. Upload your first selfie above.\"\n  - Delete button on each gallery item (top-right corner, appears on hover)\n  - Delete button on selected selfie preview (top-right corner, always visible)\n\n- **Delete Selfie**:\n  - On delete button click (gallery or preview):\n    - Show confirmation dialog: \"Are you sure you want to delete this selfie?\"\n    - If confirmed: Call `DELETE /selfies/:id`\n    - On success: Remove from gallery, clear selection if deleted selfie was selected, show success message\n    - On error: Show error message, keep item in gallery\n    - Reload selfies gallery after successful deletion\n\n### Result Display (Right Column, Spans Both Rows)\n- Large display area (min-height: 600px)\n- Shows generated face swap result\n- Empty state: \"Result will appear here\" with icon\n- Result image: Max width/height 100%, object-fit: contain\n- Updates automatically after successful generation\n\n### Face Swap Generation\n- Button positioned below main workspace grid\n- Enabled when both preset and selfie are selected\n- On click:\n  - Show loading spinner overlay\n  - Disable button\n  - Call `/faceswap` with preset URL and selfie URL\n  - Display result image in right column on success\n  - Show error message on failure\n  - Reload results history gallery after success\n\n### Results Display\n- Load results from `/results` on page load\n- Display results in simple grid gallery\n- Each result card shows image and date\n- Date formatted as Vietnamese locale\n\n## Data Structures\n\n### Preset Object\n```javascript\n{\n  id: string,\n  image_url: string,\n  prompt_json: object | null,\n  thumbnail_url: string | null,\n  thumbnail_format: 'webp' | 'lottie' | null,\n  thumbnail_resolution: string | null,\n  created_at: string\n}\n```\n\n### Selfie Object\n```javascript\n{\n  id: string,\n  image_url: string,\n  created_at: string\n}\n```\n\n### Result Object\n```javascript\n{\n  result_url: string,\n  created_at: string (ISO format)\n}\n```\n\n## State Variables\n- `selectedPreset`: Currently selected preset object or null\n- `selectedSelfie`: Currently selected selfie object or null\n- `presets`: Array of all preset objects (loaded from `/presets`)\n- `selfies`: Array of all selfie objects (loaded from `/selfies`)\n- `results`: Array of all result objects (loaded from `/results`)\n\n## UI Elements\n\n### Preset Gallery\n- Simple grid layout\n- Each card: square aspect ratio, image only\n- Selected state: border highlight\n\n### Status Messages\n- Success: Green color\n- Error: Red color\n- Loading: Spinner animation\n\n## Image URL Handling\n- Database stores the final accessible URL directly in `image_url` field\n- Backend constructs the correct R2 URL (e.g., `/r2/preset/filename.jpg` or full URL with worker domain) when uploading\n- Frontend uses `image_url` from database directly - no conversion needed\n- URLs are ready to use as-is for display and API calls\n\n## Error Handling\n- Network errors: Show error message\n- API errors: Display error message from response\n- Image load errors: Show placeholder\n\n## Initialization\n- Load presets from `/presets` on page load\n- Load selfies from `/selfies` on page load\n- Load results from `/results` on page load\n- Display loading placeholders while fetching\n- Show empty states if no data available\n\n"
    };
    
    // Embedded sidebar
    window.__staticSidebar = "* [📚 Tổng quan API](API_TONG_QUAN_VI.md)\n\n* **1. Upload & Quản lý File**\n  * [POST /upload-url (type=selfie) - Upload selfie](API_TONG_QUAN_VI.md#post-upload-url-typeselfie-upload-selfie)\n  * [POST /upload-url (type=preset) - Upload preset (backend only)](API_TONG_QUAN_VI.md#post-upload-url-typepreset-upload-preset-backend-only)\n  * [POST /upload-thumbnails - Upload thumbnails (backend only)](API_TONG_QUAN_VI.md#post-upload-thumbnails-upload-thumbnails-backend-only)\n* **2. AI Processing**\n  * [POST /faceswap - Face Swap](API_TONG_QUAN_VI.md#post-faceswap-face-swap)\n  * [POST /background - AI Background](API_TONG_QUAN_VI.md#post-background-ai-background)\n  * [POST /enhance - AI Enhance](API_TONG_QUAN_VI.md#post-enhance-ai-enhance)\n  * [POST /beauty - AI Beauty](API_TONG_QUAN_VI.md#post-beauty-ai-beauty)\n  * [POST /filter - AI Filter (Styles)](API_TONG_QUAN_VI.md#post-filter-ai-filter-styles)\n  * [POST /restore - AI Restore](API_TONG_QUAN_VI.md#post-restore-ai-restore)\n  * [POST /aging - AI Aging](API_TONG_QUAN_VI.md#post-aging-ai-aging)\n  * [POST /upscaler4k - AI Upscale 4K](API_TONG_QUAN_VI.md#post-upscaler4k-ai-upscale-4k)\n  * [POST /remove-object - AI Xóa vật thể](API_TONG_QUAN_VI.md#post-remove-object-ai-xa-vt-th)\n  * [POST /expression - AI Thay đổi biểu cảm](API_TONG_QUAN_VI.md#post-expression-ai-thay-i-biu-cm)\n  * [POST /expand - AI Expand](API_TONG_QUAN_VI.md#post-expand-ai-expand)\n  * [POST /replace-object - AI Replace Object](API_TONG_QUAN_VI.md#post-replace-object-ai-replace-object)\n* **3. Quản lý Profile**\n  * [POST /profiles - Tạo profile](API_TONG_QUAN_VI.md#post-profiles-to-profile)\n  * [GET /profiles/{id} - Lấy profile](API_TONG_QUAN_VI.md#get-profilesid-ly-profile)\n  * [PUT /profiles/{id} - Cập nhật profile](API_TONG_QUAN_VI.md#put-profilesid-cp-nht-profile)\n  * [GET /profiles - Liệt kê profiles](API_TONG_QUAN_VI.md#get-profiles-lit-k-profiles)\n* **4. Truy vấn Dữ liệu**\n  * [GET /presets - Liệt kê presets](API_TONG_QUAN_VI.md#get-presets-lit-k-presets)\n  * [GET /presets/{id} - Lấy preset theo ID](API_TONG_QUAN_VI.md#get-presetsid-ly-preset-theo-id)\n  * [DELETE /presets/{id} - Xóa preset](API_TONG_QUAN_VI.md#delete-presetsid-xa-preset)\n  * [GET /selfies - Liệt kê selfies](API_TONG_QUAN_VI.md#get-selfies-lit-k-selfies)\n  * [DELETE /selfies/{id} - Xóa selfie](API_TONG_QUAN_VI.md#delete-selfiesid-xa-selfie)\n  * [GET /results - Liệt kê results](API_TONG_QUAN_VI.md#get-results-lit-k-results)\n  * [DELETE /results/{id} - Xóa result](API_TONG_QUAN_VI.md#delete-resultsid-xa-result)\n  * [GET /thumbnails - Liệt kê thumbnails](API_TONG_QUAN_VI.md#get-thumbnails-lit-k-thumbnails)\n  * [GET /thumbnails/{id}/preset - Lấy preset_id từ thumbnail_id](API_TONG_QUAN_VI.md#get-thumbnailsidpreset-ly-preset_id-t-thumbnail_id)\n  * [Thumbnail URL Rules - Quy tắc URL Thumbnail](API_TONG_QUAN_VI.md#thumbnail-url-rules-quy-tc-url-thumbnail)\n* **5. Hệ thống & Cấu hình**\n  * [GET /config - Lấy config](API_TONG_QUAN_VI.md#get-config-ly-config)\n  * [OPTIONS /* - CORS preflight requests](API_TONG_QUAN_VI.md#options-cors-preflight-requests)\n* [🔔 Push (FCM) – Setup & Endpoints](FCM_SETUP_COMPLETE_VI.md)";
    
    // Pre-generated search index
    window.__staticSearchIndex = [{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"# Tổng quan API Face Swap AI","url":"#/API_TONG_QUAN_VI.md","level":1},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Tài liệu này mô tả đầy đủ các điểm cuối (endpoint) mà Cloudflare Worker cung cấp.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Base URL:** `https://api.d.shotpix.app`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Mục lục","heading":"Mục lục","text":"## Mục lục","url":"#/API_TONG_QUAN_VI.md?id=mc-lc","level":2},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [Xác thực API](#xác-thực-api-api-authentication)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [APIs cần tích hợp với mobile](#apis-cần-tích-hợp-với-mobile-15-apis)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [Provider Aspect Ratio (Vertex / WaveSpeed)](#provider-aspect-ratio-vertex--wavespeed)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [API Endpoints (Chi tiết)](#api-endpoints-chi-tiết)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [1. Upload & Quản lý File](#1-upload--quản-lý-file)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [2. AI Processing](#2-ai-processing)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [3. Quản lý Profile](#3-quản-lý-profile)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [4. Truy vấn Dữ liệu](#4-truy-vấn-dữ-liệu)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [5. Hệ thống & Cấu hình](#5-hệ-thống--cấu-hình)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [6. Thanh toán & Subscription](#6-thanh-toán--subscription-google-play-billing)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- [Tổng kết](#tổng-kết)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Xác thực API (API Authentication)","heading":"Xác thực API (API Authentication)","text":"## Xác thực API (API Authentication)","url":"#/API_TONG_QUAN_VI.md?id=xc-thc-api-api-authentication","level":2},{"title":"Tổng quan API Face Swap AI - Mobile API Key Authentication","heading":"Mobile API Key Authentication","text":"### Mobile API Key Authentication","url":"#/API_TONG_QUAN_VI.md?id=mobile-api-key-authentication","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Hệ thống hỗ trợ xác thực bằng API key cho các mobile APIs. Tính năng này có thể được bật/tắt thông qua biến môi trường `ENABLE_MOBILE_API_KEY_AUTH`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Khi bật (`ENABLE_MOBILE_API_KEY_AUTH=true`):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Các mobile APIs được bảo vệ yêu cầu API key trong request header","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- API key có thể được gửi qua:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Header `X-API-Key`: `X-API-Key: your_api_key_here`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Header `Authorization`: `Authorization: Bearer your_api_key_here`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Các endpoints được bảo vệ (khi authentication được bật):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/upload-url` (type=selfie) - Chỉ khi upload selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/faceswap`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/background`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/enhance`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/beauty`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/filter`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/restore`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/aging`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/upscaler4k`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/remove-object`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/expression`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/upload-url` (type=mask) - Upload mask image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/profiles` - Chỉ khi tạo profile mới","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- GET `/profiles/{id}` - Chỉ khi lấy profile theo ID","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- DELETE `/results/{id}` - Xóa result","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/upload-url` (type=preset) không yêu cầu API key (backend only)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Các endpoints khác không nằm trong danh sách trên không yêu cầu API key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tạo API Key:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Sử dụng script `generate-api-key.js` để tạo API key mới:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"node backend-cloudflare-workers/generate-api-key.js","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Script sẽ tạo một API key ngẫu nhiên 32 bytes (256 bits) và hiển thị hướng dẫn thêm vào `deployments-secrets.json`:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"MOBILE_API_KEY\": \"your_generated_key_here\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"ENABLE_MOBILE_API_KEY_AUTH\": \"true\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Ví dụ request với API key:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/faceswap \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_ids\": [\"selfie_1234567890_xyz789\"],","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Hoặc sử dụng Authorization header:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/faceswap \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Authorization: Bearer your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_ids\": [\"selfie_1234567890_xyz789\"],","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Response (401 Unauthorized):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Khi API key không hợp lệ hoặc thiếu:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"error\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Unauthorized\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 401","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - APIs cần tích hợp với mobile (20 APIs)","heading":"APIs cần tích hợp với mobile (20 APIs)","text":"## APIs cần tích hợp với mobile (20 APIs)","url":"#/API_TONG_QUAN_VI.md?id=apis-cn-tch-hp-vi-mobile-20-apis","level":2},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tổng số API endpoints: 30**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - APIs cần tích hợp với mobile (20 APIs)","heading":"APIs cần tích hợp với mobile (20 APIs)","text":"### APIs cần tích hợp với mobile (20 APIs)","url":"#/API_TONG_QUAN_VI.md?id=apis-cn-tch-hp-vi-mobile-20-apis","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. POST `/upload-url` (type=selfie) - Upload selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. POST `/upload-url` (type=mask) - Upload mask image (cho remove object)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. POST `/faceswap` - Đổi mặt (Face Swap) - luôn dùng Vertex AI, hỗ trợ multiple selfies","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"4. POST `/background` - Tạo nền AI (AI Background)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"5. POST `/enhance` - AI enhance ảnh (cải thiện chất lượng kỹ thuật)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"6. POST `/beauty` - AI beautify ảnh (cải thiện thẩm mỹ khuôn mặt)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"7. POST `/filter` - AI Filter (Styles) - Áp dụng style từ preset lên selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"8. POST `/restore` - AI khôi phục và nâng cấp ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"9. POST `/aging` - AI lão hóa khuôn mặt","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"10. POST `/upscaler4k` - AI upscale ảnh lên 4K","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"11. POST `/remove-object` - AI xóa vật thể khỏi ảnh bằng mask","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"12. POST `/expression` - AI thay đổi biểu cảm khuôn mặt","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"13. POST `/expand` - AI mở rộng ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"14. POST `/replace-object` - AI thay thế vật thể trong ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"15. POST `/profiles` - Tạo profile","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"16. GET `/profiles/{id}` - Lấy profile (hỗ trợ cả Profile ID và Device ID)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"17. PUT `/profiles/{id}` - Cập nhật profile","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"18. GET `/selfies` - Liệt kê selfies","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"19. GET `/results` - Liệt kê results (generated images)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"20. DELETE `/results/{id}` - Xóa result","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - APIs không cần tích hợp với mobile (11 APIs)","heading":"APIs không cần tích hợp với mobile (11 APIs)","text":"### APIs không cần tích hợp với mobile (11 APIs)","url":"#/API_TONG_QUAN_VI.md?id=apis-khng-cn-tch-hp-vi-mobile-11-apis","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"20. GET `/profiles` - Liệt kê profiles","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"21. POST `/upload-url` (type=preset) - Upload preset (backend only)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"22. GET `/presets` - Liệt kê presets","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"23. GET `/presets/{id}` - Lấy preset theo ID (bao gồm prompt_json)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"24. DELETE `/presets/{id}` - Xóa preset","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"25. DELETE `/selfies/{id}` - Xóa selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"26. POST `/upload-thumbnails` - Tải lên thumbnails và presets (batch)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"27. GET `/thumbnails` - Liệt kê thumbnails","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"28. GET `/thumbnails/{id}/preset` - Lấy preset_id từ thumbnail_id","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"29. GET `/config` - Lấy config","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"30. OPTIONS `/*` - CORS preflight requests","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Provider Aspect Ratio (Vertex / WaveSpeed)","heading":"Provider Aspect Ratio (Vertex / WaveSpeed)","text":"## Provider Aspect Ratio (Vertex / WaveSpeed)","url":"#/API_TONG_QUAN_VI.md?id=provider-aspect-ratio-vertex-wavespeed","level":2},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Backend hỗ trợ hai provider: **Vertex AI** và **WaveSpeed**. Mỗi provider có cách xử lý aspect ratio và kích thước khác nhau.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Vertex AI (Google)","heading":"Vertex AI (Google)","text":"### Vertex AI (Google)","url":"#/API_TONG_QUAN_VI.md?id=vertex-ai-google","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Chỉ dùng tỷ lệ chuẩn.** Ảnh input được map sang tỷ lệ hỗ trợ gần nhất; tỷ lệ gốc có thể không giữ nguyên.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Tỷ lệ hỗ trợ:** 1:1, 3:2, 2:3, 3:4, 4:3, 4:5, 5:4, 9:16, 16:9, 21:9.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Dùng khi:** Cần tỷ lệ chuẩn (9:16 stories, 1:1 posts, v.v.).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - WaveSpeed","heading":"WaveSpeed","text":"### WaveSpeed","url":"#/API_TONG_QUAN_VI.md?id=wavespeed","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Giữ nguyên tỷ lệ gốc.** Hỗ trợ custom dimensions 256–1536 px mỗi cạnh; scale tỷ lệ trong giới hạn.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Giới hạn:** Min 256px, max 1536px mỗi cạnh.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Dùng khi:** Cần giữ đúng tỷ lệ ảnh gốc, không crop méo.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - So sánh","heading":"So sánh","text":"### So sánh","url":"#/API_TONG_QUAN_VI.md?id=so-snh","level":3},{"title":"Tổng quan API Face Swap AI - Override theo request","heading":"Override theo request","text":"### Override theo request","url":"#/API_TONG_QUAN_VI.md?id=override-theo-request","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Mọi endpoint AI có thể gửi `\"provider\": \"vertex\"`, `\"provider\": \"wavespeed\"` (Flux), hoặc `\"provider\": \"wavespeed_gemini_2_5_flash_image\"` (Gemini 2.5","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Endpoints áp dụng","heading":"Endpoints áp dụng","text":"### Endpoints áp dụng","url":"#/API_TONG_QUAN_VI.md?id=endpoints-p-dng","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"`/enhance`, `/beauty`, `/restore`, `/aging`, `/filter`, `/faceswap` — đều hỗ trợ cả hai provider với hành vi trên.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Error Codes Reference","heading":"Error Codes Reference","text":"## Error Codes Reference","url":"#/API_TONG_QUAN_VI.md?id=error-codes-reference","level":2},{"title":"Tổng quan API Face Swap AI - Vision API Safety Error Codes (1001-1005)","heading":"Vision API Safety Error Codes (1001-1005)","text":"### Vision API Safety Error Codes (1001-1005)","url":"#/API_TONG_QUAN_VI.md?id=vision-api-safety-error-codes-1001-1005","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Các error codes này được trả về khi Google Vision API SafeSearch phát hiện nội dung không phù hợp trong ảnh. Được sử dụng cho:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/upload-url` (type=selfie, action=\"4k\" hoặc \"4K\") - Kiểm tra ảnh selfie trước khi lưu","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### Tìm kiếm An toàn (Safe Search)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Tập hợp các đặc điểm liên quan đến hình ảnh, được tính toán bằng các phương pháp thị giác máy tính trên các lĩnh vực tìm kiếm an toàn (ví dụ: người lớ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Các trường (Fields):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **adult** (Likelihood): Thể hiện khả năng nội dung dành cho người lớn của hình ảnh. Nội dung dành cho người lớn có thể bao gồm các yếu tố như khỏa t","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **spoof** (Likelihood): Xác suất chế giễu. Xác suất xảy ra việc chỉnh sửa phiên bản gốc của hình ảnh để làm cho nó trông hài hước hoặc phản cảm.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **medical** (Likelihood): Rất có thể đây là hình ảnh y tế.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **violence** (Likelihood): Hình ảnh này có khả năng chứa nội dung bạo lực. Nội dung bạo lực có thể bao gồm cái chết, thương tích nghiêm trọng hoặc t","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **racy** (Likelihood): Khả năng cao hình ảnh được yêu cầu chứa nội dung khiêu dâm. Nội dung khiêu dâm có thể bao gồm (nhưng không giới hạn) quần áo ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### Severity Levels (Độ nghiêm trọng)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Google Vision API SafeSearch trả về mức độ nghiêm trọng cho mỗi field (adult, violence, racy, medical, spoof). App kiểm tra **tất cả các fields** và s","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Cách hoạt động:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- App kiểm tra tất cả 5 fields: `adult`, `violence`, `racy`, `medical`, `spoof`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Nếu **bất kỳ field nào** có level là `POSSIBLE`, `LIKELY`, hoặc `VERY_LIKELY` → Ảnh bị chặn","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `statusCode` (1001-1005) được trả về dựa trên field có **mức độ cao nhất** (worst violation)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Error code mapping: `adult`=1001, `violence`=1002, `racy`=1003, `medical`=1004, `spoof`=1005","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Ví dụ 1 - Ảnh bị chặn:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"adult\": \"VERY_UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"violence\": \"POSSIBLE\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"racy\": \"UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"medical\": \"VERY_UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"spoof\": \"VERY_UNLIKELY\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"→ **Kết quả:** Bị chặn vì `violence` có level `POSSIBLE`. Trả về `code: 1002` (violence).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Ví dụ 2 - Ảnh bị chặn (nhiều violations):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"adult\": \"LIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"violence\": \"POSSIBLE\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"racy\": \"VERY_LIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"medical\": \"UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"spoof\": \"VERY_UNLIKELY\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"→ **Kết quả:** Bị chặn. `racy` có level cao nhất (`VERY_LIKELY`), nên trả về `code: 1003` (racy).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Ví dụ 3 - Ảnh được phép:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"adult\": \"VERY_UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"violence\": \"UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"racy\": \"VERY_UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"medical\": \"UNLIKELY\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"spoof\": \"VERY_UNLIKELY\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"→ **Kết quả:** Được phép vì tất cả fields đều là `VERY_UNLIKELY` hoặc `UNLIKELY`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Ví dụ Response khi bị chặn:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"error\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Upload failed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 1001","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - Vertex AI Safety Error Codes (2001-2004)","heading":"Vertex AI Safety Error Codes (2001-2004)","text":"### Vertex AI Safety Error Codes (2001-2004)","url":"#/API_TONG_QUAN_VI.md?id=vertex-ai-safety-error-codes-2001-2004","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Các error codes này được trả về khi Vertex AI Gemini safety filters chặn generated image. Được sử dụng cho:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/faceswap` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/background` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/enhance` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/beauty` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/filter` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/restore` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- POST `/aging` - Khi Vertex AI chặn generated image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### Các loại tác hại","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Bộ lọc nội dung đánh giá nội dung dựa trên các loại tác hại sau:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### So sánh điểm xác suất và điểm mức độ nghiêm trọng (Probability Scores and Severity Scores)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Điểm an toàn xác suất phản ánh khả năng phản hồi của mô hình có liên quan đến tác hại tương ứng. Nó có một điểm tin cậy tương ứng nằm trong khoảng từ ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Điểm tin cậy được chia thành bốn mức độ tin cậy:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### Safety Threshold Configuration","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Cấu hình hiện tại:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- ✅ **Cho phép**: `NEGLIGIBLE`, `LOW`, `MEDIUM`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- ❌ **Chặn**: `HIGH` only","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Áp dụng cho tất cả các loại tác hại:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- HARM_CATEGORY_HATE_SPEECH (Lời lẽ kích động thù hận)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- HARM_CATEGORY_HARASSMENT (Quấy rối)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- HARM_CATEGORY_SEXUALLY_EXPLICIT (Nội dung khiêu dâm)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- HARM_CATEGORY_DANGEROUS_CONTENT (Nội dung nguy hiểm)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- App chỉ chặn nội dung khi phát hiện vi phạm với `HIGH` confidence level","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Nội dung với `NEGLIGIBLE`, `LOW`, hoặc `MEDIUM` confidence level đều được cho phép","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Safety violations trả về HTTP 422 với internal error codes 2001-2004 trong trường `code`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Message trả về từ Vertex AI API response (có thể là finishMessage, refusalText, hoặc generic message)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Ví dụ Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"error\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing failed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 2003","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - HTTP Status Codes","heading":"HTTP Status Codes","text":"### HTTP Status Codes","url":"#/API_TONG_QUAN_VI.md?id=http-status-codes","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Ngoài các error codes trên, API cũng trả về các HTTP status codes chuẩn:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Error codes 1001-1005 và 2001-2004 được trả về trong trường `code` của response body","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- HTTP status code luôn là 422 cho các safety violations (content bị chặn)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Chi tiết về violation có thể được tìm thấy trong `debug.vision` (cho Vision API) hoặc `debug.provider` (cho Vertex AI)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - API Endpoints (Chi tiết)","heading":"API Endpoints (Chi tiết)","text":"## API Endpoints (Chi tiết)","url":"#/API_TONG_QUAN_VI.md?id=api-endpoints-chi-tit","level":2},{"title":"Tổng quan API Face Swap AI - 1. Upload & Quản lý File","heading":"1. Upload & Quản lý File","text":"### 1. Upload & Quản lý File","url":"#/API_TONG_QUAN_VI.md?id=1-upload-qun-l-file","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 1.1. POST `/upload-url` (type=selfie) - Upload selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Tải ảnh selfie trực tiếp lên server và lưu vào database. Endpoint này được sử dụng bởi mobile app để upload selfie.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true` (chỉ áp dụng cho `type=selfie`).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Upload single selfie với action:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-url \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/selfie.jpg\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"type=selfie\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"profile_id=profile_1234567890\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"action=faceswap\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"dimensions=1024x768\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Upload multiple selfies với dimensions array:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-url \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/selfie1.jpg\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/selfie2.jpg\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"type=selfie\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"profile_id=profile_1234567890\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"action=faceswap\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F 'dimensions=[\"1024x768\", \"800x600\"]'","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**JSON với image_urls và dimensions array:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-url \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"image_urls\": [\"https://example.com/selfie1.jpg\", \"https://example.com/selfie2.jpg\"],","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"type\": \"selfie\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"action\": \"faceswap\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"dimensions\": [\"1024x768\", \"800x600\"]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `files` (file[], required nếu dùng multipart): Mảng file ảnh selfie cần upload (hỗ trợ nhiều file).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `image_url` hoặc `image_urls` (string/string[], required nếu dùng JSON): URL ảnh selfie trực tiếp.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `type` (string, required): Loại upload. Các giá trị hỗ trợ:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"selfie\"`: Upload ảnh selfie cho mobile app.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"mask\"`: Upload ảnh mask (đen trắng) cho API `/remove-object`. Mask được lưu vào R2 folder `mask/`, action tự động đặt là `remove_object`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"preset\"`: Upload preset (backend only, không cần API key).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `action` (string, chỉ áp dụng cho `type=selfie`): Loại action của selfie. Nếu không truyền, mặc định là `\"faceswap\"`. Các giá trị hỗ trợ:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"faceswap\"`: Tối đa 8 ảnh (có thể cấu hình), tự động xóa ảnh cũ khi upload ảnh mới (giữ lại số ảnh mới nhất theo giới hạn). **Không kiểm tra Vision","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"filter\"`: Tối đa 5 ảnh (có thể cấu hình), tự động xóa ảnh cũ khi upload ảnh mới. **Không kiểm tra Vision API.**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"wedding\"`: Tối đa 2 ảnh, tự động xóa ảnh cũ khi upload ảnh mới (giữ lại 1 ảnh mới nhất). **Không kiểm tra Vision API.**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"4k\"` hoặc `\"4K\"`: Tối đa 1 ảnh, tự động xóa ảnh cũ khi upload ảnh mới. **Ảnh sẽ được kiểm tra bằng Vision API trước khi lưu vào database.**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"remove_object\"`: Dùng cho ảnh gốc cần xóa vật thể. Không giới hạn số lượng, tự động xóa sau khi API xử lý xong.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `\"expression\"`: Dùng cho ảnh cần thay đổi biểu cảm. Không giới hạn số lượng, tự động xóa sau khi API xử lý xong.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Các action khác (`\"enhance\"`, `\"beauty\"`, `\"restore\"`, `\"aging\"`, ...): Không giới hạn số lượng, tự động xóa sau khi API xử lý xong. **Không kiểm tr","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `dimensions` (string | string[], optional): Kích thước ảnh selfie theo định dạng `\"widthxheight\"` (ví dụ: `\"1024x768\"`). Được sử dụng để truyền kích","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Cho single file**: Có thể truyền string đơn: `\"1024x768\"`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Cho multiple files**: Truyền JSON array cùng thứ tự với files: `[\"1024x768\", \"800x600\", null]` (null cho file không xác định được kích thước)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response (Success 200):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"results\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"url\": \"https://resources.d.shotpix.app/faceswap-images/selfie/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filename\": \"example.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"count\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"successful\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"failed\": 0","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response (Error - Vision API Blocked):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Khi ảnh selfie không vượt qua kiểm tra an toàn của Vision API, endpoint sẽ trả về error code tương ứng với loại vi phạm:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"error\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Upload failed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 1001","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý quan trọng:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Vision API Error Codes (1001-1005):** Chỉ selfie uploads với `action=\"4k\"` hoặc `action=\"4K\"` mới được quét bởi Vision API trước khi lưu vào datab","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Vertex AI Error Codes (2001-2004):** Được trả về khi Vertex AI Gemini safety filters chặn generated image. Áp dụng cho các endpoints: `/faceswap`,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Chặn `POSSIBLE`, `LIKELY`, và `VERY_LIKELY` violations","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Nếu ảnh không an toàn, file sẽ bị xóa khỏi R2 storage và trả về error code tương ứng","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Error code được trả về trong trường `code` của response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Giới hạn số lượng selfie:** Mỗi action có giới hạn riêng và tự động xóa ảnh cũ khi vượt quá giới hạn:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `faceswap`: Tối đa 8 ảnh (có thể cấu hình qua `SELFIE_MAX_FACESWAP`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `wedding`: Tối đa 2 ảnh (cấu hình qua `SELFIE_MAX_WEDDING`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `4k`/`4K`: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_4K`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Các action khác: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_OTHER`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 1.1b. POST `/upload-url` (type=mask) - Upload mask image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Tải ảnh mask lên server để sử dụng với API `/remove-object`. Mask image là ảnh đen trắng, vùng trắng chỉ định vật thể cần xóa.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-url \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/mask.png\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"type=mask\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"profile_id=profile_1234567890\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `files` (file[], required nếu dùng multipart): File ảnh mask.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `type` (string, required): Phải là `\"mask\"`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response (Success 200):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"results\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"mask_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"url\": \"https://resources.d.shotpix.app/faceswap-images/mask/mask_abc123.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filename\": \"mask_abc123.png\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"count\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"successful\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"failed\": 0","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Mask được lưu vào R2 folder `mask/`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Trong database, mask được lưu vào bảng `selfies` với `action = 'remove_object'`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Mask sẽ tự động bị xóa sau khi API `/remove-object` xử lý xong","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Không áp dụng giới hạn số lượng (không có limit enforcement)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 1.2. POST `/upload-url` (type=preset) - Upload preset (backend only)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Tải ảnh preset trực tiếp lên server và lưu vào database với xử lý tự động (Vision scan, Vertex prompt generation). Endpoint này chỉ được","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Multipart/form-data:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-url \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/image1.jpg\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/image2.jpg\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"type=preset\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"profile_id=profile_1234567890\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"enableVertexPrompt=true\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**JSON với image_url:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-url \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"image_url\": \"https://example.com/image.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"type\": \"preset\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"enableVertexPrompt\": true","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `files` (file[], required nếu dùng multipart): Mảng file ảnh preset cần upload (hỗ trợ nhiều file).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `image_url` hoặc `image_urls` (string/string[], required nếu dùng JSON): URL ảnh preset trực tiếp.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `type` (string, required): Phải là `\"preset\"` cho backend upload.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `enableVertexPrompt` (boolean/string, optional): `true` hoặc `\"true\"` để bật tạo prompt Vertex khi upload preset. Sử dụng Vertex AI để phân tích ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `art_style` (string, optional): Filter art style cho prompt generation. Giá trị: `auto` (mặc định), `photorealistic`, `figurine`, `popmart`, `clay`,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"results\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filename\": \"example.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"count\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"successful\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"failed\": 0","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"hasPrompt\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"prompt_json\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"prompt\": \"...\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"style\": \"...\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"lighting\": \"...\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex_info\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"promptKeys\": [\"prompt\", \"style\", \"lighting\"],","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"endpoint\": \"https://.../generateContent\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"responseTimeMs\": 4200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filesProcessed\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultsCount\": 1","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 1.3. POST `/upload-thumbnails` - Upload thumbnails (backend only)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Tải lên thumbnails (WebP và Lottie JSON) và tự động tạo presets. Hỗ trợ upload file zip chứa tất cả assets hoặc upload từng file riêng l","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Upload individual files:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-thumbnails \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/preset/fs_wonder_f_3.png\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"path_preset_fs_wonder_f_3.png=preset/\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/lottie_1x/fs_wonder_f_3.json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"path_lottie_1x_fs_wonder_f_3.json=lottie_1x/\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/lottie_avif_2x/fs_wonder_f_3.json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"path_lottie_avif_2x_fs_wonder_f_3.json=lottie_avif_2x/\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"art_style=auto\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Upload with Art Style Filter (e.g., Pop Mart style):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-thumbnails \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/preset/popmart_figure.png\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"path_popmart_figure.png=preset/\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"art_style=popmart\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Upload zip file containing all assets:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upload-thumbnails \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"files=@/path/to/thumbnails.zip\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-F \"art_style=disney\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Supported Art Styles:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Cấu trúc thư mục:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"├── preset/","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   ├── fs_wonder_f_3.png    # Files here get Vertex AI prompt generation","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   └── fs_wonder_m_2.png","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"├── lottie_1x/","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   ├── fs_wonder_f_3.json   # Thumbnails at 1x resolution","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   └── fs_wonder_m_2.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"├── lottie_1.5x/","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   ├── fs_wonder_f_3.json   # Thumbnails at 1.5x resolution","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   └── fs_wonder_m_2.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"├── lottie_2x/","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   ├── fs_wonder_f_3.json   # Thumbnails at 2x resolution","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   └── fs_wonder_m_2.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"├── lottie_avif_1x/","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   ├── fs_wonder_f_3.json   # AVIF thumbnails at 1x resolution","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"│   └── fs_wonder_m_2.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"└── [other resolution folders...]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Quy tắc đặt tên file:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Format: `[preset_id].[png|webp|json]`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Ví dụ: `fs_wonder_f_3.png`, `fs_wonder_m_2.webp`, `fireworks_animation.json`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Tên file (không bao gồm extension) sẽ trở thành `preset_id`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Vertex AI chỉ phân tích file ảnh từ thư mục \"preset\" để tạo `prompt_json` metadata","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- File từ các thư mục resolution khác (lottie_*, lottie_avif_*) là thumbnails, KHÔNG được gửi đến Vertex AI","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tính năng Vertex AI:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Tự động gọi Vertex AI Gemini để phân tích file ảnh từ thư mục \"preset\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Sử dụng `Promise.all` để xử lý batch upload và tạo prompt song song","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `prompt_json` được lưu trong R2 custom metadata của preset files","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Thumbnails được lưu ở nhiều resolution (1x, 1.5x, 2x, 3x, 4x) trong database","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Chỉ áp dụng cho file ảnh từ thư mục \"preset\", bỏ qua thumbnails","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"total\": 3,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"successful\": 3,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"failed\": 0,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"thumbnails_processed\": 3,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"results\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filename\": \"fs_wonder_f_3.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"type\": \"preset\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_id\": \"fs_wonder_f_3\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"url\": \"https://resources.d.shotpix.app/presets/fs_wonder_f_3.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"hasPrompt\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"prompt_json\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"scene\": \"wonder woman portrait\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"style\": \"heroic\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"mood\": \"confident\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"colors\": [\"red\", \"blue\", \"gold\"]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex_info\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"promptKeys\": [\"scene\", \"style\", \"mood\", \"colors\"]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"metadata\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"format\": \"webp\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filename\": \"fs_wonder_f_3.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"type\": \"thumbnail\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_id\": \"fs_wonder_f_3\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"url\": \"https://resources.d.shotpix.app/lottie_1x/fs_wonder_f_3.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"hasPrompt\": false,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex_info\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": false","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"metadata\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"format\": \"lottie\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resolution\": \"1x\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filename\": \"fs_wonder_f_3.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"type\": \"thumbnail\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_id\": \"fs_wonder_f_3\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"url\": \"https://resources.d.shotpix.app/lottie_avif_2x/fs_wonder_f_3.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"hasPrompt\": false,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex_info\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": false","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"metadata\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"format\": \"lottie\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resolution\": \"2x\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processed 3 of 3 files\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"filesProcessed\": 3,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultsCount\": 3","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - 2. AI Processing","heading":"2. AI Processing","text":"### 2. AI Processing","url":"#/API_TONG_QUAN_VI.md?id=2-ai-processing","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.1. POST `/faceswap` - Face Swap","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Thực hiện face swap giữa ảnh preset và ảnh selfie. Hỗ trợ multiple selfies để tạo composite results (ví dụ: wedding photos với cả male v","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Khác với `/background`: FaceSwap thay đổi khuôn mặt trong preset, còn AI Background merge selfie vào preset scene.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hành vi theo Provider:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Vertex AI (mặc định):** Sử dụng `prompt_json` từ metadata của preset để thực hiện faceswap.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **WaveSpeed (`provider: \"wavespeed\"`):** Không sử dụng `prompt_json`. Sử dụng prompt cố định:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Single mode (1 selfie):** Gửi `[selfie, preset]` với prompt: \"Put the person in image1 into image2, keep all the makeup same as preset.\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Couple mode (2 selfies):** Gửi `[selfie1, selfie2, preset]` với prompt: \"Put both persons in image1 and image2 into image3, keep all the makeup sa","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Sử dụng selfie_ids (từ database):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/faceswap \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_ids\": [\"selfie_1234567890_xyz789\"],","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"additional_prompt\": \"Add dramatic lighting and cinematic atmosphere\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"16:9\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Sử dụng selfie_image_urls (URL trực tiếp):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/faceswap \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_urls\": [\"https://example.com/selfie1.jpg\", \"https://example.com/selfie2.jpg\"],","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"additional_prompt\": \"Add dramatic lighting and cinematic atmosphere\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"16:9\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preset_image_id` (string, required): ID ảnh preset đã lưu trong database (format: `preset_...`).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_ids` (array of strings, optional): Mảng các ID ảnh selfie đã lưu trong database (hỗ trợ multiple selfies). Thứ tự: [selfie_chính, selfie_phụ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_urls` (array of strings, optional): Mảng các URL ảnh selfie trực tiếp (thay thế cho `selfie_ids`). Hỗ trợ multiple selfies. Phải cung ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình (mặc định: \"3:4\"). Hỗ trợ: \"1:1\", \"3:2\", \"2:3\", \"3:4\", \"4:3\", \"4:5\", \"5:4\", \"9:16\", \"16:9\", \"21:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Lưu ý về kích thước đầu ra (WaveSpeed provider):** Nếu `aspect_ratio` được chỉ định rõ ràng, hệ thống sẽ sử dụng aspect ratio đó. Nếu không chỉ đị","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `additional_prompt` (string, optional): câu mô tả bổ sung, được nối vào cuối trường `prompt` bằng ký tự `+`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"request\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"targetUrl\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"sourceUrls\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_001.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_002.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"finalResultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"endpoint\": \"https://...\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"durationMs\": 843","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"prompt\": { \"...\": \"...\" },","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"endpoint\": \"https://.../generateContent\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"durationMs\": 5180,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"requestPayload\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"promptLength\": 746,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"imageBytes\": 921344","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vision\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"checked\": false,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"isSafe\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"error\": \"Safety check skipped for Vertex AI mode\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"storage\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"attemptedDownload\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"downloadStatus\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"savedToR2\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"r2Key\": \"results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"publicUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"database\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"attempted\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultId\": \"result_...\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.2. POST `/background` - AI Background","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Tạo ảnh mới bằng cách merge selfie (người) vào preset (cảnh nền) sử dụng AI. Selfie sẽ được đặt vào preset scene một cách tự nhiên với n","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Sử dụng selfie_id (từ database):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/background \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"16:9\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Sử dụng selfie_image_url (URL trực tiếp):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/background \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://example.com/selfie.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"16:9\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Sử dụng custom_prompt (tạo nền từ text prompt với Vertex AI):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/background \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"custom_prompt\": \"A beautiful sunset beach scene with palm trees and golden sand\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"16:9\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Sử dụng custom_prompt với selfie_image_url:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/background \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"custom_prompt\": \"A futuristic cityscape at night with neon lights and flying cars\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://example.com/selfie.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"16:9\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý về custom_prompt:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Khi sử dụng `custom_prompt`, hệ thống sẽ thực hiện 2 bước:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. **Tạo ảnh nền**: Sử dụng Vertex AI Gemini để tạo ảnh nền từ text prompt","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. **Merge selfie**: Tự động merge selfie vào ảnh nền vừa tạo với lighting và color grading phù hợp","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `custom_prompt` không thể kết hợp với `preset_image_id` hoặc `preset_image_url` (chỉ chọn một trong ba)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` và `model` sẽ được áp dụng cho cả việc tạo nền và merge","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý về preset_image_id:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Hỗ trợ cả preset từ database (trong bảng `presets`) và file trực tiếp trong folder `/remove_bg/background/` trên R2","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Có thể truyền `preset_image_id` kèm extension (ví dụ: `\"background_001.webp\"`) hoặc không có extension (ví dụ: `\"background_001\"`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Nếu không có extension, hệ thống sẽ tự động thử các extension phổ biến: .webp, .jpg, .png, .jpeg","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Hệ thống sẽ tìm file theo thứ tự: database trước, sau đó folder `/remove_bg/background/` nếu không tìm thấy trong database","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preset_image_id` (string, optional): ID ảnh preset hoặc filename trong folder `/remove_bg/background/`. Phải cung cấp `preset_image_id` HOẶC `prese","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preset_image_url` (string, optional): URL ảnh preset trực tiếp (thay thế cho `preset_image_id`). Phải cung cấp `preset_image_id` HOẶC `preset_image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `custom_prompt` (string, optional): Prompt tùy chỉnh để tạo ảnh nền từ text sử dụng Vertex AI (thay thế cho preset image). Khi sử dụng `custom_promp","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. Tạo ảnh nền từ text prompt bằng Vertex AI Gemini","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. Merge selfie vào ảnh nền đã tạo","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"Phải cung cấp `preset_image_id` HOẶC `preset_image_url` HOẶC `custom_prompt` (chỉ một trong ba).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string, optional): ID ảnh selfie đã lưu trong database (người). Phải cung cấp `selfie_id` HOẶC `selfie_image_url` (không phải cả hai).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string, optional): URL ảnh selfie trực tiếp (thay thế cho `selfie_id`).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Các giá trị hỗ trợ: `\"original\"`, `\"1:1\"`, `\"3:2\"`, `\"2:3\"`, `\"3:4\"`, `\"4:3\"`, `\"4:5\"`, `\"5:4\"`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"request\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"targetUrl\": \"https://resources.d.shotpix.app/faceswap-images/preset/landscape.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfieUrl\": \"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_001.png\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Processing successful\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"finalResultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vision\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"checked\": false,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"isSafe\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"error\": \"Safety check skipped for Vertex AI mode\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"storage\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"attemptedDownload\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"downloadStatus\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"savedToR2\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"r2Key\": \"results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"publicUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"database\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"attempted\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultId\": \"result_1234567890_abc123\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.3. POST `/enhance` - AI Enhance","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** AI enhance ảnh - cải thiện chất lượng, độ sáng, độ tương phản và chi tiết của ảnh.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Các endpoints không phải faceswap (`/enhance`, `/beauty`, `/filter`, `/restore`, `/aging`, `/background`) hỗ trợ giá trị `\"original\"` cho `aspect_ra","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Khi `aspect_ratio` là `\"original\"` hoặc không được cung cấp, hệ thống sẽ tự động:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. Lấy kích thước (width/height) từ ảnh input","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. Tính toán tỷ lệ khung hình thực tế","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. Chọn tỷ lệ gần nhất trong danh sách hỗ trợ của Vertex AI","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"4. Sử dụng tỷ lệ đó để generate ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Điều này đảm bảo ảnh kết quả giữ được tỷ lệ gần với ảnh gốc thay vì mặc định về 1:1.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Các giá trị hỗ trợ:** `\"original\"`, `\"1:1\"`, `\"3:2\"`, `\"2:3\"`, `\"3:4\"`, `\"4:3\"`, `\"4:5\"`, `\"5:4\"`, `\"9:16\"`, `\"16:9\"`, `\"21:9\"`. Mặc định: `\"origi","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/enhance \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"1:1\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `image_url` (string, required): URL ảnh cần enhance.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/enhance_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Image enhancement completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Enhancement completed\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.4. POST `/beauty` - AI Beauty","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** AI beautify ảnh - cải thiện thẩm mỹ khuôn mặt (lý tưởng cho selfies và chân dung). Làm mịn da, xóa mụn, làm sáng mắt, tinh chỉnh khuôn m","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/beauty \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"1:1\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `image_url` (string, required): URL ảnh cần beautify.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/beauty_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Image beautification completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Beautification completed\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tính năng AI Beauty:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Làm mịn da (smooth skin)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Xóa mụn và vết thâm (removes blemishes/acne)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Đều màu da (evens skin tone)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Làm thon mặt và đường viền hàm một cách tinh tế (slims face/jawline subtly)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Làm sáng mắt (brightens eyes)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Tăng cường môi và lông mày (enhances lips and eyebrows)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Mở rộng mắt nhẹ (enlarges eyes slightly, optional)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Làm mềm hoặc chỉnh hình mũi (softens or reshapes nose)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Tự động điều chỉnh makeup (adjusts makeup automatically)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** AI Beauty tập trung vào cải thiện thẩm mỹ khuôn mặt, khác với AI Enhance (cải thiện chất lượng kỹ thuật như độ sắc nét, giảm nhiễu).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.5. POST `/filter` - AI Filter (Styles)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** AI Filter (Styles) - Áp dụng các style sáng tạo hoặc điện ảnh từ preset lên selfie trong khi giữ nguyên tính toàn vẹn khuôn mặt.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hành vi theo Provider:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Vertex AI (mặc định):** Sử dụng `prompt_json` từ metadata của preset để áp dụng style. Preset phải có `prompt_json`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **WaveSpeed (`provider: \"wavespeed\"`):** Không sử dụng `prompt_json`. Thay vào đó, WaveSpeed tự phân tích style của preset image (figurine, pop mart","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/filter \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"1:1\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"additional_prompt\": \"Add dramatic lighting\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hoặc sử dụng selfie_image_url:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/filter \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://resources.d.shotpix.app/faceswap-images/selfie/selfie_001.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preset_image_id` (string, required): ID preset đã lưu trong database (format: `preset_...`). Preset phải có `prompt_json` (chỉ yêu cầu cho Vertex p","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string, optional): ID selfie đã lưu trong database. Bắt buộc nếu không có `selfie_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string, optional): URL ảnh selfie trực tiếp. Bắt buộc nếu không có `selfie_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `additional_prompt` (string, optional): Prompt bổ sung để tùy chỉnh style.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `provider` (string, optional): Provider AI. Giá trị: `\"vertex\"` (mặc định), `\"wavespeed\"` (Flux), hoặc `\"wavespeed_gemini_2_5_flash_image\"` (Gemini ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/filter_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Style filter applied successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Filter applied\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tính năng AI Filter:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Đọc prompt_json từ preset (chứa thông tin về style, lighting, composition, camera, background)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Áp dụng style sáng tạo/điện ảnh từ preset lên selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Giữ nguyên 100% khuôn mặt, đặc điểm, cấu trúc xương, màu da","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Chỉ thay đổi style, môi trường, ánh sáng, màu sắc, và mood hình ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Hỗ trợ additional_prompt để tùy chỉnh thêm","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Preset phải có prompt_json (được tạo tự động khi upload preset với `enableVertexPrompt=true`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Nếu preset chưa có prompt_json, API sẽ tự động generate từ preset image","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Khác với `/faceswap`: Filter giữ nguyên khuôn mặt và chỉ áp dụng style, không thay đổi khuôn mặt","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Parameter `redraw`:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `redraw: true` → Bỏ qua cache, luôn generate ảnh mới (sử dụng cho nút \"Redraw\")","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `redraw: false` hoặc không set → Check cache trước khi generate","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Flow xử lý /filter:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"flowchart TD","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"START([Client Request]) --> PARSE[Parse Request Body]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"PARSE --> VALIDATE{Valid Input?}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"VALIDATE -->|No| ERR400[400: Missing required field]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"VALIDATE -->|Yes| CHECK_REDRAW{redraw: true?}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CHECK_REDRAW -->|Yes| LOOKUP_SELFIE_REDRAW[Lookup Selfie in DB]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CHECK_REDRAW -->|No| LOOKUP_SELFIE[Lookup Selfie in DB]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"LOOKUP_SELFIE --> SELFIE_EXISTS{Selfie Exists?}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"LOOKUP_SELFIE_REDRAW --> SELFIE_EXISTS_REDRAW{Selfie Exists?}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"SELFIE_EXISTS -->|Yes| CALL_AI[Call AI Provider]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"SELFIE_EXISTS -->|No| CHECK_CACHE{Check KV Cache}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"SELFIE_EXISTS_REDRAW -->|Yes| CALL_AI_REDRAW[Call AI Provider]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"SELFIE_EXISTS_REDRAW -->|No| ERR404_REDRAW[404: Selfie not found<br/>Cannot redraw without selfie]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CHECK_CACHE -->|Found| RETURN_CACHED[200: Return Cached Result<br/>cached: true]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CHECK_CACHE -->|Not Found| ERR404[404: Selfie not found<br/>No cached result]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CALL_AI --> AI_RESULT{AI Success?}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CALL_AI_REDRAW --> AI_RESULT_REDRAW{AI Success?}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"AI_RESULT -->|Error| ERR500[500: AI Processing Error<br/>Selfie NOT deleted<br/>NO cache stored]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"AI_RESULT -->|Success| CACHE_RESULT[Cache Result in KV<br/>TTL: 24h]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"AI_RESULT_REDRAW -->|Error| ERR500","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"AI_RESULT_REDRAW -->|Success| CACHE_RESULT_REDRAW[Update Cache in KV<br/>TTL: 24h]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CACHE_RESULT --> SUCCESS[200: Return Result<br/>resultImageUrl]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"CACHE_RESULT_REDRAW --> SUCCESS_REDRAW[200: Return NEW Result<br/>resultImageUrl]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"ERR400 --> END([End])","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"ERR404 --> END","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"ERR404_REDRAW --> END","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"ERR500 --> RETRY_POSSIBLE([Client Can Retry<br/>Selfie still exists])","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"RETURN_CACHED --> END","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"SUCCESS --> END","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"SUCCESS_REDRAW --> END","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style START fill:#e1f5fe","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style SUCCESS fill:#c8e6c9","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style SUCCESS_REDRAW fill:#c8e6c9","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style RETURN_CACHED fill:#fff9c4","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style ERR400 fill:#ffcdd2","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style ERR404 fill:#ffcdd2","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style ERR404_REDRAW fill:#ffcdd2","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style ERR500 fill:#ffcdd2","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"style RETRY_POSSIBLE fill:#ffe0b2","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Bảng tóm tắt các trường hợp:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Key Rules:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. **Chỉ cache khi SUCCESS** - Error không cache","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. **Selfie được quản lý theo queue** - Tối đa `SELFIE_MAX_FILTER` selfies (mặc định: 5), tự động xóa cũ nhất khi vượt quá","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. **`redraw: true` bỏ qua cache** - Luôn generate mới","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"4. **Cache TTL = 24h** - Sau 24h cache tự expire","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.6. POST `/restore` - AI Restore","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** AI khôi phục và nâng cấp ảnh - phục hồi ảnh bị hư hỏng, cũ, mờ, hoặc đen trắng thành ảnh chất lượng cao với màu sắc sống động.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/restore \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"1:1\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `image_url` (string, required): URL ảnh cần khôi phục (ảnh cũ, bị hư hỏng, mờ, hoặc đen trắng).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Xem [Lưu ý về Aspect Ratio](#23-post-enhance---ai-enhance) cho chi tiết. Mặc định: `\"original\"`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/restore_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Image restoration completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Restoration completed\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tính năng AI Restore:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Khôi phục ảnh bị hư hỏng (fix scratches, tears, noise, blurriness)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Chuyển đổi ảnh đen trắng thành màu với màu sắc sống động","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Nâng cấp chất lượng lên 16K DSLR quality","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Tăng cường chi tiết (face, eyes, hair, clothing)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Thêm ánh sáng, bóng đổ, và độ sâu trường ảnh thực tế","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Retouching chuyên nghiệp cấp Photoshop","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- High dynamic range, ultra-HD, lifelike textures","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.7. POST `/aging` - AI Aging","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** AI biến đổi tuổi khuôn mặt - áp dụng style tuổi từ preset lên selfie. Mỗi preset chứa prompt_json định nghĩa style tuổi cụ thể (em bé, n","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Hỗ trợ `aspect_ratio` tương tự `/enhance`. Khi `aspect_ratio` là `\"original\"` hoặc không được cung cấp, hệ thống sẽ tự động:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. Lấy kích thước (width/height) từ ảnh selfie input","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. Tính toán tỷ lệ khung hình thực tế","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. Chọn tỷ lệ gần nhất trong danh sách hỗ trợ của Vertex AI","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"4. Sử dụng tỷ lệ đó để generate ảnh","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Điều này đảm bảo ảnh kết quả giữ được tỷ lệ gần với ảnh gốc thay vì mặc định về 1:1.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Các giá trị hỗ trợ:** `\"original\"`, `\"1:1\"`, `\"3:2\"`, `\"2:3\"`, `\"3:4\"`, `\"4:3\"`, `\"4:5\"`, `\"5:4\"`, `\"9:16\"`, `\"16:9\"`, `\"21:9\"`. Mặc định: `\"origi","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hành vi theo Provider:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **Vertex AI (mặc định):** Sử dụng `prompt_json` từ metadata của preset để áp dụng biến đổi tuổi. Preset phải có `prompt_json`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- **WaveSpeed (`provider: \"wavespeed\"`):** Sử dụng `prompt_json` nếu có, hoặc phân tích style của preset image trực tiếp. Gửi images theo thứ tự `[sel","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/aging \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"aging_baby_preset_001\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hoặc sử dụng selfie_image_url:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/aging \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preset_image_id\": \"aging_elderly_preset_001\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://example.com/selfie.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"original\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"additional_prompt\": \"Make the aging look natural\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preset_image_id` (string, required*): ID preset aging đã lưu trong database. Preset chứa `prompt_json` định nghĩa style tuổi. *Bắt buộc nếu không c","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preset_image_url` (string, required*): URL ảnh preset trực tiếp. *Bắt buộc nếu không có `preset_image_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string, required*): ID selfie đã lưu trong database. *Bắt buộc nếu không có `selfie_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string, required*): URL ảnh selfie trực tiếp. *Bắt buộc nếu không có `selfie_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỷ lệ khung hình. Mặc định: `\"original\"`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `additional_prompt` (string, optional): Prompt bổ sung để tùy chỉnh.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `provider` (string, optional): Provider AI. Giá trị: `\"vertex\"` (mặc định), `\"wavespeed\"` (Flux), hoặc `\"wavespeed_gemini_2_5_flash_image\"` (Gemini ","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/aging_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Aging transformation completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Aging completed\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Tính năng AI Aging:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Sử dụng prompt_json từ preset (chứa hướng dẫn biến đổi tuổi cụ thể)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Mỗi preset có style tuổi riêng (em bé, thiếu niên, trung niên, người già, v.v.)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Giữ nguyên race, ethnicity, skin tone, gender","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- Hỗ trợ additional_prompt để tùy chỉnh thêm","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.8. POST `/upscaler4k` - AI Upscale 4K","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Upscale ảnh lên độ phân giải 4K sử dụng WaveSpeed AI.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Endpoint này yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/upscaler4k \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"image_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"profile_1234567890\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `image_url` (string, required): URL ảnh cần upscale.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/upscaler4k_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Upscaling completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"provider\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"success\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"statusCode\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Upscaler4K image upscaling completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"finalResultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/upscaler4k_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"vertex\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"endpoint\": \"https://api.wavespeed.ai/api/v3/wavespeed-ai/ultimate-image-upscaler\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"durationMs\": 5000","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"inputSafety\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"checked\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"isSafe\": true","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"outputSafety\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"checked\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"isSafe\": true","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.9. POST `/remove-object` - AI Xóa vật thể","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Xóa vật thể hoặc vùng được chỉ định bằng mask khỏi ảnh, lấp đầy bằng nền tự nhiên. Sử dụng WaveSpeed Bria Eraser API (SOTA object remova","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Quy trình:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. Upload ảnh gốc qua `POST /upload-url` (type=selfie, action=remove_object)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. Upload mask qua `POST /upload-url` (type=mask) - vùng trắng = xóa, vùng đen = giữ lại","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. Gọi `POST /remove-object` với selfie_id và mask_id","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/remove-object \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"E0PtVZEio5fctjMd\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"mask_id\": \"mask_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hoặc dùng URL trực tiếp:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/remove-object \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"mask_image_url\": \"https://resources.d.shotpix.app/mask/xyz.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string): ID ảnh gốc (từ upload-url type=selfie). Không dùng cùng `selfie_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string): URL ảnh gốc. Không dùng cùng `selfie_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `mask_id` (string): ID mask (từ upload-url type=mask). Không dùng cùng `mask_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `mask_image_url` (string): URL mask. Không dùng cùng `mask_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý kỹ thuật:** API sử dụng WaveSpeed Bria Eraser - không cần prompt, chỉ gửi ảnh gốc + mask. Không hỗ trợ `aspect_ratio`, `model`, `provider` (lu","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_id\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Object removal completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Sau khi xử lý, selfie và mask sẽ tự động bị xóa.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.10. POST `/expression` - AI Thay đổi biểu cảm","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Thay đổi biểu cảm khuôn mặt trong ảnh dựa trên loại biểu cảm được chọn.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Danh sách Expression hỗ trợ:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/expression \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"E0PtVZEio5fctjMd\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"expression\": \"smile\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"aspect_ratio\": \"original\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hoặc dùng URL trực tiếp:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/expression \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"expression\": \"laugh\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string): ID selfie. Không dùng cùng `selfie_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string): URL ảnh. Không dùng cùng `selfie_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `expression` (string, required): Loại biểu cảm. Giá trị: `sad`, `laugh`, `smile`, `dimpled_smile`, `open_eye`, `close_eye`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `aspect_ratio` (string, optional): Tỉ lệ khung hình. Mặc định `original`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `model` (string, optional): Model AI. Mặc định `2.5`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `provider` (string, optional): `vertex` hoặc `wavespeed`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_id\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"expression\": \"smile\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Expression modification completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Sau khi xử lý, selfie sẽ tự động bị xóa.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.11. POST `/expand` - AI Expand","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Mở rộng/outpaint ảnh sử dụng WaveSpeed AI. Client tạo PNG với vùng transparent là nơi AI sẽ fill nội dung mới.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Cách hoạt động:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. Client tạo ảnh PNG với kích thước mong muốn (vd: 1080x1920 cho story)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. Đặt ảnh gốc vào vị trí mong muốn trong canvas","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. Vùng transparent (alpha=0) là nơi AI sẽ tự động fill/expand","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"4. Upload PNG lên và gọi API","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/expand \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"E0PtVZEio5fctjMd\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/expand \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string): ID selfie (PNG với transparent areas). Không dùng cùng `selfie_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string): URL ảnh PNG. Không dùng cùng `selfie_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_id\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Image expansion completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Sau khi xử lý, selfie sẽ tự động bị xóa.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 2.12. POST `/replace-object` - AI Replace Object","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Thay thế vật thể/vùng được đánh dấu trong ảnh bằng nội dung mới do người dùng mô tả. Sử dụng WaveSpeed AI flux-2-klein-9b/edit.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Yêu cầu API key authentication khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Cách hoạt động:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"1. Frontend ghép ảnh gốc + mask thành 1 ảnh duy nhất (vùng highlight = nơi cần thay thế)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"2. Upload ảnh đã ghép lên","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"3. Gọi API kèm `custom_prompt` mô tả nội dung muốn thay thế vào","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/replace-object \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_id\": \"E0PtVZEio5fctjMd\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"custom_prompt\": \"a red sports car\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/replace-object \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"selfie_image_url\": \"https://resources.d.shotpix.app/selfie/abc.png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"custom_prompt\": \"a beautiful garden with flowers\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profile_id\": \"CbS0w8Ed8ezrlJ7o\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_id` (string): ID ảnh đã ghép (origin + mask). Không dùng cùng `selfie_image_url`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `selfie_image_url` (string): URL ảnh đã ghép. Không dùng cùng `selfie_id`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `custom_prompt` (string, required): Mô tả nội dung muốn thay thế vào vùng được đánh dấu.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `profile_id` (string, required): ID profile người dùng.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"result_id\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"resultImageUrl\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Object replacement completed\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý:** Sau khi xử lý, selfie sẽ tự động bị xóa.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Error Responses:** Xem [Error Codes Reference](#error-codes-reference)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI - 3. Quản lý Profile","heading":"3. Quản lý Profile","text":"### 3. Quản lý Profile","url":"#/API_TONG_QUAN_VI.md?id=3-qun-l-profile","level":3},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 3.1. POST `/profiles` - Tạo profile","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Tạo profile mới.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Minimal (chỉ cần device_id):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/profiles \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Full request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/profiles \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"userID\": \"user_external_123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"name\": \"John Doe\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"email\": \"john@example.com\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"avatar_url\": \"https://example.com/avatar.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preferences\": \"{\\\"theme\\\":\\\"dark\\\",\\\"language\\\":\\\"vi\\\"}\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Với preferences dạng object:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/profiles \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"name\": \"John Doe\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"email\": \"john@example.com\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"avatar_url\": \"https://example.com/avatar.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"preferences\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"theme\": \"dark\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"language\": \"vi\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Hoặc gửi device_id qua header:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"curl -X POST https://api.d.shotpix.app/profiles \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"X-API-Key: your_api_key_here\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"-H \"x-device-id: device_1765774126587_yaq0uh6rvz\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"name\": \"John Doe\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"email\": \"john@example.com\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `device_id` (string, optional): ID thiết bị. Có thể gửi trong body hoặc header `x-device-id`. Nếu không có, sẽ là `null`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `userID` hoặc `user_id` (string, optional): **User ID bên ngoài** dùng để tìm kiếm profile. Đây là ID từ hệ thống của bạn (ví dụ: Firebase UID, Auth","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `id` (string, optional): ID profile nội bộ. Nếu không có, hệ thống tự tạo bằng `nanoid(16)`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `name` (string, optional): tên profile.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `email` (string, optional): email.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `avatar_url` (string, optional): URL avatar.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `preferences` (string hoặc object, optional): preferences dạng JSON string hoặc object. Nếu là object, hệ thống tự động chuyển thành JSON string trư","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Lưu ý về ID:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `id` (profile_id): ID nội bộ của profile, tự động tạo nếu không cung cấp.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `user_id`: ID từ hệ thống bên ngoài (Firebase, Auth0, v.v.), dùng để liên kết với user của bạn.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `device_id`: ID thiết bị, dùng để theo dõi user chưa đăng nhập.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"id\": \"uYNgRR70Ry9OFuMV\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"user_id\": \"user_external_123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"created_at\": \"2025-12-15T04:48:47.676Z\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"updated_at\": \"2025-12-15T04:48:47.676Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"message\": \"Profile created successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"profileId\": \"uYNgRR70Ry9OFuMV\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"deviceId\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"\"userId\": \"user_external_123\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"#### 3.2. GET `/profiles/{id}` - Lấy profile","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Mục đích:** Lấy thông tin profile theo Profile ID, Device ID, hoặc User ID.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Path Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"- `id` (string, required): Có thể là **Profile ID**, **Device ID**, hoặc **User ID**. API sẽ tìm theo thứ tự: profile_id → device_id → user_id.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tổng quan API Face Swap AI","heading":"Tổng quan API Face Swap AI","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng Profile ID","heading":"Tìm bằng Profile ID","text":"# Tìm bằng Profile ID","url":"#/API_TONG_QUAN_VI.md","level":1},{"title":"Tìm bằng Profile ID","heading":"Tìm bằng Profile ID","text":"curl https://api.d.shotpix.app/profiles/uYNgRR70Ry9OFuMV \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng Profile ID","heading":"Tìm bằng Profile ID","text":"-H \"X-API-Key: your_api_key_here\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng Device ID","heading":"Tìm bằng Device ID","text":"# Tìm bằng Device ID","url":"#/API_TONG_QUAN_VI.md","level":1},{"title":"Tìm bằng Device ID","heading":"Tìm bằng Device ID","text":"curl https://api.d.shotpix.app/profiles/device_1765774126587_yaq0uh6rvz \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng Device ID","heading":"Tìm bằng Device ID","text":"-H \"X-API-Key: your_api_key_here\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"# Tìm bằng User ID (từ hệ thống bên ngoài)","url":"#/API_TONG_QUAN_VI.md","level":1},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/profiles/user_external_123 \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"-H \"X-API-Key: your_api_key_here\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"uYNgRR70Ry9OFuMV\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"user_id\": \"user_external_123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"name\": \"John Doe\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"email\": \"john@example.com\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"avatar_url\": \"https://example.com/avatar.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preferences\": \"{\\\"theme\\\":\\\"dark\\\",\\\"language\\\":\\\"vi\\\"}\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2025-12-15T04:48:47.676Z\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"updated_at\": \"2025-12-15T04:48:47.676Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Profile retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Lưu ý:** Cả ba cách tìm (bằng Profile ID, Device ID, hoặc User ID) đều trả về cùng một profile với đầy đủ thông tin.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 3.3. PUT `/profiles/{id}` - Cập nhật profile","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Cập nhật thông tin profile.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl -X PUT https://api.d.shotpix.app/profiles/profile_1234567890 \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"-H \"Content-Type: application/json\" \\","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"name\": \"John Doe Updated\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"email\": \"john.updated@example.com\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"avatar_url\": \"https://example.com/new-avatar.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preferences\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"theme\": \"light\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"language\": \"en\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `name` (string, optional): tên profile.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `email` (string, optional): email.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `avatar_url` (string, optional): URL avatar.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `preferences` (string hoặc object, optional): preferences dạng JSON string hoặc object. Nếu là object, hệ thống tự động chuyển thành JSON string trư","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Lưu ý:** ID profile phải được cung cấp trong URL path (`/profiles/{id}`), không cần gửi trong body.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"uYNgRR70Ry9OFuMV\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"user_id\": \"user_external_123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"name\": \"John Doe Updated\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"email\": \"john.updated@example.com\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"avatar_url\": \"https://example.com/new-avatar.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preferences\": \"{\\\"theme\\\":\\\"light\\\",\\\"language\\\":\\\"en\\\"}\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2025-12-15T04:48:47.676Z\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"updated_at\": \"2025-12-15T05:00:00.000Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Profile updated successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 3.4. GET `/profiles` - Liệt kê profiles","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Liệt kê tất cả profiles (dùng cho admin/debugging).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/profiles","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"profiles\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"uYNgRR70Ry9OFuMV\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"device_id\": \"device_1765774126587_yaq0uh6rvz\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"user_id\": \"user_external_123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"name\": \"John Doe\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"email\": \"john@example.com\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"avatar_url\": \"https://example.com/avatar.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preferences\": \"{\\\"theme\\\":\\\"dark\\\",\\\"language\\\":\\\"vi\\\"}\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2025-12-15T04:48:47.676Z\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"updated_at\": \"2025-12-15T04:48:47.676Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Profiles retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - 4. Truy vấn Dữ liệu","heading":"4. Truy vấn Dữ liệu","text":"### 4. Truy vấn Dữ liệu","url":"#/API_TONG_QUAN_VI.md?id=4-truy-vn-d-liu","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.1. GET `/presets` - Liệt kê presets","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Trả về danh sách preset trong database.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/presets","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/presets?include_thumbnails=true","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Query Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `include_thumbnails` (optional): `true` để bao gồm cả presets có thumbnail. Mặc định chỉ trả về presets không có thumbnail.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"presets\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preset_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"image_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"hasPrompt\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"prompt_json\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url\": \"https://resources.d.shotpix.app/webp_1x/face-swap/wedding_both_1.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_format\": \"webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_resolution\": \"1x\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2024-01-01T00:00:00.000Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Presets retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.2. GET `/presets/{id}` - Lấy preset theo ID","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Lấy thông tin chi tiết của một preset theo ID (bao gồm `prompt_json`).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/presets/preset_1234567890_abc123","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preset_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"image_url\": \"https://resources.d.shotpix.app/faceswap-images/preset/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"hasPrompt\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"prompt_json\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"prompt\": \"...\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"style\": \"...\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lighting\": \"...\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url\": \"https://resources.d.shotpix.app/webp_1x/face-swap/wedding_both_1.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_format\": \"webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_resolution\": \"1x\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2024-01-01T00:00:00.000Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Preset retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"presetId\": \"preset_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"hasPrompt\": true","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.3. DELETE `/presets/{id}` - Xóa preset","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Xóa preset khỏi D1 và R2.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl -X DELETE https://api.d.shotpix.app/presets/preset_1234567890_abc123","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Preset deleted successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.4. GET `/selfies` - Liệt kê selfies","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Trả về tối đa 50 selfie gần nhất của một profile. Endpoint này được sử dụng bởi mobile app để lấy danh sách selfies đã upload.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key (có thể được bật trong tương lai).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/selfies?profile_id=profile_1234567890","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Query Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `profile_id` (required): ID profile.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `limit` (optional): Số lượng selfies tối đa trả về (1-50). Mặc định: 50.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"selfies\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"selfie_url\": \"https://resources.d.shotpix.app/faceswap-images/selfie/example.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"action\": \"faceswap\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2024-01-01T00:00:00.000Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Selfies retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.5. DELETE `/selfies/{id}` - Xóa selfie","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Xóa selfie khỏi D1 và R2.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl -X DELETE https://api.d.shotpix.app/selfies/selfie_1234567890_xyz789","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Selfie deleted successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"selfieId\": \"selfie_1234567890_xyz789\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"r2Deleted\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"r2Error\": null","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.6. GET `/results` - Liệt kê results","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Trả về tối đa 50 kết quả generated images (face swap, background, enhance, beauty, filter, restore, aging, upscaler4k) gần nhất. Endpoin","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key (có thể được bật trong tương lai).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/results","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/results?profile_id=profile_1234567890","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Query Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `profile_id` (optional): ID profile để lọc kết quả.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `limit` (optional): Số lượng results tối đa trả về (1-50). Mặc định: 50.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"result_url\": \"https://resources.d.shotpix.app/faceswap-images/results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"action\": \"faceswap\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2024-01-01T00:00:00.000Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Results retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:** `data` là mảng phẳng (flat array) các result. Mỗi item:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `id`: ID duy nhất của result","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `result_url`: URL public của ảnh kết quả","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `action`: Loại action (`faceswap`, `background`, `upscaler4k`, `enhance`, `beauty`, `filter`, `restore`, `aging`). Có thể null.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `created_at`: Thời gian tạo (ISO 8601)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.7. DELETE `/results/{id}` - Xóa result","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Xóa kết quả khỏi D1 và R2.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Yêu cầu API key khi `ENABLE_MOBILE_API_KEY_AUTH=true`.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl -X DELETE https://api.d.shotpix.app/results/result_1234567890_abc123","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"data\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Result deleted successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"resultId\": \"result_1234567890_abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"databaseDeleted\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"r2Deleted\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"r2Key\": \"results/result_123.jpg\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"r2Error\": null","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.8. GET `/thumbnails` - Liệt kê thumbnails","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Lấy danh sách thumbnails từ database. Trả về tất cả presets có thumbnail (bất kỳ cột thumbnail nào không null).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/thumbnails","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Query Parameters:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Không có query parameters. Endpoint trả về tất cả presets có thumbnail.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Lưu ý:** Endpoint này query từ bảng `presets` với điều kiện `thumbnail_r2` không null và không rỗng. Dữ liệu thumbnail được lưu dưới dạng JSON objec","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnails\": [","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"fs_wonder_f_3\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"ext\": \"png\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_r2\": \"{\\\"webp_1x\\\":\\\"webp_1x/fs_wonder_f_3.webp\\\",\\\"lottie_1x\\\":\\\"lottie_1x/fs_wonder_f_3.json\\\",\\\"lottie_avif_2x\\\":\\\"lottie_avif_2x/fs_won","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url\": \"https://resources.d.shotpix.app/webp_1x/fs_wonder_f_3.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url_1x\": \"https://resources.d.shotpix.app/webp_1x/fs_wonder_f_3.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url_1_5x\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url_2x\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url_3x\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"thumbnail_url_4x\": null,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"created_at\": \"2024-01-01T00:00:00.000Z\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Thumbnails retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Lưu ý:** Response trả về tất cả các cột thumbnail resolution (1x, 1.5x, 2x, 3x) từ database. `thumbnail_url` là alias của `thumbnail_url_1x` cho bac","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.9. GET `/thumbnails/{id}/preset` - Lấy preset_id từ thumbnail_id","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Lấy preset_id từ thumbnail_id (dùng cho mobile app).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/thumbnails/preset_1234567890_abc123/preset","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"preset_id\": \"preset_1234567890_abc123\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Preset ID retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 4.10. Thumbnail URL Rules - Quy tắc URL Thumbnail","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Tài liệu chi tiết về cấu trúc URL và quy tắc đặt tên cho thumbnails trong hệ thống.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Cấu trúc URL Thumbnail:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Thumbnails được lưu trữ trong R2 bucket với cấu trúc path như sau:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"preset_thumb/{folderType}_{resolution}/{presetId}.{ext}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Format URL đầy đủ:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"https://resources.d.shotpix.app/{bucket-name}/preset_thumb/{folderType}_{resolution}/{presetId}.{ext}","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_avif_2x/fs_wonder_f_3.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/webp_4x/preset_1234567890_abc123.webp","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Folder Types (Loại thư mục):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Resolutions (Độ phân giải):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Folder Naming Convention (Quy tắc đặt tên thư mục):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Format: `{folderType}_{resolution}`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Tất cả các folder types và resolutions được hỗ trợ:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `webp_1x`, `webp_1.5x`, `webp_2x`, `webp_3x`, `webp_4x`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `lottie_1x`, `lottie_1.5x`, `lottie_2x`, `lottie_3x`, `lottie_4x`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `lottie_avif_1x`, `lottie_avif_1.5x`, `lottie_avif_2x`, `lottie_avif_3x`, `lottie_avif_4x`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Tổng cộng: 15 folder types × resolutions**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**File Naming Convention (Quy tắc đặt tên file):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Format: `{presetId}.{ext}`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `presetId`: ID của preset (ví dụ: `fs_frosted_window_portrait_f_4`, `preset_1234567890_abc123`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `ext`: Extension dựa trên folder type:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `webp` → `.webp`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `lottie` → `.json`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `lottie_avif` → `.json`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Ví dụ file names:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `fs_frosted_window_portrait_f_4.json` (lottie thumbnail)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `fs_wonder_f_3.webp` (webp thumbnail)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `preset_1234567890_abc123.json` (lottie_avif thumbnail)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Database Storage (Lưu trữ trong Database):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Thumbnails được lưu trong bảng `presets` với trường `thumbnail_r2` dạng JSON:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"webp_1x\": \"preset_thumb/webp_1x/fs_frosted_window_portrait_f_4.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"webp_1.5x\": \"preset_thumb/webp_1.5x/fs_frosted_window_portrait_f_4.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"webp_2x\": \"preset_thumb/webp_2x/fs_frosted_window_portrait_f_4.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"webp_3x\": \"preset_thumb/webp_3x/fs_frosted_window_portrait_f_4.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"webp_4x\": \"preset_thumb/webp_4x/fs_frosted_window_portrait_f_4.webp\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_1x\": \"preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_1.5x\": \"preset_thumb/lottie_1.5x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_2x\": \"preset_thumb/lottie_2x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_3x\": \"preset_thumb/lottie_3x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_4x\": \"preset_thumb/lottie_4x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_avif_1x\": \"preset_thumb/lottie_avif_1x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_avif_1.5x\": \"preset_thumb/lottie_avif_1.5x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_avif_2x\": \"preset_thumb/lottie_avif_2x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_avif_3x\": \"preset_thumb/lottie_avif_3x/fs_frosted_window_portrait_f_4.json\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"lottie_avif_4x\": \"preset_thumb/lottie_avif_4x/fs_frosted_window_portrait_f_4.json\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Key trong JSON = `{folderType}_{resolution}`**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Value trong JSON = R2 key (full path từ root)**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Cách xây dựng URL từ R2 key:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"1. Lấy R2 key từ database: `preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"2. Kết hợp với R2 public domain: `https://resources.d.shotpix.app/{bucket-name}/{r2Key}`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"3. Kết quả: `https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Lưu ý quan trọng:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"1. **Không có duplicate folders:** URL không bao giờ có dạng `preset_thumb/lottie_1x/lottie_1x/` (folder name bị lặp). Format đúng là `preset_thumb/lo","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"2. **Preset ID extraction:** Preset ID được extract từ filename (basename), không bao gồm path. Ví dụ:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- File: `lottie_1x/fs_frosted_window_portrait_f_4.json`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Preset ID: `fs_frosted_window_portrait_f_4` (không phải `lottie_1x/fs_frosted_window_portrait_f_4`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"3. **Bucket name:** Bucket name khác nhau theo environment:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Development: `faceswap-images-office-dev`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Production: `faceswap-images-office-prod`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Default: `faceswap-images-office`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"4. **R2 Public Domain:** Luôn sử dụng `https://resources.d.shotpix.app` cho public URLs.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"5. **Cache Control:** Tất cả thumbnails có cache control header: `public, max-age=31536000, immutable` (1 năm).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Ví dụ sử dụng trong code:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**JavaScript/TypeScript:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Lấy thumbnail URL từ database response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"const preset = {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"id: \"fs_frosted_window_portrait_f_4\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnail_r2: '{\"lottie_1x\":\"preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\"}'","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"const thumbnailData = JSON.parse(preset.thumbnail_r2);","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"const r2Key = thumbnailData['lottie_1x']; // \"preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"const bucketName = \"faceswap-images-office-dev\";","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"const publicUrl = `https://resources.d.shotpix.app/${bucketName}/${r2Key}`;","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Result: https://resources.d.shotpix.app/faceswap-images-office-dev/preset_thumb/lottie_1x/fs_frosted_window_portrait_f_4.json","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mobile App (Swift/Kotlin):**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Swift example","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"let thumbnailData = try JSONDecoder().decode([String: String].self, from: preset.thumbnailR2.data(using: .utf8)!)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"if let r2Key = thumbnailData[\"lottie_1x\"] {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"let bucketName = \"faceswap-images-office-dev\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"let publicUrl = \"https://resources.d.shotpix.app/\\(bucketName)/\\(r2Key)\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Use publicUrl to load thumbnail","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Best Practices:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"1. **Fallback resolution:** Luôn có fallback khi resolution không tồn tại:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"const thumbnailUrl =","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnailData['lottie_4x'] ||","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnailData['lottie_3x'] ||","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnailData['lottie_2x'] ||","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnailData['lottie_1x'] ||","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnailData['webp_4x'] ||","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"thumbnailData['webp_1x'];","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"2. **Format preference:** Ưu tiên format theo thứ tự:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Lottie AVIF (tối ưu nhất cho animation)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Lottie (standard animation)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- WebP (static image fallback)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"3. **Resolution selection:** Chọn resolution dựa trên device pixel ratio:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- 1x devices: `1x` hoặc `1.5x`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- 2x devices (Retina): `2x` hoặc `3x`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- 3x+ devices (Super Retina): `3x` hoặc `4x`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"4. **Error handling:** Luôn kiểm tra URL tồn tại trước khi sử dụng:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"if (thumbnailUrl && thumbnailUrl.startsWith('https://')) {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Safe to use","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - 5. Hệ thống & Cấu hình","heading":"5. Hệ thống & Cấu hình","text":"### 5. Hệ thống & Cấu hình","url":"#/API_TONG_QUAN_VI.md?id=5-h-thng-cu-hnh","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 5.1. GET `/config` - Lấy config","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Lấy cấu hình public của Worker (custom domains).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Request:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"curl https://api.d.shotpix.app/config","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"backendDomain\": \"https://api.d.shotpix.app\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"r2Domain\": \"https://resources.d.shotpix.app\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"kvCache\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"available\": true,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"test\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"details\": {","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"bindingName\": \"PROMPT_CACHE_KV\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"envKeys\": [\"PROMPT_CACHE_KV_BINDING_NAME\", \"...\"]","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"message\": \"Config retrieved successfully\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### 5.2. OPTIONS `/*` - CORS preflight requests","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Mục đích:** Xử lý CORS preflight requests cho tất cả các endpoints. Tự động được gọi bởi trình duyệt khi thực hiện cross-origin requests.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Authentication:** Không yêu cầu API key.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Response:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Trả về HTTP 204 (No Content) với các headers CORS:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `Access-Control-Allow-Origin`: Cho phép tất cả origins","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `Access-Control-Allow-Methods`: GET, POST, PUT, DELETE, OPTIONS","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `Access-Control-Allow-Headers`: Content-Type, Authorization, X-API-Key, và các headers khác","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `Access-Control-Max-Age`: 86400 (24 giờ)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Endpoint `/upload-proxy/*` có hỗ trợ thêm method PUT trong CORS headers.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - 6. Thanh toán & Subscription (Google Play Billing)","heading":"6. Thanh toán & Subscription (Google Play Billing)","text":"## 6. Thanh toán & Subscription (Google Play Billing)","url":"#/API_TONG_QUAN_VI.md?id=6-thanh-ton-subscription-google-play-billing","level":2},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Hệ thống điểm kép (dual credit):","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- **Subscription points** (`sub_point_remaining`): reset mỗi 30 ngày theo chu kỳ subscription, trừ trước","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- **Consumable points** (`consumable_point_remaining`): mua thêm, không bao giờ reset, trừ sau khi sub hết","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Luồng tổng quan","heading":"Luồng tổng quan","text":"### Luồng tổng quan","url":"#/API_TONG_QUAN_VI.md?id=lung-tng-quan","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"┌─────────────────────────────────────────────────────────────────┐","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  1. User mua subscription trên Google Play                      │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  2. App nhận purchaseToken → gọi POST /api/subscription/verify  │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  3. Backend verify với Google Play API → kích hoạt subscription  │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  4. Backend gán sub_point_remaining = points_per_cycle           │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  Sau đó (tự động, không cần app gọi):                           │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  5. Google Play gửi RTDN qua Pub/Sub → POST /webhooks/google    │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│     - RENEWED(2): reset sub points, cycle+1                     │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│     - IN_GRACE(6): status=GRACE, vẫn reset sub points           │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│     - RECOVERED(1): status=ACTIVE, giữ nguyên points            │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│     - EXPIRED(13): chặn hoàn toàn, sub points = 0               │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  6. Backend gửi FCM silent push → app sync trạng thái mới       │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  Khi user dùng AI feature:                                       │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│  7. Backend lazy-check subscription + trừ sub trước, consumable  │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"│     sau (real-time, không cron)                                  │","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"└─────────────────────────────────────────────────────────────────┘","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Cấu hình","heading":"Cấu hình","text":"### Cấu hình","url":"#/API_TONG_QUAN_VI.md?id=cu-hnh","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `ENABLE_CREDIT_SYSTEM`: `\"true\"` để bật hệ thống credit (mặc định `\"false\"`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `CREDIT_COST_*`: Chi phí cho từng action (FACESWAP, BACKGROUND, ENHANCE, BEAUTY, FILTER, RESTORE, AGING, UPSCALER4K)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- `TIER_MULTIPLIER_*`: Hệ số theo tier (FREE=1.0, SUBSCRIBER=0.8)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Subscription SKUs","heading":"Subscription SKUs","text":"### Subscription SKUs","url":"#/API_TONG_QUAN_VI.md?id=subscription-skus","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Consumable SKUs","heading":"Consumable SKUs","text":"### Consumable SKUs","url":"#/API_TONG_QUAN_VI.md?id=consumable-skus","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Endpoints","heading":"Endpoints","text":"### Endpoints","url":"#/API_TONG_QUAN_VI.md?id=endpoints","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### GET `/api/products` - Danh sách sản phẩm","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** API Key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sku\": \"credits_10\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"type\": \"consumable\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"credits\": 10,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"points_per_cycle\": 0,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"name\": \"10 Credits\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"description\": \"Gói 10 credits\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"price_micros\": 22000000000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"currency\": \"VND\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sku\": \"sub_monthly\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"type\": \"subscription\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"credits\": 0,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"points_per_cycle\": 1000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"name\": \"Monthly\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"description\": \"Gói tháng - 1000 điểm/chu kỳ\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"price_micros\": 99000000000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"currency\": \"VND\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### GET `/api/user/balance?profile_id={id}` - Số dư điểm kép + trạng thái subscription","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** API Key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sub_point_remaining\": 800,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"consumable_point_remaining\": 50,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"total_available\": 850,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"subscription_status\": \"ACTIVE\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"total_credits_purchased\": 100,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"total_credits_spent\": 50","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"`subscription_status`: `ACTIVE` | `GRACE` | `CANCELLED` | `EXPIRED` | `PAUSED` | `NONE`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### POST `/api/deposit` - Nạp consumable points (verify Google Play purchase)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** API Key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Mua consumable → điểm vào `consumable_point_remaining` (không bao giờ reset).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"profile_id\": \"abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sku\": \"credits_50\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"purchase_token\": \"google-play-purchase-token\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"order_id\": \"GPA.1234-5678-9012\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Response (success)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"payment_id\": \"pay_xxx\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"credits_granted\": 50,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"COMPLETED\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Lưu ý:** Idempotent theo `order_id` - gọi lại với cùng order_id sẽ trả kết quả cũ.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### GET `/api/deposit/status/{order_id}` - Kiểm tra trạng thái nạp","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** API Key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"pay_xxx\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"profile_id\": \"abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sku\": \"credits_50\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"order_id\": \"GPA.1234-5678-9012\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"COMPLETED\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"credits_granted\": 50","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### POST `/api/subscription/verify` - Kích hoạt subscription (app gọi sau khi mua trên Google Play)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** API Key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Luồng:** User mua subscription trên Google Play → app nhận `purchaseToken` → app gọi endpoint này → backend verify với Google Play API → kích hoạt +","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"profile_id\": \"abc123\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sku\": \"sub_monthly\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"purchase_token\": \"google-play-subscription-token\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"subscription_id\": \"sub_xxx\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"points_per_cycle\": 1000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"expires_at\": 1742592000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"ACTIVE\"","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### GET `/api/subscription/status?profile_id={id}` - Trạng thái subscription hiện tại","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** API Key","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"// Response","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"id\": \"sub_xxx\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"sku\": \"sub_monthly\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"ACTIVE\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"auto_renewing\": 1,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"expires_at\": 1742592000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"last_reset_at\": 1740000000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"cycle_count_used\": 3,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"points_per_cycle\": 1000,","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"cancelled_at\": null","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"status\": \"success\",","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"\"code\": 200","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"#### POST `/webhooks/google` - Google Play RTDN Webhook","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Auth:** Shared secret (`GOOGLE_WEBHOOK_SECRET`)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Nhận thông báo từ Google Play qua Pub/Sub (RTDN). App **KHÔNG** gọi endpoint này — Google gọi tự động.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Subscription events được xử lý:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**One-time product events:**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Refund (type 2): trừ `consumable_point_remaining` (clamp to 0)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Trừ điểm trong AI Endpoints (Dual Credit Deduction)","heading":"Trừ điểm trong AI Endpoints (Dual Credit Deduction)","text":"### Trừ điểm trong AI Endpoints (Dual Credit Deduction)","url":"#/API_TONG_QUAN_VI.md?id=tr-im-trong-ai-endpoints-dual-credit-deduction","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Khi `ENABLE_CREDIT_SYSTEM=true`, mỗi AI endpoint tự động trừ điểm theo 5 bước:","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"1. **Check subscription** — expired → REJECT","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"2. **Grace hết hạn?** — now > expires_at → mark expired → REJECT","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"3. **Lazy reset** — (chỉ ACTIVE) nếu now ≥ last_reset_at + 30 ngày → reset sub = points_per_cycle","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"4. **Fail fast** — sub + consumable < cost → REJECT (HTTP 402)","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"5. **Trừ điểm** — sub trước, hết sub thì trừ consumable","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Nếu AI xử lý lỗi → hoàn điểm vào `consumable_point_remaining` (saga compensation).","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Chi phí = `CREDIT_COST_*` × `TIER_MULTIPLIER_*`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Tiers","heading":"Tiers","text":"### Tiers","url":"#/API_TONG_QUAN_VI.md?id=tiers","level":3},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Tổng kết","heading":"Tổng kết","text":"## Tổng kết","url":"#/API_TONG_QUAN_VI.md?id=tng-kt","level":2},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"**Tổng số API endpoints: 33**","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"Xem danh sách đầy đủ tại [APIs cần tích hợp với mobile](#apis-cần-tích-hợp-với-mobile-15-apis) ở đầu tài liệu.","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài) - Custom Domain","heading":"Custom Domain","text":"## Custom Domain","url":"#/API_TONG_QUAN_VI.md?id=custom-domain","level":2},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- **Worker API Domain**: `https://api.d.shotpix.app` - Dùng cho tất cả API endpoints","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- **R2 Public Domain**: `https://resources.d.shotpix.app` - Dùng cho public URLs của files trong R2 bucket","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Tìm bằng User ID (từ hệ thống bên ngoài)","heading":"Tìm bằng User ID (từ hệ thống bên ngoài)","text":"- Format R2 public URL: `https://resources.d.shotpix.app/{bucket-name}/{key}`","url":"#/API_TONG_QUAN_VI.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"# Sơ Đồ Hệ Thống Điểm & Subscription","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":1},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> **Nguồn Google Play chính thức:**","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> [Integrate Billing Library](https://developer.android.com/google/play/billing/integrate) |","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> [Backend Integration](https://developer.android.com/google/play/billing/backend) |","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> [RTDN Reference](https://developer.android.com/google/play/billing/rtdn-reference) |","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> [Subscription Lifecycle](https://developer.android.com/google/play/billing/lifecycle)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription - LUỒNG 0: MUA & KÍCH HOẠT (CLIENT → BACKEND → GOOGLE)","heading":"LUỒNG 0: MUA & KÍCH HOẠT (CLIENT → BACKEND → GOOGLE)","text":"## LUỒNG 0: MUA & KÍCH HOẠT (CLIENT → BACKEND → GOOGLE)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md?id=lung-0-mua-kch-hot-client-backend-google","level":2},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> **Theo Google docs:** App nhận `purchaseToken` sau khi user mua → gửi token lên backend để verify.","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> Xem: [Integrate - Process purchases](https://developer.android.com/google/play/billing/integrate#process),","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"> [Backend - Verify purchases](https://developer.android.com/google/play/billing/backend)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LUỒNG 0A: MUA SUBSCRIPTION","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────┐      ┌──────────────┐      ┌──────────────┐      ┌──────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  USER    │      │  GOOGLE PLAY │      │   BACKEND    │      │  GOOGLE  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  (App)   │      │  (trên máy)  │      │  (Worker)    │      │  API     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└────┬─────┘      └──────┬───────┘      └──────┬───────┘      └────┬─────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  1. Chọn gói      │                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  sub_monthly      │                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│──────────────────>│                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  2. Thanh toán    │                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  Google xử lý     │                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│<──────────────────│                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  purchaseToken ←──│                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  3. POST /api/subscription/verify        │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  { profile_id, sku, purchase_token }     │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│─────────────────────────────────────────>│                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  4. Verify token  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │──────────────────>│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  valid ✓          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │<──────────────────│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  5. Acknowledge   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │──────────────────>│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  6. DB update:    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  subscription:    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │    status=ACTIVE  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │    points_per_    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │    cycle=1000     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │    last_reset=now │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  profile:         │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │    sub_point=1000 │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  7. Response: { status: ACTIVE,          │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│     points_per_cycle: 1000 }             │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│<─────────────────────────────────────────│                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  8. App cập nhật UI                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LUỒNG 0B: MUA CONSUMABLE","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────┐      ┌──────────────┐      ┌──────────────┐      ┌──────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  USER    │      │  GOOGLE PLAY │      │   BACKEND    │      │  GOOGLE  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  (App)   │      │  (trên máy)  │      │  (Worker)    │      │  API     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└────┬─────┘      └──────┬───────┘      └──────┬───────┘      └────┬─────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  1. Mua credits_50│                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│──────────────────>│                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  2. purchaseToken │                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│<──────────────────│                      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  3. POST /api/deposit                    │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  { profile_id, sku, purchase_token,      │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    order_id }                            │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│─────────────────────────────────────────>│                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  4. Verify        │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │──────────────────>│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  5. Acknowledge   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │──────────────────>│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                                          │  consumable += 50 │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  7. { credits_granted: 50 }              │                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│<─────────────────────────────────────────│                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LUỒNG 0C: WEBHOOK RTDN (GOOGLE → BACKEND → APP qua FCM)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"Sau khi subscription đã active, các event tiếp theo Google gửi tự động","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────┐      ┌──────────────┐      ┌──────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  APP     │      │  GOOGLE PLAY │      │   BACKEND    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  (FCM)   │      │  (Pub/Sub)   │      │  (Worker)    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└────┬─────┘      └──────┬───────┘      └──────┬───────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │  1. RTDN event       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │  (RENEWED/GRACE/     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │   EXPIRED/etc)       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │─────────────────────>│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │  POST /webhooks/     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │  google              │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │                      │  2. Cập nhật DB","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │                      │  (status, points,","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                   │                      │   cycle, etc)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  3. FCM silent push                      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  { type: \"subscription_update\",          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    status: \"RENEWED\" }                   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│<─────────────────────────────────────────│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  4. App nhận FCM  │                      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  → gọi GET /api/  │                      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  user/balance để  │                      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  sync UI          │                      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription - TOÀN BỘ LUỒNG SAU KHI ĐÃ KÍCH HOẠT (ASCII)","heading":"TOÀN BỘ LUỒNG SAU KHI ĐÃ KÍCH HOẠT (ASCII)","text":"## TOÀN BỘ LUỒNG SAU KHI ĐÃ KÍCH HOẠT (ASCII)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md?id=ton-b-lung-sau-khi-kch-hot-ascii","level":2},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌─────────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│   SUBSCRIPTION ĐÃ ACTIVE    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│   (sau luồng 0A ở trên)     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└──────────────┬──────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌─────────────────────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│            TRẠNG THÁI HIỆN TẠI          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  subscription:                          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    status = active                      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    sub_point_remaining = points_per_cycle│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    last_reset_at = now                  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    end_date = now + 30 ngày             │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    cycle_count_used = 1                 │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  profile:                               │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    consumable_point_remaining = 0       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    (tăng khi mua thêm, không bao giờ   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│     reset, không phụ thuộc subscription)│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└──────────────────┬──────────────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────────────────────┼──────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────────────┐   ┌──────────────────────┐   ┌──────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ USER DÙNG ĐIỂM  │   │ GOOGLE PLAY GỬI RTDN │   │ USER MUA CONSUMABLE  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ (xem luồng bên  │   │ (xem luồng bên dưới) │   │ (luồng 0B ở trên)   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  dưới)           │   │                       │   │ consumable += N      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└──────────────────┘   └───────────────────────┘   └──────────────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LUỒNG 1: GOOGLE PLAY RTDN → CẬP NHẬT TRẠNG THÁI","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"Hết chu kỳ 30 ngày","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"Google Play tính phí","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌────────────┴────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"Tính phí OK              Tính phí LỖI","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────────────────────┐  ┌──────────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ (2) SUBSCRIPTION_RENEWED │  │(6) SUBSCRIPTION_IN_GRACE_    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                          │  │    PERIOD                    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ status = active          │  │                              │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ end_date += 30 ngày      │  │ status = grace               │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ sub = points_per_cycle   │  │ end_date += 30 ngày          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ last_reset_at = now      │  │ sub = points_per_cycle ←RESET│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ cycle_count_used += 1    │  │ last_reset_at = now          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                          │  │ cycle_count_used += 1        │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ → RESET điểm             │  │                              │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ → chu kỳ mới             │  │ → VẪN RESET điểm            │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ → tiếp tục bình thường   │  │ → chu kỳ mới (tính đã dùng) │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└────────────┬─────────────┘  │ → user vẫn dùng được điểm   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                └──────────────┬───────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│                    ┌──────────┴──────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│               Retry OK            Grace hết,","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│               trong grace         vẫn chưa trả","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  ┌───────────────────────┐  ┌────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │(1) SUBSCRIPTION_      │  │(5) SUBSCRIPTION_       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │    RECOVERED          │  │    ON_HOLD             │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │ status = active       │  │ status = on_hold       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │ KHÔNG reset sub       │  │ sub_point = 0 ← MẤT   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │ KHÔNG đổi last_reset  │  │ user MẤT quyền truy   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │ KHÔNG đổi cycle       │  │ cập NGAY LẬP TỨC      │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │ → giữ nguyên điểm     │  │                        │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │ → grace = đã thanh    │  └──────────┬─────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  │   toán                │             │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  └───────────┬───────────┘  ┌──────────┴──────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │         Retry OK trong       60 ngày hết,","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │         account hold         vẫn chưa trả","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  ┌───────────────────┐  ┌────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  │(1) RECOVERED      │  │(13) EXPIRED        │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  │ từ ON_HOLD        │  │                    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  │                   │  │ status = expired   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  │ status = active   │  │ CHẶN HOÀN TOÀN    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  │ restore sub points│  │ sub_point = 0     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│              │  └────────┬──────────┘  └────────────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└──────┬───────┴───────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"Quay lại đầu chu kỳ","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"(chờ 30 ngày tiếp)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LUỒNG 2: USER DÙNG N ĐIỂM → XỬ LÝ REAL-TIME (KHÔNG CRON)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"═══════════════════════════════════════════════════════════════════════════════","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"User yêu cầu dùng N điểm","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌────────────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│  BƯỚC 1: Kiểm tra status       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└───────────────┬────────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌─────────────────┼─────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"expired         active              grace","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"╔═══════════╗          │    ┌──────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"║  REJECT   ║          │    │ BƯỚC 2: Grace hết hạn?  │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"║  hết hạn  ║          │    │ now > end_date ?         │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"╚═══════════╝          │    └─────────────┬────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│           ┌──────┴──────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│         CÓ (hết)    KHÔNG (còn)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    ╔═══════════╗       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    ║  REJECT   ║       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    ║→ expired  ║       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│    ╚═══════════╝       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└───────────┬────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌─────────────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ BƯỚC 3: Lazy reset chu kỳ       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ (CHỈ khi status = active)       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ now ≥ last_reset_at + 30 ngày ? │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└───────────────┬─────────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────┴──────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"CÓ           KHÔNG","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────────────────┐   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ sub = points_per │   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│     _cycle       │   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ last_reset = now │   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ cycle += 1       │   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└────────┬─────────┘   │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└──────┬──────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌────────────────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ BƯỚC 4: FAIL FAST              │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ total = sub + consumable       │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│ total ≥ N ?                    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└───────────────┬────────────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌──────┴──────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"KHÔNG            CÓ","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"╔═══════════╗  ┌──────────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"║  REJECT   ║  │ BƯỚC 5: Trừ điểm    │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"║ không đủ  ║  │ (sub trước,          │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"╚═══════════╝  │  consumable sau)     │","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└──────────┬───────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌─────┴─────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"┌────────────┐ ┌─────────────────┐","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"│            │ │ consumable -= dư│","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└─────┬──────┘ └────────┬────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"└────────┬────────┘","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"╔═══════════════╗","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"║  ACCEPT  ✓    ║","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"╚═══════════════╝","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription - TOÀN BỘ LUỒNG (MERMAID)","heading":"TOÀN BỘ LUỒNG (MERMAID)","text":"## TOÀN BỘ LUỒNG (MERMAID)","url":"#/CREDIT_SYSTEM_DIAGRAMS.md?id=ton-b-lung-mermaid","level":2},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"flowchart TD","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"SIGNUP([\"Người dùng đăng ký subscription\"])","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"SIGNUP --> PLAN{\"Chọn gói?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"PLAN -->|\"Gói tháng\"| INIT[\"points_per_cycle = 1000\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"PLAN -->|\"Gói 6 tháng\"| INIT2[\"points_per_cycle = 1200\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"PLAN -->|\"Gói năm\"| INIT3[\"points_per_cycle = 1500\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"INIT --> INITDB","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"INIT2 --> INITDB","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"INIT3 --> INITDB","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"INITDB[\"Khởi tạo DB:<br>status=active<br>sub=points_per_cycle<br>last_reset=now<br>end_date=now+30d<br>cycle=1<br>consumable=0\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"INITDB --> LIVE((\"HỆ THỐNG<br>ĐANG CHẠY\"))","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"%% ====== NHÁNH RTDN ======","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LIVE --> RTDN_TRIGGER[\"Hết chu kỳ 30 ngày<br>Google Play tính phí\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LIVE --> USE_TRIGGER[\"User yêu cầu<br>dùng N điểm\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"LIVE --> BUY_TRIGGER[\"User mua consumable\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"BUY_TRIGGER --> BUY_OK[\"consumable += N<br>không ảnh hưởng subscription\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"BUY_OK --> LIVE","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"RTDN_TRIGGER --> CHARGE{\"Tính phí<br>thành công?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"CHARGE -->|\"OK\"| RENEWED[\"(2) SUBSCRIPTION_RENEWED<br>─────────────────<br>status = active<br>sub = points_per_cycle ← RESET<br>end_date += 30d<br>las","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"CHARGE -->|\"LỖI\"| IN_GRACE[\"(6) SUBSCRIPTION_IN_GRACE_PERIOD<br>─────────────────<br>status = grace<br>sub = points_per_cycle ← VẪN RESET<br>end_date ","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"RENEWED --> LIVE","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"IN_GRACE --> GRACE_WAIT{\"Trong 30 ngày grace<br>user retry thanh toán?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"GRACE_WAIT -->|\"Retry OK\"| RECOVERED[\"(1) SUBSCRIPTION_RECOVERED<br>─────────────────<br>status = active<br>KHÔNG reset sub ← GIỮ NGUYÊN<br>KHÔNG đổi ","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"GRACE_WAIT -->|\"30 ngày hết<br>vẫn chưa trả\"| SUB_EXPIRED[\"(13) SUBSCRIPTION_EXPIRED<br>─────────────────<br>status = expired<br>CHẶN HOÀN TOÀN\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"RECOVERED --> LIVE","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"%% ====== NHÁNH DÙNG ĐIỂM ======","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"USE_TRIGGER --> S1{\"BƯỚC 1<br>status = ?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S1 -->|\"expired\"| R1[\"REJECT: hết hạn\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S1 -->|\"grace\"| S2{\"BƯỚC 2<br>Grace hết hạn?<br>now > end_date?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S1 -->|\"active\"| S3","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S2 -->|\"Hết hạn\"| R2[\"REJECT<br>cập nhật → expired\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S2 -->|\"Còn hạn\"| S4","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S3{\"BƯỚC 3<br>Lazy reset?<br>now ≥ last_reset+30d?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S3 -->|\"Cần reset\"| DO_RESET[\"sub = points_per_cycle<br>last_reset = now<br>cycle += 1\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S3 -->|\"Chưa cần\"| S4","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"DO_RESET --> S4","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S4{\"BƯỚC 4: FAIL FAST<br>total = sub + consumable<br>total ≥ N ?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S4 -->|\"Không đủ\"| R3[\"REJECT: không đủ điểm\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S4 -->|\"Đủ\"| S5{\"BƯỚC 5<br>sub ≥ N ?\"}","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S5 -->|\"Sub đủ\"| D1[\"sub -= N\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"S5 -->|\"Sub không đủ\"| D2[\"dư = N - sub<br>sub = 0<br>consumable -= dư\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"D1 --> OK[\"ACCEPT ✓\"]","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"OK --> LIVE","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"%% ====== STYLES ======","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style LIVE fill:#3b82f6,color:#fff,stroke-width:3px","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style RENEWED fill:#22c55e,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style RECOVERED fill:#22c55e,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style IN_GRACE fill:#eab308,color:#000","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style SUB_EXPIRED fill:#ef4444,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style R1 fill:#ef4444,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style R2 fill:#ef4444,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style R3 fill:#ef4444,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style OK fill:#22c55e,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"Sơ Đồ Hệ Thống Điểm & Subscription","heading":"Sơ Đồ Hệ Thống Điểm & Subscription","text":"style BUY_OK fill:#a855f7,color:#fff","url":"#/CREDIT_SYSTEM_DIAGRAMS.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"# FCM Setup Complete – Token Android / iOS / Web","url":"#/FCM_SETUP_COMPLETE_VI.md","level":1},{"title":"FCM Setup Complete – Token Android / iOS / Web - 1. Tổng quan","heading":"1. Tổng quan","text":"## 1. Tổng quan","url":"#/FCM_SETUP_COMPLETE_VI.md?id=1-tng-quan","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Luồng:** Lấy token → `POST /api/device/register` (profile_id, platform, token) → nhận push khi operation xong (faceswap/beauty/filter/…).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Đặc điểm:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Silent Push:** Không hiển thị notification bar; app xử lý data trong background.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Multi-Device:** Một profile có thể có nhiều devices (phone, tablet, web).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Profile-Based:** Push gửi đến tất cả devices của profile đó.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 2. Prerequisites (client)","heading":"2. Prerequisites (client)","text":"## 2. Prerequisites (client)","url":"#/FCM_SETUP_COMPLETE_VI.md?id=2-prerequisites-client","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Firebase project** với Android / iOS / Web app đã thêm (package name / Bundle ID / Web app trùng với app của bạn).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Android:** `google-services.json` từ Firebase Console.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **iOS:** `GoogleService-Info.plist`; APNs key (.p8) đã upload vào Firebase (Cloud Messaging → Apple app).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Web:** HTTPS; **firebaseConfig** và **VAPID** (Firebase Console hoặc deploy inject). Xem mục 6 (Web – Files và config).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Profile:** `POST /api/device/register` cần `profile_id` hợp lệ (đã tạo qua API trước đó).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 3. Lấy FCM device token – Android","heading":"3. Lấy FCM device token – Android","text":"## 3. Lấy FCM device token – Android","url":"#/FCM_SETUP_COMPLETE_VI.md?id=3-ly-fcm-device-token-android","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web - 3.1 Điều kiện bắt buộc","heading":"3.1 Điều kiện bắt buộc","text":"### 3.1 Điều kiện bắt buộc","url":"#/FCM_SETUP_COMPLETE_VI.md?id=31-iu-kin-bt-buc","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Firebase project đã tạo; đã thêm **Android app** (package name trùng với app).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **google-services.json** tải từ Firebase Console (Project settings → Your apps → Android) và đặt đúng vị trí (ví dụ `android/app/google-services.jso","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Gradle: đã apply plugin `com.google.gms.google-services` và thêm dependency Firebase BOM + `firebase-messaging`.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 3.2 Các bước triển khai","heading":"3.2 Các bước triển khai","text":"### 3.2 Các bước triển khai","url":"#/FCM_SETUP_COMPLETE_VI.md?id=32-cc-bc-trin-khai","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 1 – Gradle (project-level):**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// build.gradle (project)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"buildscript {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"dependencies {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"classpath 'com.google.gms:google-services:4.x.x'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 2 – Gradle (app-level):**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// build.gradle (app)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"id 'com.android.application'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"id 'com.google.gms.google-services'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"dependencies {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"implementation platform('com.google.firebase:firebase-bom:32.x.x')","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"implementation 'com.google.firebase:firebase-messaging'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 3 – AndroidManifest.xml:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Khai báo Service xử lý FCM (bắt buộc để nhận message và onNewToken):","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"android:name=\".MyFirebaseMessagingService\"","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"android:exported=\"false\">","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"<intent-filter>","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"<action android:name=\"com.google.firebase.MESSAGING_EVENT\" />","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"</intent-filter>","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 4 – Lấy token (Kotlin):**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Gọi `Firebase.messaging.token` (coroutine) hoặc `FirebaseMessaging.getInstance().token.addOnCompleteListener`.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Token chỉ có sau khi Firebase đã init (sau khi app khởi động, thường ngay sau khi có google-services.json và đã build).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// Kotlin – lấy token (chạy sau khi user đã login / có profile_id)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"FirebaseMessaging.getInstance().token","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":".addOnCompleteListener { task ->","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"if (!task.isSuccessful) return@addOnCompleteListener","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"val token = task.result ?: return@addOnCompleteListener","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"registerDeviceToBackend(profileId = \"profile_xxx\", platform = \"android\", token = token)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 5 – onNewToken (bắt buộc):**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Token có thể đổi; mỗi khi có token mới gửi lại qua `POST /api/device/register`.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// MyFirebaseMessagingService.kt","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"class MyFirebaseMessagingService : FirebaseMessagingService() {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"override fun onNewToken(token: String) {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"super.onNewToken(token)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"registerDeviceToBackend(profileId = currentProfileId, platform = \"android\", token = token)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"override fun onMessageReceived(remoteMessage: RemoteMessage) {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// Chỉ nhận data payload (silent push). Không có remoteMessage.notification.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"val data = remoteMessage.data","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// Xử lý data: type, operation, result_id, v.v.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Lưu ý quan trọng:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Không lấy token trong `Application.onCreate` quá sớm; có thể dùng `Handler().postDelayed` vài trăm ms hoặc lấy sau khi user đã có profile_id.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Luôn implement `onNewToken` và gửi token mới lên backend.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Data-only message (backend không gửi `notification`) → luôn vào `onMessageReceived`; không hiện notification bar trừ khi app tự hiển thị.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 4. Lấy FCM device token – iOS","heading":"4. Lấy FCM device token – iOS","text":"## 4. Lấy FCM device token – iOS","url":"#/FCM_SETUP_COMPLETE_VI.md?id=4-ly-fcm-device-token-ios","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web - 4.1 Điều kiện bắt buộc","heading":"4.1 Điều kiện bắt buộc","text":"### 4.1 Điều kiện bắt buộc","url":"#/FCM_SETUP_COMPLETE_VI.md?id=41-iu-kin-bt-buc","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Firebase project đã thêm **iOS app** (Bundle ID trùng với Xcode).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **APNs key (.p8)** đã tạo trong Apple Developer (Keys), đã upload vào Firebase (Project settings → Cloud Messaging → Apple app configuration).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **GoogleService-Info.plist** tải từ Firebase, thêm vào Xcode project.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Xcode: **Signing & Capabilities** → bật **Push Notifications** và **Background Modes** (chọn **Remote notifications**).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Firebase SDK (Firebase/Messaging) đã thêm qua SPM hoặc CocoaPods.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 4.2 Các bước triển khai","heading":"4.2 Các bước triển khai","text":"### 4.2 Các bước triển khai","url":"#/FCM_SETUP_COMPLETE_VI.md?id=42-cc-bc-trin-khai","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 1 – Capabilities:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Target → Signing & Capabilities → + Capability → **Push Notifications**; thêm **Background Modes** → bật **Remote notifications**.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 2 – AppDelegate / SceneDelegate:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Đăng ký remote notification và set delegate cho Messaging để nhận FCM token.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// AppDelegate","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"import FirebaseCore","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"import FirebaseMessaging","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"import UserNotifications","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"class AppDelegate: UIResponder, UIApplicationDelegate, MessagingDelegate, UNUserNotificationCenterDelegate {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"FirebaseApp.configure()","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"UNUserNotificationCenter.current().delegate = self","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Messaging.messaging().delegate = self","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"application.registerForRemoteNotifications()","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"return true","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"func application(_ application: UIApplication, didRegisterForRemoteNotificationsWithDeviceToken deviceToken: Data) {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Messaging.messaging().apnsToken = deviceToken","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"func messaging(_ messaging: Messaging, didReceiveRegistrationToken fcmToken: String?) {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"guard let token = fcmToken else { return }","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"registerDeviceToBackend(profileId: currentProfileId, platform: \"ios\", token: token)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 3 – Lấy token:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"FCM token xuất hiện trong callback `messaging(_:didReceiveRegistrationToken:)`. Callback này được gọi:","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Sau khi `registerForRemoteNotifications` và APNs token đã được set vào Firebase (`apnsToken`).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Mỗi lần app mở hoặc khi token đổi.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Nếu cần lấy token chủ động (ví dụ sau khi login):","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Messaging.messaging().token { token, error in","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"guard let token = token else { return }","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"registerDeviceToBackend(profileId: currentProfileId, platform: \"ios\", token: token)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 4 – Silent push (data-only):**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Backend gửi không có `notification`, chỉ `data`; cần xử lý trong:","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"func application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable: Any], fetchCompletionHandler completionHandler: @e","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// Xử lý userInfo (data payload)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"completionHandler(.newData)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Lưu ý quan trọng:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- APNs key (.p8) phải được upload đúng trong Firebase (Cloud Messaging → Apple app). Thiếu hoặc sai → không có FCM token.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Nếu tắt swizzling (`FirebaseAppDelegateProxyEnabled = NO`), phải tự set `Messaging.messaging().apnsToken = deviceToken` trong `didRegisterForRemoteN","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Simulator không nhận remote notification; cần device thật.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- Silent push cần Background Modes → Remote notifications và gọi `completionHandler(.newData)`.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 5. Lấy FCM device token – Web","heading":"5. Lấy FCM device token – Web","text":"## 5. Lấy FCM device token – Web","url":"#/FCM_SETUP_COMPLETE_VI.md?id=5-ly-fcm-device-token-web","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web - 5.1 Điều kiện bắt buộc","heading":"5.1 Điều kiện bắt buộc","text":"### 5.1 Điều kiện bắt buộc","url":"#/FCM_SETUP_COMPLETE_VI.md?id=51-iu-kin-bt-buc","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **HTTPS** (service worker chỉ chạy trên HTTPS).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **firebaseConfig** và **VAPID** — mục 6.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 5.2 Các bước triển khai","heading":"5.2 Các bước triển khai","text":"### 5.2 Các bước triển khai","url":"#/FCM_SETUP_COMPLETE_VI.md?id=52-cc-bc-trin-khai","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 1 – Thêm Firebase SDK và khởi tạo:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"<script type=\"module\">","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.x.x/firebase-app.js';","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.x.x/firebase-messaging.js';","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"const firebaseConfig = { apiKey: \"...\", authDomain: \"...\", projectId: \"...\", storageBucket: \"...\", messagingSenderId: \"...\", appId: \"...\" };","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"const app = initializeApp(firebaseConfig);","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"const messaging = getMessaging(app);","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 2 – Service worker:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Cần **firebase-messaging-sw.js** tại root domain; import Firebase Messaging, `initializeApp(firebaseConfig)`, `onBackgroundMessage`. firebaseConfig và","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// firebase-messaging-sw.js (root domain)","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"importScripts('https://www.gstatic.com/firebasejs/10.x.x/firebase-app-compat.js');","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"importScripts('https://www.gstatic.com/firebasejs/10.x.x/firebase-messaging-compat.js');","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"firebase.initializeApp(/* firebaseConfig */);","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"firebase.messaging().onBackgroundMessage((payload) => {});","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 3 – Xin quyền và lấy token:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"`getToken(messaging, { vapidKey })` sau khi user cho phép notification.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"const permission = await Notification.requestPermission();","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"if (permission !== 'granted') return null;","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"const token = await getToken(messaging, { vapidKey: '...' });","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"if (token) {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"await fetch(API_BASE + '/api/device/register', {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"method: 'POST',","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"headers: { 'Content-Type': 'application/json' },","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"body: JSON.stringify({ profile_id: profileId, platform: 'web', token, app_version: '1.0.0' })","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Bước 4 – Foreground:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Nhận message khi tab đang mở bằng `onMessage`:","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"onMessage(messaging, (payload) => {","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"console.log('Foreground message', payload);","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"const data = payload.data || {};","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"// data.type, data.operation, data.result_id, ...","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 6. Web – Files và config cần có","heading":"6. Web – Files và config cần có","text":"## 6. Web – Files và config cần có","url":"#/FCM_SETUP_COMPLETE_VI.md?id=6-web-files-v-config-cn-c","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Để tích hợp FCM trên Web cần:","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **Trang có logic FCM** (vd. fcm-test.html): xin quyền notification → nhập profile_id → gọi `POST /api/device/register` với token → (tùy chọn) gửi pu","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **firebase-messaging-sw.js** — Service worker, đặt tại root domain (bắt buộc).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"- **firebaseConfig** và **VAPID** — Firebase Console → Cloud Messaging → Web Push certificates, hoặc inject lúc deploy.","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 7. API Endpoints","heading":"7. API Endpoints","text":"## 7. API Endpoints","url":"#/FCM_SETUP_COMPLETE_VI.md?id=7-api-endpoints","level":2},{"title":"FCM Setup Complete – Token Android / iOS / Web - 7.1 POST /api/device/register","heading":"7.1 POST /api/device/register","text":"### 7.1 POST /api/device/register","url":"#/FCM_SETUP_COMPLETE_VI.md?id=71-post-apideviceregister","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Body:** `profile_id` (required), `platform` (android \\| ios \\| web), `token` (required), `app_version` (optional).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Request:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"profile_id\": \"profile_1234567890\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"platform\": \"android\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"token\": \"fcm-device-token-here\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"app_version\": \"1.0.0\"","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Response 200:** `{ \"data\": { \"registered\": true }, \"status\": \"success\", \"message\": \"Processing successful\", \"code\": 200 }`","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"curl -X POST https://api.d.shotpix.app/api/device/register \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-H \"Content-Type: application/json\" \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-d '{\"profile_id\":\"profile_abc123\",\"platform\":\"web\",\"token\":\"fcm-web-token-xyz\",\"app_version\":\"1.0.0\"}'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 7.2 POST /api/push/silent","heading":"7.2 POST /api/push/silent","text":"### 7.2 POST /api/push/silent","url":"#/FCM_SETUP_COMPLETE_VI.md?id=72-post-apipushsilent","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Auth:** `X-API-Key: MOBILE_API_KEY`","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Body:** `profile_id` (required), `data` (object, values string), `exclude_token` (optional).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Request:**","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"profile_id\": \"profile_1234567890\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"type\": \"operation_complete\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"operation\": \"faceswap\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"status\": \"success\",","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"result_id\": \"result_xyz\"","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"\"exclude_token\": \"current-device-fcm-token\"","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Response 200:** `{ \"data\": { \"sent\", \"failed\", \"cleaned\", \"results\": [...] }, \"status\": \"success\", ... }`","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"curl -X POST https://api.d.shotpix.app/api/push/silent \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-H \"Content-Type: application/json\" \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-H \"X-API-Key: your-mobile-api-key-here\" \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-d '{\"profile_id\":\"profile_abc123\",\"data\":{\"type\":\"balance_sync\",\"amount\":\"100\",\"timestamp\":\"1706900000\"}}'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 7.3 DELETE /api/device/unregister","heading":"7.3 DELETE /api/device/unregister","text":"### 7.3 DELETE /api/device/unregister","url":"#/FCM_SETUP_COMPLETE_VI.md?id=73-delete-apideviceunregister","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Body:** `token` (required).","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Request:** `{ \"token\": \"fcm-device-token-to-remove\" }`","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"**Response 200:** `{ \"data\": { \"unregistered\": true }, \"status\": \"success\", \"message\": \"Processing successful\", \"code\": 200 }`","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"curl -X DELETE https://api.d.shotpix.app/api/device/unregister \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-H \"Content-Type: application/json\" \\","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"-d '{\"token\":\"fcm-device-token-xyz\"}'","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 7.4 Auto-Push","heading":"7.4 Auto-Push","text":"### 7.4 Auto-Push","url":"#/FCM_SETUP_COMPLETE_VI.md?id=74-auto-push","level":3},{"title":"FCM Setup Complete – Token Android / iOS / Web","heading":"FCM Setup Complete – Token Android / iOS / Web","text":"Khi thành công, các API sau tự gửi push (payload như 7.2): `/faceswap`, `/beauty`, `/filter`, `/upscaler4k`, `/background`. Payload: `type`, `operatio","url":"#/FCM_SETUP_COMPLETE_VI.md","level":0},{"title":"FCM Setup Complete – Token Android / iOS / Web - 8. Troubleshooting","heading":"8. Troubleshooting","text":"## 8. Troubleshooting","url":"#/FCM_SETUP_COMPLETE_VI.md?id=8-troubleshooting","level":2},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"# Hướng dẫn thiết lập Google Play Billing","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":1},{"title":"Hướng dẫn thiết lập Google Play Billing - Các bước cần thực hiện thủ công (one-time setup)","heading":"Các bước cần thực hiện thủ công (one-time setup)","text":"## Các bước cần thực hiện thủ công (one-time setup)","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=cc-bc-cn-thc-hin-th-cng-one-time-setup","level":2},{"title":"Hướng dẫn thiết lập Google Play Billing - 1. Bật Google Play Android Developer API","heading":"1. Bật Google Play Android Developer API","text":"### 1. Bật Google Play Android Developer API","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=1-bt-google-play-android-developer-api","level":3},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"1. Truy cập [Google Cloud Console](https://console.cloud.google.com/)","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"2. Chọn project: `gen-lang-client-0149764456`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"3. Vào **APIs & Services** > **Library**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"4. Tìm \"**Google Play Android Developer API**\"","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"5. Click **Enable**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing - 2. Cấp quyền Service Account trong Google Play Console","heading":"2. Cấp quyền Service Account trong Google Play Console","text":"### 2. Cấp quyền Service Account trong Google Play Console","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=2-cp-quyn-service-account-trong-google-play-console","level":3},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"1. Truy cập [Google Play Console](https://play.google.com/console)","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"2. Vào **Settings** > **API access**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"3. Click **Link** để liên kết project GCP (`gen-lang-client-0149764456`)","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"4. Tìm service account: `uppixaiphoto@gen-lang-client-0149764456.iam.gserviceaccount.com`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"5. Click **Grant access** và cấp quyền:","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- **Financial data**: Xem doanh thu, đơn hàng","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- **Manage orders and subscriptions**: Quản lý đơn hàng","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"6. Click **Invite user** > **Send invitation**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"7. Chờ invitation được accept (tự động nếu đã link project)","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing - 3. Thiết lập Pub/Sub cho RTDN (Real-Time Developer Notifications)","heading":"3. Thiết lập Pub/Sub cho RTDN (Real-Time Developer Notifications)","text":"### 3. Thiết lập Pub/Sub cho RTDN (Real-Time Developer Notifications)","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=3-thit-lp-pubsub-cho-rtdn-real-time-developer-notifications","level":3},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"1. Trong **Google Cloud Console** > **Pub/Sub**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"2. Tạo Topic mới: `play-billing-notifications`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"3. Tạo Subscription:","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- **Type**: Push","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- **Endpoint URL**: `https://api.d.shotpix.app/webhooks/google`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- **Authentication**: Thêm header `Authorization: Bearer YOUR_WEBHOOK_SECRET`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"4. Trong **Google Play Console** > **Monetization setup** > **Real-time developer notifications**:","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- **Topic name**: `projects/gen-lang-client-0149764456/topics/play-billing-notifications`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- Click **Save**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing - 4. Tạo In-App Products & Subscriptions trong Google Play Console","heading":"4. Tạo In-App Products & Subscriptions trong Google Play Console","text":"### 4. Tạo In-App Products & Subscriptions trong Google Play Console","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=4-to-in-app-products-subscriptions-trong-google-play-console","level":3},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"1. Vào **Monetization** > **Products** > **In-app products**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"2. Tạo consumable products với các SKU:","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `credits_10` - 22,000 VND","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `credits_50` - 99,000 VND","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `credits_100` - 176,000 VND","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `credits_500` - 770,000 VND","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"3. Vào **Monetization** > **Products** > **Subscriptions**","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"4. Tạo subscriptions:","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `sub_pro_monthly` - 99,000 VND/tháng","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `sub_pro_yearly` - 990,000 VND/năm","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `sub_premium_monthly` - 199,000 VND/tháng","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"- `sub_premium_yearly` - 1,990,000 VND/năm","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing - 5. Cập nhật Environment Variables","heading":"5. Cập nhật Environment Variables","text":"### 5. Cập nhật Environment Variables","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=5-cp-nht-environment-variables","level":3},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"Sau khi hoàn thành các bước trên, cập nhật trong `deployments-secrets.json`:","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"\"GOOGLE_PLAY_PACKAGE_NAME\": \"com.your.app.package\",","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"\"GOOGLE_WEBHOOK_SECRET\": \"your-random-secret-string\",","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"\"ENABLE_CREDIT_SYSTEM\": \"true\"","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"Sau đó deploy lại: `npm run deploy:parallel:test`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing - 6. Chạy Database Migration","heading":"6. Chạy Database Migration","text":"### 6. Chạy Database Migration","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=6-chy-database-migration","level":3},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"Migration file: `backend-cloudflare-workers/migrations/0008_payments_credits.sql`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"Chạy migration: `npm run db:migrate`","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing - Kiểm tra","heading":"Kiểm tra","text":"## Kiểm tra","url":"#/GOOGLE_PLAY_SETUP_VI.md?id=kim-tra","level":2},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"1. Gọi `GET /api/products` - Phải trả về danh sách SKU","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"2. Gọi `GET /api/user/balance?profile_id=xxx` - Phải trả về credits=0, tier=free","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"3. Test purchase flow trên Android app với test account","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Hướng dẫn thiết lập Google Play Billing","heading":"Hướng dẫn thiết lập Google Play Billing","text":"4. Kiểm tra webhook nhận notifications từ Google Play","url":"#/GOOGLE_PLAY_SETUP_VI.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"# Face Swap AI - Requirements","url":"#/REQUIREMENTS.md","level":1},{"title":"Face Swap AI - Requirements - Overview","heading":"Overview","text":"## Overview","url":"#/REQUIREMENTS.md?id=overview","level":2},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"A minimal web application for face swapping that allows users to upload preset images, upload selfies, and generate face-swapped results. The applicat","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Frontend Structure","heading":"Frontend Structure","text":"## Frontend Structure","url":"#/REQUIREMENTS.md?id=frontend-structure","level":2},{"title":"Face Swap AI - Requirements - File Organization","heading":"File Organization","text":"### File Organization","url":"#/REQUIREMENTS.md?id=file-organization","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `index.html` - Main HTML structure with inline CSS and JavaScript","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - UI Layout","heading":"UI Layout","text":"### UI Layout","url":"#/REQUIREMENTS.md?id=ui-layout","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Main workspace: Two-column grid layout","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Left column: Preset section (top) and Selfie section (bottom)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Right column: Result image (spans both rows, large display)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Bottom section: Results history gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Both preset and selfie have identical UI: Upload area + Gallery for selection","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - UI/UX Design Guide","heading":"UI/UX Design Guide","text":"## UI/UX Design Guide","url":"#/REQUIREMENTS.md?id=uiux-design-guide","level":2},{"title":"Face Swap AI - Requirements - Design Principles","heading":"Design Principles","text":"### Design Principles","url":"#/REQUIREMENTS.md?id=design-principles","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Minimalism**: Remove all unnecessary elements. Every component must serve a purpose.","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Clarity**: Users should understand what to do without reading instructions.","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Efficiency**: Minimize clicks and steps to complete tasks.","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Consistency**: Use consistent spacing, colors, and interaction patterns throughout.","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Feedback**: Always provide clear visual feedback for user actions.","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Layout Structure","heading":"Layout Structure","text":"### Layout Structure","url":"#/REQUIREMENTS.md?id=layout-structure","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Main Container","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max width: 1200px (centered on large screens)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 24px on desktop, 16px on mobile","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #FFFFFF (white) or #FAFAFA (very light gray)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 0px (sharp, professional edges)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Main Workspace - Two Column Grid","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Layout**: CSS Grid with 2 columns","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Left Column** (40% width):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Preset Section** (top row):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Upload area with drag & drop","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gallery grid below for selecting existing presets","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected preset preview (large, prominent)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Selfie Section** (bottom row):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Upload area with drag & drop (identical to preset)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gallery grid below for selecting existing selfies","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected selfie preview (large, prominent)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gap between sections: 24px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Right Column** (60% width):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Result Image Display** (spans both rows):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Large preview area (min-height: 600px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Shows generated face swap result","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Empty state: \"Result will appear here\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Centered, object-fit: contain","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Gap between columns**: 24px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Generate Button**: Full width below the grid, centered","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Bottom Section - Results History","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Full width grid layout","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Responsive grid: 4 columns desktop, 3 tablets, 2 mobile","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gap: 16px between items","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Color Palette","heading":"Color Palette","text":"### Color Palette","url":"#/REQUIREMENTS.md?id=color-palette","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Primary Colors","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Primary**: #2563EB (Blue 600) - Main actions, selected states","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Primary Hover**: #1D4ED8 (Blue 700) - Interactive elements on hover","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Primary Light**: #DBEAFE (Blue 100) - Subtle backgrounds","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Neutral Colors","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Background**: #FFFFFF (White)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Surface**: #F9FAFB (Gray 50) - Card backgrounds","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Border**: #E5E7EB (Gray 200) - Dividers, borders","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Text Primary**: #111827 (Gray 900) - Main text","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Text Secondary**: #6B7280 (Gray 500) - Secondary text, labels","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Status Colors","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Success**: #10B981 (Green 500) - Success messages, completed states","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Error**: #EF4444 (Red 500) - Error messages, warnings","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Warning**: #F59E0B (Amber 500) - Warnings","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Info**: #3B82F6 (Blue 500) - Informational messages","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Typography","heading":"Typography","text":"### Typography","url":"#/REQUIREMENTS.md?id=typography","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Font Family","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Primary**: System font stack: `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Monospace**: `'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace` (for filenames only)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Font Sizes","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **H1 (Page Title)**: 28px / 1.2 line-height / 700 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **H2 (Section Title)**: 20px / 1.3 line-height / 600 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Body**: 16px / 1.5 line-height / 400 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Small**: 14px / 1.4 line-height / 400 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Caption**: 12px / 1.3 line-height / 400 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Text Hierarchy","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Page title: H1, centered or left-aligned","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Section headers: H2, left-aligned with 24px margin-bottom","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Labels: Small, Text Secondary color, 8px margin-bottom","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Body text: Body size, Text Primary color","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Spacing System","heading":"Spacing System","text":"### Spacing System","url":"#/REQUIREMENTS.md?id=spacing-system","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Use 4px base unit for consistent spacing","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **XS**: 4px (tight spacing)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **S**: 8px (small gaps)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **M**: 16px (default spacing)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **L**: 24px (section spacing)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **XL**: 32px (large sections)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **XXL**: 48px (major sections)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Component Specifications","heading":"Component Specifications","text":"### Component Specifications","url":"#/REQUIREMENTS.md?id=component-specifications","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Upload Areas","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 2px dashed #D1D5DB (Gray 300)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 32px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Min height: 200px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex, column, center, align-items center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Transition: border-color 0.2s ease","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Hover State**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border color: #2563EB (Primary)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #F9FAFB (subtle highlight)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Drag Over State**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border color: #2563EB (Primary)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #DBEAFE (Primary Light)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border style: solid","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Icon/Illustration**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Size: 48px × 48px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #9CA3AF (Gray 400)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-bottom: 12px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Text**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Primary: \"Click to upload or drag and drop\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Body, Text Primary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-bottom: 4px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Subtext**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- \"JPG, PNG, WebP (max 10MB)\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Small, Text Secondary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **File Input**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hidden (display: none)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Triggered by container click","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Selected Image Preview (Preset/Selfie)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: relative","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Overflow: hidden","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #F3F4F6 (Gray 100)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Min height: 300px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max height: 400px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 2px solid #E5E7EB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-top: 16px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Image**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Width: 100%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Height: 100%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max height: 400px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Object-fit: contain (show full image without cropping)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: block","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Label**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: absolute, top-left","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: rgba(0, 0, 0, 0.7)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 8px 12px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-radius: 0 0 8px 0","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Small, 600 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Text: \"Selected Preset\" or \"Selected Selfie\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Delete Button**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: absolute, top-right corner","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Size: 36px × 36px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: rgba(239, 68, 68, 0.9) (Red 500 with opacity)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: none","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-radius: 50%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Icon: × (close/delete, 20px, white)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Z-index: 10","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Transition: background-color 0.2s ease, transform 0.2s ease","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hover: Background rgba(220, 38, 38, 1) (Red 600), transform: scale(1.1)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Click: Show confirmation dialog before deletion","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Result Image Display","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #F9FAFB (Surface)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 2px solid #E5E7EB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Min height: 600px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: relative","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Grid-row: span 2 (spans both preset and selfie rows)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Image** (when result exists):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max width: 100%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max height: 100%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Object-fit: contain (show full image)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Empty State**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Text: \"Result will appear here\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Body, Text Secondary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Icon: 64px × 64px, Gray 300","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Centered vertically and horizontally","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Gallery Grid (Preset/Selfie Selection)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: grid","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gap: 12px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Grid-template-columns: repeat(auto-fill, minmax(100px, 1fr))","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max columns: 3 on desktop (fits in left column)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max height: 200px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Overflow-y: auto","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-top: 16px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #F9FAFB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Gallery Item**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Aspect ratio: 1:1 (square)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Overflow: hidden","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #F3F4F6","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 2px solid transparent","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Transition: transform 0.2s ease, border-color 0.2s ease","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: relative","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Selected State**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border color: #2563EB (Primary)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border width: 3px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Box shadow: 0 0 0 3px rgba(37, 99, 235, 0.1)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Hover State**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Transform: scale(1.02)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Box shadow: 0 4px 12px rgba(0, 0, 0, 0.1)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Image**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Width: 100%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Height: 100%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Object-fit: cover","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: block","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Delete Button** (Gallery Item):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: absolute, top-right corner","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Size: 24px × 24px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: rgba(239, 68, 68, 0.9) (Red 500 with opacity)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: none","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-radius: 50%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Icon: × (close/delete, 14px, white)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Z-index: 10","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Opacity: 0 (hidden by default)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Transition: opacity 0.2s ease, background-color 0.2s ease","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hover (on gallery item): Opacity: 1","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hover (on button): Background rgba(220, 38, 38, 1) (Red 600)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Click: Show confirmation dialog, prevent event propagation (don't select item)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Buttons","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"##### Primary Button (Generate)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Default**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #2563EB (Primary)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 12px 24px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: none","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 6px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Body, 600 weight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Width: 100% (on mobile), auto (on desktop)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Min width: 200px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Transition: background-color 0.2s ease","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Hover**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #1D4ED8 (Primary Hover)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Disabled**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #D1D5DB (Gray 300)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #9CA3AF (Gray 400)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: not-allowed","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Loading**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show spinner icon (16px) + text","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Disable interaction","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"##### Secondary Button (Reset/Clear)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: transparent","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #6B7280 (Text Secondary)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 1px solid #E5E7EB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Same padding and sizing as primary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hover: Background #F9FAFB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Status Messages","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 12px 16px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 6px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin: 8px 0","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Small","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Success**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #D1FAE5 (Green 100)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #065F46 (Green 800)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Icon: ✓ (checkmark)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Error**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #FEE2E2 (Red 100)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #991B1B (Red 800)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Icon: ✕ (cross)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Info**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #DBEAFE (Blue 100)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #1E40AF (Blue 800)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Icon: ℹ (info)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Loading Spinner","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Overlay**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: fixed","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Top: 0, left: 0, right: 0, bottom: 0","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: rgba(0, 0, 0, 0.5)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Z-index: 9999","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Spinner Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 32px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Text-align: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Min-width: 200px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Spinner**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Size: 40px × 40px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 3px solid #E5E7EB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-top: 3px solid #2563EB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 50%","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Animation: spin 0.8s linear infinite","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin: 0 auto 16px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Text**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Body, Text Primary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-top: 12px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Confirmation Dialog","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Overlay**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Position: fixed","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Top: 0, left: 0, right: 0, bottom: 0","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: rgba(0, 0, 0, 0.5)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Align-items: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: center","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Z-index: 10000","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Dialog Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 24px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border radius: 8px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Min-width: 320px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max-width: 400px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Title**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: H2 (20px, 600 weight)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: Text Primary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-bottom: 12px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Message**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Font: Body (16px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: Text Secondary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Margin-bottom: 24px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Line-height: 1.5","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Button Container**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display: flex","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gap: 12px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Justify-content: flex-end","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Cancel Button**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: transparent","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: Text Secondary","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: 1px solid #E5E7EB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 10px 20px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-radius: 6px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hover: Background #F9FAFB","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Confirm Button** (Delete):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Background: #EF4444 (Red 500)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color: #FFFFFF","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border: none","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Padding: 10px 20px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Border-radius: 6px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cursor: pointer","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hover: Background #DC2626 (Red 600)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - User Flow","heading":"User Flow","text":"### User Flow","url":"#/REQUIREMENTS.md?id=user-flow","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Primary Flow: Generate Face Swap","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"1. **Select/Upload Preset** (left column, top)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Option A: Upload new preset","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- User clicks upload area or drags file","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Large preview appears immediately (300-400px height)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Status: \"Uploading...\" → \"Uploaded\" or \"Already exists\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gallery refreshes to show new preset","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Option B: Select from gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- User clicks thumbnail in gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected preset shows in large preview area","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Visual feedback: Selected border on thumbnail","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"2. **Select/Upload Selfie** (left column, bottom)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Option A: Upload new selfie","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- User clicks upload area or drags file","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Large preview appears immediately (300-400px height)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Status: \"Uploading...\" → \"Uploaded\" or \"Already exists\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Gallery refreshes to show new selfie","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Option B: Select from gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- User clicks thumbnail in gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected selfie shows in large preview area","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Visual feedback: Selected border on thumbnail","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"3. **Generate Button Enabled**","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Visual feedback: Button changes from disabled to active","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Both large previews visible in left column","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Right column shows empty state","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"4. **Click Generate**","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Loading overlay appears","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Button disabled","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Status: \"Processing face swap...\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"5. **Result Display**","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Loading overlay disappears","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Result image appears in large right column (spans both rows)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Success message: \"Face swap completed\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Result added to history gallery below","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Responsive Design","heading":"Responsive Design","text":"### Responsive Design","url":"#/REQUIREMENTS.md?id=responsive-design","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Breakpoints","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Mobile**: < 768px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Single column layout (stack preset, selfie, result vertically)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Full-width buttons","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- 2-column gallery grid for presets/selfies","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Reduced padding (16px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Result image: Full width, normal height","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Tablet**: 768px - 1024px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Two-column grid layout (40% left, 60% right)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- 3-column gallery grid for presets/selfies","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Standard padding (24px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Result image: Spans both rows","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Desktop**: > 1024px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Two-column grid layout (40% left, 60% right)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- 3-column gallery grid for presets/selfies","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Max-width container (1200px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Result image: Large display, spans both rows","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Accessibility","heading":"Accessibility","text":"### Accessibility","url":"#/REQUIREMENTS.md?id=accessibility","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Keyboard Navigation","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- All interactive elements must be keyboard accessible","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Tab order: Upload areas → Gallery items → Generate button → Results","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Enter/Space to activate buttons and select items","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Focus indicators: 2px solid outline in Primary color","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Screen Readers","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- All images must have alt text","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Buttons must have descriptive labels","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Status messages must be announced","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Loading states must be announced","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Visual Accessibility","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Color contrast: Minimum 4.5:1 for text","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Focus indicators: Clear and visible","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Error states: Use icons + text, not just color","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Touch targets: Minimum 44px × 44px","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Performance Considerations","heading":"Performance Considerations","text":"### Performance Considerations","url":"#/REQUIREMENTS.md?id=performance-considerations","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Lazy load gallery images (use loading=\"lazy\")","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Optimize images before upload (client-side compression if possible)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show skeleton loaders while fetching data","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Debounce search/filter inputs if added later","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Cache gallery images in browser","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Error States","heading":"Error States","text":"### Error States","url":"#/REQUIREMENTS.md?id=error-states","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Upload Errors","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Network error: \"Upload failed. Please check your connection and try again.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- File too large: \"File exceeds 10MB limit. Please choose a smaller file.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Invalid format: \"Invalid file type. Please upload JPG, PNG, or WebP.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Duplicate: \"This image already exists. Using existing version.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### Generation Errors","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- API error: \"Face swap failed. Please try again.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Timeout: \"Request timed out. Please try again.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Invalid images: \"Could not process images. Please ensure both images contain faces.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Empty States","heading":"Empty States","text":"### Empty States","url":"#/REQUIREMENTS.md?id=empty-states","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **No Presets Gallery**: \"No presets yet. Upload your first preset above.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **No Selfies Gallery**: \"No selfies yet. Upload your first selfie above.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **No Results History**: \"No results yet. Generate your first face swap to see it here.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Result Display Empty**: \"Result will appear here\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Use subtle illustration or icon (48px, Gray 300)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Text: Small, Text Secondary, centered","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Backend API Endpoints","heading":"Backend API Endpoints","text":"## Backend API Endpoints","url":"#/REQUIREMENTS.md?id=backend-api-endpoints","level":2},{"title":"Face Swap AI - Requirements - Backend Database Schema","heading":"Backend Database Schema","text":"### Backend Database Schema","url":"#/REQUIREMENTS.md?id=backend-database-schema","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `presets` table: `id`, `image_url`, `prompt_json`, `thumbnail_url`, `thumbnail_format`, `thumbnail_resolution`, `thumbnail_r2_key`, `created_at`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `selfies` table: `id`, `image_url`, `profile_id`, `created_at`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `results` table: `id`, `preset_name`, `result_url`, `profile_id`, `created_at`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Metadata (type, sub_category, gender, position) được lưu trong R2 bucket path, không lưu trong database","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Thumbnails được lưu trong cùng row với preset (same-row approach)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Endpoints","heading":"Endpoints","text":"### Endpoints","url":"#/REQUIREMENTS.md?id=endpoints","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### GET `/presets`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Returns: `{ presets: [...] }`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each preset contains: `id`, `image_url`, `prompt_json`, `thumbnail_url`, `thumbnail_format`, `thumbnail_resolution`, `created_at`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Query params: `include_thumbnails` (optional, default: false) - bao gồm presets có thumbnail","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Presets are stored as individual entries (no collections)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Backend queries database and returns all presets","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### GET `/selfies`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Returns: `{ selfies: [...] }`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each selfie contains: `id`, `selfie_url` (full URL), `action`, `created_at`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selfies are stored as individual entries","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Backend queries database and returns all selfies","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Lưu ý**: `selfie_url` trong database chỉ lưu bucket key, API tự động assemble full URL từ `R2_DOMAIN` khi trả về","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### DELETE `/presets/:id`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Path parameter: `id` (preset ID)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Backend logic:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"1. Find preset by ID in database","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"2. Delete file from R2 storage using `image_url`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"3. Delete record from `presets` table","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"4. Return `{ success: true, message: \"Preset deleted\" }`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Error handling: Return 404 if preset not found, 500 on deletion failure","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### DELETE `/selfies/:id`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Path parameter: `id` (selfie ID)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Backend logic:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"1. Find selfie by ID in database","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"2. Delete file from R2 storage using `image_url`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"3. Delete record from `selfies` table","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"4. Return `{ success: true, message: \"Selfie deleted\" }`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Error handling: Return 404 if selfie not found, 500 on deletion failure","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### POST `/upload-url`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Content-Type: `multipart/form-data` hoặc `application/json`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Body (multipart): `files` (file[]), `type`, `profile_id`, `enableVertexPrompt` (optional), `action` (optional, chỉ cho selfie)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Body (JSON): `image_url` hoặc `image_urls` (string[]), `type`, `profile_id`, `enableVertexPrompt` (optional), `action` (optional, chỉ cho selfie)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Backend logic:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"1. Upload file(s) to R2 storage","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"2. Với selfie:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Chỉ với `action=\"4k\"` hoặc `action=\"4K\"`**: Kiểm tra an toàn bằng Vision API trước khi lưu vào database","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Các action khác (như `\"faceswap\"`, `\"wedding\"`, `\"default\"`, v.v.)**: Không kiểm tra Vision API","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Tự động xóa ảnh cũ dựa trên action:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `action=\"faceswap\"`: Tối đa 8 ảnh (có thể cấu hình qua `SELFIE_MAX_FACESWAP`), xóa ảnh cũ nhất khi vượt quá giới hạn","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `action=\"wedding\"`: Tối đa 2 ảnh (cấu hình qua `SELFIE_MAX_WEDDING`), xóa ảnh cũ nhất khi có >= 2 ảnh","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `action=\"4k\"` hoặc `\"4K\"`: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_4K`), xóa ảnh cũ khi có >= 1 ảnh","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Action khác: Tối đa 1 ảnh (cấu hình qua `SELFIE_MAX_OTHER`), xóa ảnh cũ khi có >= 1 ảnh","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"3. Insert record(s) vào database (`presets` hoặc `selfies` table) với bucket key (không phải full URL)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"4. Với preset: tự động generate Vertex prompt nếu `enableVertexPrompt=true`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Response format: `{ data: { results: [...], count, successful, failed }, status, message, code, debug? }`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Với selfie: mỗi result có thêm field `action`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Hỗ trợ upload nhiều file cùng lúc","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Lưu ý**: `selfie_url` trong database chỉ lưu bucket key (ví dụ: `\"selfie/filename.jpg\"`), API tự động assemble full URL khi trả về","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### POST `/faceswap`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"preset_image_id\": \"preset_id_from_database\",","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"selfie_id\": \"selfie_id_from_database\",","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"profile_id\": \"user_profile_id\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"resultImageUrl\": \"result_url\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"status\": \"success\",","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"message\": \"Processing successful\",","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"code\": 200,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"\"debug\": {}","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"#### GET `/results`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Returns: `{ results: [...] }`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each result contains: `result_url`, `created_at`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Frontend Functionality","heading":"Frontend Functionality","text":"## Frontend Functionality","url":"#/REQUIREMENTS.md?id=frontend-functionality","level":2},{"title":"Face Swap AI - Requirements - Preset Section (Left Column, Top)","heading":"Preset Section (Left Column, Top)","text":"### Preset Section (Left Column, Top)","url":"#/REQUIREMENTS.md?id=preset-section-left-column-top","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Upload Area**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Single file input (one preset at a time)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Drag and drop support","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On file selection:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Use original filename from file input (sanitize for safety)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show preview immediately using FileReader in large preview area","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Call `/upload-url` with original filename and type 'preset'","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- If response has `exists: true`: Use existing URL, show message \"Image already exists\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- If response has `exists: false`: Upload file to returned uploadUrl","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Store uploaded/existing URL and preset object","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show success/error status messages","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Reload presets gallery after upload","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Preset Gallery**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display below upload area in scrollable grid","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Load presets from `/presets` endpoint on page load","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each preset card shows thumbnail image (square, 100px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Click preset to select (visual feedback with selected state)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected preset shows in large preview area above gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Use `image_url` directly from database (no conversion needed)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Empty state: \"No presets yet. Upload your first preset above.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Delete button on each gallery item (top-right corner, appears on hover)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Delete button on selected preset preview (top-right corner, always visible)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Delete Preset**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On delete button click (gallery or preview):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show confirmation dialog: \"Are you sure you want to delete this preset?\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- If confirmed: Call `DELETE /presets/:id`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On success: Remove from gallery, clear selection if deleted preset was selected, show success message","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On error: Show error message, keep item in gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Reload presets gallery after successful deletion","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Selfie Section (Left Column, Bottom)","heading":"Selfie Section (Left Column, Bottom)","text":"### Selfie Section (Left Column, Bottom)","url":"#/REQUIREMENTS.md?id=selfie-section-left-column-bottom","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Upload Area**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Identical UI and functionality to Preset Upload","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Single file input (one selfie at a time)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Drag and drop support","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On file selection:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Use original filename from file input (sanitize for safety)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show preview immediately using FileReader in large preview area","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Call `/upload-url` with original filename and type 'selfie'","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- If response has `exists: true`: Use existing URL, show message \"Image already exists\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- If response has `exists: false`: Upload file to returned uploadUrl","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Store uploaded/existing URL and selfie object","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show success/error status messages","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Reload selfies gallery after upload","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Selfie Gallery**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display below upload area in scrollable grid","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Load selfies from `/selfies` endpoint on page load","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each selfie card shows thumbnail image (square, 100px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Click selfie to select (visual feedback with selected state)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected selfie shows in large preview area above gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Use `image_url` directly from database (no conversion needed)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Empty state: \"No selfies yet. Upload your first selfie above.\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Delete button on each gallery item (top-right corner, appears on hover)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Delete button on selected selfie preview (top-right corner, always visible)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- **Delete Selfie**:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On delete button click (gallery or preview):","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show confirmation dialog: \"Are you sure you want to delete this selfie?\"","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- If confirmed: Call `DELETE /selfies/:id`","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On success: Remove from gallery, clear selection if deleted selfie was selected, show success message","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On error: Show error message, keep item in gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Reload selfies gallery after successful deletion","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Result Display (Right Column, Spans Both Rows)","heading":"Result Display (Right Column, Spans Both Rows)","text":"### Result Display (Right Column, Spans Both Rows)","url":"#/REQUIREMENTS.md?id=result-display-right-column-spans-both-rows","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Large display area (min-height: 600px)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Shows generated face swap result","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Empty state: \"Result will appear here\" with icon","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Result image: Max width/height 100%, object-fit: contain","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Updates automatically after successful generation","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Face Swap Generation","heading":"Face Swap Generation","text":"### Face Swap Generation","url":"#/REQUIREMENTS.md?id=face-swap-generation","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Button positioned below main workspace grid","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Enabled when both preset and selfie are selected","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- On click:","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show loading spinner overlay","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Disable button","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Call `/faceswap` with preset URL and selfie URL","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display result image in right column on success","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show error message on failure","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Reload results history gallery after success","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Results Display","heading":"Results Display","text":"### Results Display","url":"#/REQUIREMENTS.md?id=results-display","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Load results from `/results` on page load","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display results in simple grid gallery","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each result card shows image and date","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Date formatted as Vietnamese locale","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Data Structures","heading":"Data Structures","text":"## Data Structures","url":"#/REQUIREMENTS.md?id=data-structures","level":2},{"title":"Face Swap AI - Requirements - Preset Object","heading":"Preset Object","text":"### Preset Object","url":"#/REQUIREMENTS.md?id=preset-object","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"id: string,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"image_url: string,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"prompt_json: object | null,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"thumbnail_url: string | null,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"thumbnail_format: 'webp' | 'lottie' | null,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"thumbnail_resolution: string | null,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"created_at: string","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Selfie Object","heading":"Selfie Object","text":"### Selfie Object","url":"#/REQUIREMENTS.md?id=selfie-object","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"id: string,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"image_url: string,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"created_at: string","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Result Object","heading":"Result Object","text":"### Result Object","url":"#/REQUIREMENTS.md?id=result-object","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"result_url: string,","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"created_at: string (ISO format)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - State Variables","heading":"State Variables","text":"## State Variables","url":"#/REQUIREMENTS.md?id=state-variables","level":2},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `selectedPreset`: Currently selected preset object or null","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `selectedSelfie`: Currently selected selfie object or null","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `presets`: Array of all preset objects (loaded from `/presets`)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `selfies`: Array of all selfie objects (loaded from `/selfies`)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- `results`: Array of all result objects (loaded from `/results`)","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - UI Elements","heading":"UI Elements","text":"## UI Elements","url":"#/REQUIREMENTS.md?id=ui-elements","level":2},{"title":"Face Swap AI - Requirements - Preset Gallery","heading":"Preset Gallery","text":"### Preset Gallery","url":"#/REQUIREMENTS.md?id=preset-gallery","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Simple grid layout","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Each card: square aspect ratio, image only","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Selected state: border highlight","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Status Messages","heading":"Status Messages","text":"### Status Messages","url":"#/REQUIREMENTS.md?id=status-messages","level":3},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Success: Green color","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Error: Red color","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Loading: Spinner animation","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Image URL Handling","heading":"Image URL Handling","text":"## Image URL Handling","url":"#/REQUIREMENTS.md?id=image-url-handling","level":2},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Database stores the final accessible URL directly in `image_url` field","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Backend constructs the correct R2 URL (e.g., `/r2/preset/filename.jpg` or full URL with worker domain) when uploading","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Frontend uses `image_url` from database directly - no conversion needed","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- URLs are ready to use as-is for display and API calls","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Error Handling","heading":"Error Handling","text":"## Error Handling","url":"#/REQUIREMENTS.md?id=error-handling","level":2},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Network errors: Show error message","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- API errors: Display error message from response","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Image load errors: Show placeholder","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements - Initialization","heading":"Initialization","text":"## Initialization","url":"#/REQUIREMENTS.md?id=initialization","level":2},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Load presets from `/presets` on page load","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Load selfies from `/selfies` on page load","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Load results from `/results` on page load","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Display loading placeholders while fetching","url":"#/REQUIREMENTS.md","level":0},{"title":"Face Swap AI - Requirements","heading":"Face Swap AI - Requirements","text":"- Show empty states if no data available","url":"#/REQUIREMENTS.md","level":0}];
    
    // Configure Docsify
    window.$docsify = {
      name: 'Face Swap AI API',
      repo: '',
      loadSidebar: true,
      subMaxLevel: 4,
      auto2top: true,
      homepage: 'API_TONG_QUAN_VI.md',
      coverpage: false,
      search: {
        maxAge: 86400000,
        paths: ["API_TONG_QUAN_VI.md","CREDIT_SYSTEM_DIAGRAMS.md","FCM_SETUP_COMPLETE_VI.md","GOOGLE_PLAY_SETUP_VI.md","REQUIREMENTS.md"],
        placeholder: 'Tìm kiếm...',
        noData: 'Không tìm thấy kết quả',
        depth: 6
      },
      notFoundPage: true,
      executeScript: true,
      pagination: {
        previousText: 'Trước',
        nextText: 'Tiếp',
        crossChapter: true,
        crossChapterText: true,
      },
      plugins: [
        function(hook, vm) {
          // Override sidebar loading
          hook.beforeEach(function(html) {
            return html;
          });
          
          hook.mounted(function() {
            // Inject sidebar content
            const sidebarEl = document.querySelector('.sidebar');
            if (sidebarEl && window.__staticSidebar) {
              // Docsify will load sidebar, but we can pre-populate it
            }
            
            // Ensure sidebar is expanded by default
            setTimeout(() => {
              const sidebar = document.querySelector('.sidebar');
              const app = document.querySelector('#app');
              if (sidebar && app) {
                sidebar.style.transform = 'translateX(0)';
                sidebar.style.display = 'block';
                app.classList.remove('close');
              }
            }, 100);
          });
          
          // Override fetch to serve from embedded content
          const originalFetch = window.fetch;
          window.fetch = function(url, options) {
            if (typeof url === 'string') {
              // Handle markdown files
              if (url.endsWith('.md') || url.includes('.md')) {
                const fileName = url.split('/').pop().split('?')[0];
                if (window.__staticDocs[fileName]) {
                  return Promise.resolve(new Response(
                    window.__staticDocs[fileName],
                    { headers: { 'Content-Type': 'text/markdown; charset=utf-8' } }
                  ));
                }
              }
              // Handle sidebar
              if (url.includes('_sidebar.md') || url.endsWith('_sidebar')) {
                return Promise.resolve(new Response(
                  window.__staticSidebar,
                  { headers: { 'Content-Type': 'text/markdown; charset=utf-8' } }
                ));
              }
            }
            return originalFetch.apply(this, arguments);
          };
          
          // Inject search index when search plugin loads
          hook.doneEach(function() {
            if (window.Docsify && window.Docsify.util && window.__staticSearchIndex) {
              // Try to set search index
              setTimeout(() => {
                const searchPlugin = window.Docsify.dom.find('.search input');
                if (searchPlugin && !window.__searchIndexSet) {
                  // Store index globally for search plugin
                  window.DocsifySearchIndex = window.__staticSearchIndex;
                  window.__searchIndexSet = true;
                }
              }, 100);
            }
          });
        },
        // Custom search plugin that uses pre-generated index
        function(hook, vm) {
          hook.ready(function() {
            if (window.__staticSearchIndex) {
              // Override search functionality
              const searchInput = document.querySelector('.search input');
              if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                  const query = e.target.value.toLowerCase().trim();
                  if (query.length < 2) return;
                  
                  const results = window.__staticSearchIndex.filter(item => {
                    const searchText = (item.title + ' ' + item.text).toLowerCase();
                    return searchText.includes(query);
                  });
                  
                  // Display results (simplified - Docsify will handle UI)
                  console.log('Search results:', results.length);
                });
              }
            }
          });
        }
      ]
    };
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/docsify@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/pagination.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/external-script.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
</body>
</html>